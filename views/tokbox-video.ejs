<!DOCTYPE html>
<html lang="en" ng-app = "tokboxvideo">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>APPLINIC - Video Chat</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    
    <link rel="stylesheet" href="/assets/css/vendor.css">
     <link rel="icon" type="image/png" href="/assets/images/icons/favicon.png">
    <!-- CSS Files -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/css/now-ui-kit.css" rel="stylesheet" />
     <link href="/assets/css/my-edit.css" rel="stylesheet" />
      <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="/assets/css/demo.css" rel="stylesheet" />
     <link rel="stylesheet" type="text/css" href="/assets/css/all.css">

    <!--<script src="/assets/js/vendor/jquery-library.js"></script>
    <script type="text/javascript" src="/assets/js/angular-source.js"></script>-->

    <script src="/assets/js/vendor2.js"></script>
    <script type="text/javascript" src="/assets/js/source.js"></script>

     <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128083647-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-128083647-1');
    </script>

    <style>
         body {
            line-height: 30px;
         }

          blockquote {
                /*text-indent: 20px;*/
                padding: 15px 5px 5px;
                background-color: lightYellow;
                font-style: normal;
                
            }

            blockquote > label {
              display: block;
            }

            blockquote > span {
              white-space: pre-wrap;
            }

        .card-title {
            text-transform: uppercase;
            text-align: center;
            border-bottom: 1px solid #ccc;
            padding-bottom: 1em;
        }

        .bt-border {
            border-bottom: 1px solid rgba(0,0,0,0.2)
        }

       .list-group-item, .list-group-item:first-child, .list-group-item:last-child {
            background: transparent;
            border:0;
        }

     .banner {
        position: relative;
        z-index: 1
      }

      .cover {
        background-color: rgba(0,0,0,0.7);
        position: absolute;
        width: 100%;
        top: 0;
        left: 0;
        height: 100%
      }

      .main {
        width: 60%;
        margin: 0 auto;
        z-index: 2;
        margin-top: -350px;
        background-color: transparent;
      }

      .search {
        display: inline-block;
        list-style: none;
      }

      .search li {
        float: left;
      }


      .calender-header i {
        width: 20%;
        cursor: pointer;
    }

.calender-header i,.calender-header span {
    font-size: 24px;
    display: inline-block;
}

.calender-header > span {
    width: 55%;
}

.week,.indays {
    text-align: center;
}

.custom-control-description {
  font-weight: normal!important;
}

span.day {  
    display: inline-block;
    padding: 5px;
    width: 12.5%;
    text-align: center;
    font-size: 16px;
    margin: 20px 0px 10px;
}

span.dates {
    margin-right: 5px;
    display: inline-block;
    padding: 5px;
    width: 13%;
    text-align: center;
    font-size: 14px;
    margin: 8px 0px;
    border-bottom: 1px solid grey;
    box-shadow: 1px 2px 3px grey;
    font-weight: bold;
}

.different-month {
    color:#C0C0C0;
    font-weight: normal!important;
}



.today {
    background:#ccc;
    color:#fff;
}
            
.different-month {
    color:#C0C0C0;
}
            
.selected {
    background:#7dbb00;
    color:white;
}

.notAvail {
    text-decoration: line-through;
    color:red;
}

.updateInfo {
    color: orange;
    float: right;
}

.moved {
  transform: translate(10px); /* Equal to translateX(10px) */
  background-color: pink;
}

.mobile-item-display {
  display: none;
}

.panel-collapse > textarea {
    height: 120px
}

label {
  font-weight: bold;
}

.modal {
  padding-top: 250px!important;
}



        @media screen and (max-width: 750px) {

          .how-responsive {
            position: static!important;
          }

          .main {
            margin-top: -100px;
          }

          .main h1 {
            font-size: 32px
          }
        }

         @media screen and (max-width: 720px) {

          .no-mobile-item-display {
            display: none;
          }

         .mobile-item-display {
            display: block;
          }

          .modal-content {
            margin-top: 150px!important
          }
        }

        @media screen and (min-width: 720px) {
          .modal-content {
            margin-left: -100px!important;
            width:700px!important;
            margin-top: 150px
          }
        }
    </style>


</head>

<body style="overflow-x:hidden;position: relative;">
   
    <!-- End Navbar -->
    <div id="otEmbedContainer" style="width:100%; height:660px;"></div>
  
    <!--<script src="https://tokbox.com/embed/embed/ot-embed.js?embedId=1cf8b23e-3a59-4012-a2ac-8fff36468112&room=DEFAULT_ROOM"></script>  -->   
    

    <div ng-controller="VideoDiagnosisController2"> 
        <!-- Navbar -->
      <% include ./inner/nav3 %>

      <div style="position: fixed;bottom: 50px;right: 50px;z-index: 9">
          <a href="" class="btn btn-warning btn-sm btn-round block mb-2" style="text-align: center;" ng-click="audioChat()" ng-cloak>
              <i class="fa fa-phone"></i><br>
              <span>&nbsp;{{(loading1) ? "Switching..." : "Audio"}}&nbsp;</span>                
          </a>
           <a href="" class="btn btn-success btn-sm btn-round" style="text-align: center;" ng-click="dashboard()" ng-cloak>
              <i class="fa fa-user-md"></i><br>
              <span>Dashboard</span>                
          </a>
      </div>
    </div>

    <div style="height: 40px;position: fixed;bottom: 0;background-color: #fff;z-index: 999;width: 100%">
    </div>

    <div style="height: 300px;"></div>
    

    <script src="<%= tokBox %>"></script>  

    <script type="text/ng-template" id="investigation.html">
        <div class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content" style="margin-top: 175px;">
              <div class="modal-header">            
                <h5>Add Radiologist <span style="display: block;font-size: 14px">The radiologist who reports studies for your center.</span></h5>
                <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
              </div>
              <div class="modal-body">                
                <form ng-submit="addRadiologist()">
                  <label>Names of Radiologist *:</label><br>
                  <input type="text" name="" placeholder="Full name" ng-model="radiologist.name" class="form-control" required><br>
                  <label>Email of Radiologist *:</label><br>
                  <input type="email" name="" placeholder="Email" ng-model="radiologist.email" class="form-control" required><br>
                  <label>Phone Number of Radiologist:</label><br>
                  <input type="text" name="" placeholder="Phone number" ng-model="radiologist.phone" class="form-control"><br>
                  <label>Designation of Radiologist *:</label><br>
                  <select ng-model="radiologist.designation" class="form-control" required>
                    <option value="" selected disabled>_Select</option>
                    <option>Consultant Radiologist</option>
                    <option>Senior Registrar</option>
                    <option>Registrar</option>
                  </select><br>
                  <input type="submit" name="" value="Add" class="btn btn-primary" ng-if="!loading">
                  <span ng-if="loading"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"></i></span>
                </form>
                <div style="max-height: 400px;overflow-y: auto;">
                  <div ng-repeat='app in patientAppointments | orderBy : "-created"' class="pl-1" style="margin: 15px 0;border-bottom: 1px solid rgba(0,0,0,0.2);position: relative;">             
                    <label>Date:</label> <span>{{app.date | date: "fullDate"}}</span> &nbsp;&nbsp;&nbsp;
                    <label>Time: </label> <span>{{app.time | date: 'shortTime'}}</span> <br>
                   <!-- <label>Offset: </label> <span am-time-ago="app.date"></span> &nbsp;&nbsp;&nbsp;-->
                    <span style="display: inline-block;"><label>Venue: </label> <span>{{app.address}}</span></span>
                    <span style="position: absolute;right: 0;bottom: 5px;cursor: pointer;font-weight: normal;">
                      <i class="fa fa-trash text-muted btn btn-neutral btn-sm"  title="Delete appointment" ng-click="markAttended(app)" ng-if="!app.loading"></i>
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="app.loading"></i>
                    </span>
                  </div>
                </div>
              </div>
          </div>
        </div>
        </div>
    </script>

    <script type="text/ng-template" id='appointment-modal.html'>
      <div class="modal fade" style="padding-top: 200px">
          <div class="modal-dialog">
            <div class="modal-content">             
              <div class="modal-header">
                  <h5 class="h6">Appointments</h5>
                  <button type="button" class="close" ng-click="close('Yes')" data-dismiss="modal" style="position: absolute;right: 15px;top: 5px" >&times;</button>      
              </div>
              <div class="modal-body">
                <!--<div class="col-md-3">
                    <img src="{{patientForAppointmentDetails.patient_profile_pic_url}}" style="width:75px;">
                </div>  
                <div class="col-md-8 pl-1"> 
                  <div>         
                    <div><b>{{patientForAppointmentDetails.patient_title}} 
                      {{patientForAppointmentDetails.patient_firstname}} {{patientForAppointmentDetails.patient_lastname}}</b>
                    </div>
                    <div>{{patientForAppointmentDetails.patient_age}}</div>
                    <div>{{patientForAppointmentDetails.patient_phone}}</div>
                  </div>
                </div>  
                <div class="clearfix"></div>-->
               
                <div  style="text-align: right;">                
                  <a href=""  title="new appointment" ng-click="bookAppointment()" class="btn btn-success">New</a>
                  <!--<i class="fa fa-calendar btn btn-neutral" style="position: absolute;right: 0;top:-15px;font-size: 18px" title="Give new appointment" ng-click="bookAppointment()"></i>-->
                </div>
                <div style="max-height: 650px;overflow-y: auto;">
                  <div ng-repeat='app in patientAppointments | orderBy : "-created"' class="pl-1" style="margin: 15px 0;border-bottom: 1px solid rgba(0,0,0,0.2);position: relative;">             
                    <label>Date:</label> <span>{{app.date | date: "fullDate"}}</span> &nbsp;&nbsp;&nbsp;
                    <label>Time: </label> <span>{{app.time | date: 'shortTime'}}</span> <br>
                   <!-- <label>Offset: </label> <span am-time-ago="app.date"></span> &nbsp;&nbsp;&nbsp;-->
                    <span style="display: inline-block;"><label>Venue: </label> <span>{{app.address}}</span></span>
                    <span style="position: absolute;right: 0;bottom: 5px;cursor: pointer;font-weight: normal;">
                      <i class="fa fa-trash text-muted btn btn-neutral btn-sm"  title="Delete appointment" ng-click="markAttended(app)" ng-if="!app.loading"></i>
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="app.loading"></i>
                    </span>
                  </div>
                </div>
                <p style="text-align: center;margin-top: 20px"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="loading"></i></p>
                <p class="mt-2" style="text-align: center;" ng-show="patientAppointments.length == 0">No appointment history yet.</p>
              </div>
            </div>
          </div>
      </div>
    </script>

     <script type="text/ng-template" id="calender-template.html">
        <div class="modal fade" style="padding-top: 200px">
          <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <b>Book Appointment</b>
                  <button type="button" class="close" ng-click="close('Yes')" data-dismiss="modal" style="position: absolute;right: 15px;top: 10px" >&times;</button>                            
              </div>
            
              <div class="modal-body">
                    <div class="row">
                <div class="col-sm-12 col-md-12 col-lg-12">
                                              
                        <div class="calender-header text-center pl-2">
                            <i class="fa fa-angle-left" ng-click="previous()"></i>
                            <span style="font-size: 24px">{{month.format("MMMM, YYYY")}}</span>
                            <i class="fa fa-angle-right" ng-click="next()"></i>
                        </div>
                        <div class="week" style="line-height: 0.5">
                            <span class="day">Sun</span>
                            <span class="day">Mon</span>
                            <span class="day">Tue</span>
                            <span class="day">Wed</span>
                            <span class="day">Thu</span>
                            <span class="day">Fri</span>
                            <span class="day">Sat</span>
                        </div>
                        
                        <div ng-repeat="week in weeks" class="indays">
                            <span class="dates" ng-class="{ today: day.isToday, 'different-month': !day.isCurrentMonth, selected: day.date.isSame(selected) }" ng-click="select(day)" style="cursor:pointer" ng-repeat="day in week.days">{{day.number}}</span>
                        </div>                        
                        <p class="bg-default" style="font-size:1em; padding:15px;">Picked Date: <em style="color: green">{{dd.format('dddd, MMMM Do YYYY')}}</em><span style="display:block">Picked time: <em style="color: green">{{treatment.appointment.time | date: "mediumTime"}} </em></span>
                            <span>Picked Venue: <em style="color: green">{{treatment.appointment.address}} </em></span>
                        </p>

                        <div>
                            <label>Time of appointment: <br><input type="time" class="form-control" style="font-size: 14px!important" placeholder="Enter time" ng-model="treatment.appointment.time" style="font-size:.5em;"/></label>
                            <br>
                            <label>Venue (If none,defaults to the address in your profile): <br> <input class="form-control" style="font-size: 14px!important" type="address" placeholder="Enter address" ng-model="treatment.appointment.address"></label>
                        </div>
  </div>  </div> 
                        <div class="clearfix"></div>
                       
                </div>

                <div class="modal-footer ok">
                            <button  ng-click="book()" class="btn btn-info btn-sm"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i> {{(loading)? " " : 'Submit'}}</button>
                        </div>
              </div>          
            </div>
          </div>
     </script>




     <script type="text/ng-template" id='chart.html'>
        <div class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">            
                <h5>Vitals</h5>
                <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
              </div>
              <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                
                <!-- start -->
                  






<div class="p-2">
 

<h4 class="h6">Blood Pressure / Pulse Rate</h4>

<div class="p-2 card" style="position: relative;">
  <header>
    <div style="position: absolute;right: 25px;top:20px">
      <select ng-model="chart.year">
        <option value="{{year.year}}" selected ng-repeat="year in yearList">{{year.year}}</option>
      </select>
    </div>
    <div ng-show="checkLogIn.type !== 'Patient' ">
      <!--<div class="img-col">                                                    
                <img class="img" style="background-image: url({{holdPatientForChart.profile_pic_url}})"></div>
            </div>-->
            <div class="body-col">                                                    
               <b class="block">{{holdPatientForChart.name}}</b>
               <span>{{holdPatientForChart.gender}}</span><br>
               <span>{{holdPatientForChart.age}}</span><br>
            </div>
    </div>
  </header>
  <hr>

  <!--<div style="position: relative;">
    <h4 class="h6"></h4>
     <select ng-model="chart.year" style="position: absolute;right: 10px;top:0">
          <option value="{{year.year}}" selected ng-repeat="year in yearList">{{year.year}}</option>
      </select>
  </div>-->
  <!--<div ng-show="checkLogIn.type !== 'Patient' ">
 
          <div class="body-col">                                                    
             <b class="block">{{holdPatientForChart.name}}</b>
             <span>{{holdPatientForChart.gender}}</span><br>
             <span>{{holdPatientForChart.age}}</span><br>
             <a href="" ng-click="userPatient(holdPatientForChart.userId,false)" style="text-decoration: underline;" ng-show="checkLogIn.typeOfUser === 'Doctor'"><i class="fa fa-folder-open text-warning"></i> Go to e-treatment</a>
          </div>
  </div>-->
   
  <div class="clearfix"></div>
  <div style="position: relative;">

    <a href="" style="background-color: #45b7cd;display: inline-block;width: 30px;height: 10px;content: ' '"></a> <span> &nbsp;Pulse</span>&nbsp;&nbsp;&nbsp;

    <a href="" style="background-color: #ff6384;display: inline-block;width: 30px;height: 10px;content: ' '"></a> <span> &nbsp;Systolic</span>&nbsp;&nbsp;&nbsp;

    
      <a href="" style="background-color:#FDB45C;display: inline-block;width: 30px;height: 10px;content: ' '"></a> <span> &nbsp;Diastolic</span>

    

      <button href="#dataEntry" style="position: absolute;right: 5px;bottom: 2px" class="grayish collapsed btn btn-sm btn-success dropdown-toggle" data-toggle="collapse" data-parent="#accordion"  aria-expanded="false" aria-controls="collapsefifty">Data</button>
  </div>
  <br>
  <div id="dataEntry" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
    <div style="text-align: right;">
      <label>Unit: mmHg, bpm</label>
    </div>
    <form class="row" ng-submit="sendDataBP()">
      
      <div class="col-md-2 pr-1">
        <label>Systolic</label><br>
        <input type="text" name="" class="form-control"  ng-model="chart.readings.systol">
      </div>
      <div class="col-md-2 pr-1">
        <label>Diastolic</label><br>
        <input type="text" name="" class="form-control"  ng-model="chart.readings.diastol">
      </div>

      <div class="col-md-2 pr-1">
        <label>Pulse </label><br>
        <input type="text" name="" class="form-control" ng-model="chart.readings.pulse">
      </div>

      <div class="col-md-3">
        <label>Time</label><br>
        <input type="time" name="" class="form-control" required ng-model="time">
      </div>

      <div class="col-md-3">  
        <label style="content: ''"></label><br>   
        <input type="submit" name="" class="btn btn-info" value="Save" style="margin-top: 10px" ng-show="!loadingBP">
        <span ng-show="loadingBP" style="margin-top: 20px;display: inline-block;">Saving...</span>
      </div>
    </form>

    <section class="mt-2" style="margin-left: -15px" ng-if="chartData.bp_readings">
      <label> Data Entries:</label>
      <div style="max-height: 550px;overflow: auto;">

        <table class="table">
          <thead>
            <th>Pulse</th>
            <th>Systolic</th>
            <th>Diastolic</th>
            <th>Time</th>
            <th>Action</th>
          </thead>
          <tbody ng-repeat="i in chartData.bp_readings | orderBy: '-day'">
            <td>
              <span ng-show="!i.isEdit">{{i.pulse || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.pulse">
              </div>
            </td>
            <td>
              
              <span ng-show="!i.isEdit">{{i.systol || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.systol">
              </div>

            </td>
            <td>
              
              <span ng-show="!i.isEdit">{{i.diastol || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.diastol">
              </div>

            </td>
            <td>
              <span ng-show="!i.isEdit">{{i.label || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.label">
              </div>
            </td>
            <td>
              <div ng-if="!i.isEdit">
                <a href="" class="btn btn-sm btn-simple round mr-1" ng-click="editReading(i)">
                  <i class="fa fa-pencil-alt"></i>
                </a>
                <a class="btn btn-sm btn-simple round" ng-click="deleteChartReadingBP(i)">
                  <i class="fa fa-trash-alt" ng-show="!i.loading"></i>
                  <span ng-show="i.loading">Deleting...</span>
                </a>
              </div>
              <div ng-show="i.isEdit">
                <a href="" class="btn btn-info btn-sm mr-1" ng-click="updateReading(i,'bp_readings')">{{(i.isloading) ? "Saving..." : "Save"}}</a>
                <a href="" class="btn btn-simple btn-sm" ng-click="cancelEdit(i)"><i class="fa fa-times"></i></a>
              </div>
            </td>
          </tbody>
       
          
        </table>
      </div>
    </section>
    
  </div>
  <hr>
  <section ng-if="chartData.bp_readings.length > 0" class="p-0 m-0">
      <canvas id="line" class="chart chart-line" chart-data="data" chart-colors="colors"
    chart-labels="labels" chart-series="series"
    chart-dataset-override="datasetOverride" chart-click="onClick">
    </canvas>
    
    <div style="position: relative;height: 50px" ng-show="chartData.bp_readings">
      <button class="btn btn-sm btn-simple" style="position: absolute;top: 10px; left: 45px" ng-click="setChart('negative')" ng-hide="bpMarker === 0"><i class="fa fa-arrow-left"></i> </button>
      <button class="btn btn-sm btn-simple" style="position: absolute;top: 10px; right: 45px" ng-click="setChart('positive')" ng-hide ="bpMarker === megaArrBP.length - 1"> <i class="fa fa-arrow-right"></i> </button>
    </div>
    
    <div style="text-align: center;padding-top: 10px" class="text-muted">
      <span>Year: {{chart.year}}</span>
      
    </div>
    
    <div>
      <label>Lastly updated by:</label><br>
      <div>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].entered_by_name) : ""}}</div>
      <span class="block">{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].entered_by_address) : ""}}</span>
      <span class="block">{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].entered_by_email) : ""}}</span>
      <span>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].label) : ""}}</span><br><br>
      <label>Abnormalities detected from last readings:</label>
        <ul class="pl-1">
          <li ng-repeat="k in chartData.bp_readings[chartData.bp_readings.length -1].abnormalities" ng-if="k" class="pl-0 ml-0">{{k}}</li>
       </ul>
       <p class="pt-0 mt-0" ng-if="chartData.bp_readings[chartData.bp_readings.length -1].abnormalities.length == 0">No abnormal BP readings detected.</p>
      <!--<label>Date: </label> <span>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].day | date : "fullDate") : ""}}</span>-->
    </div>    
  </section>
  <p class="text-muted p-2" style="text-align: center;" ng-if="!chartData.bp_readings || chartData.bp_readings.length === 0">No data to display</p>
  
  
  <div  style="height: 20px">
    
  </div>
</div>

<div style="height: 50px"></div>


<!-- blood Sugar Chart Template -->
<div class="">
  <h4 class="h6">Blood Sugar</h4>
</div>
<div class="p-2 card" style="position: relative;">
  <header>
    <div style="position: absolute;right: 25px;top:20px">
      <select ng-model="chart.year">
        <option value="{{year.year}}" selected ng-repeat="year in yearList">{{year.year}}</option>
      </select>
    </div>
    <div ng-show="checkLogIn.type !== 'Patient' ">
      <!--<div class="img-col">                                                    
                <img class="img" style="background-image: url({{holdPatientForChart.profile_pic_url}})"></div>
            </div>-->
            <div class="body-col">                                                    
               <b class="block">{{holdPatientForChart.name}}</b>
               <span>{{holdPatientForChart.gender}}</span><br>
               <span>{{holdPatientForChart.age}}</span><br>
             
            </div>
    </div>
  </header>
  <hr>
  <div style="position: relative;">
    <a href="" style="display: inline-block;width: 30px;background-color: #45b7cd;height: 10px;content: ' '"></a> <span> &nbsp;Fasting Blood Sugar (FBS)</span>&nbsp;&nbsp;&nbsp;<br clear="hidden-md-up">

    <a href="" style="display: inline-block;width: 30px;background-color: #ff6384;height: 10px;content: ' '"></a> <span> &nbsp;Random Blood Sugar (RBS)</span>&nbsp;&nbsp;&nbsp;

      <!--<a href="" style="display: inline-block;width: 30px;background-color:#FDB45C;height: 10px;content: ' '"></a> <span> &nbsp;Diastol</span>-->

      <button href="#dataEntry1" class="grayish collapsed btn btn-sm btn-success dropdown-toggle" data-toggle="collapse" data-parent="#accordion"  aria-expanded="false" aria-controls="collapsefifty" style="position: absolute;right: 0px;top: -10px;">Data</button>
  </div>
  <br>
  <div id="dataEntry1" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
    <div style="text-align: right;">
      <label>Unit: mg/dl</label>
    </div>
    <form class="row" ng-submit="sendDataBS()">
      <div class="col-md-2 pr-1">
        <label>FBS</label><br>
        <input type="text" name="" class="form-control" ng-model="chart.readings1.fasting">
      </div>
      <div class="col-md-2 pr-1">
        <label>RBS</label><br>
        <input type="text" name="" class="form-control" ng-model="chart.readings1.random">
      </div>
      <!--<div class="col-md-2 pr-1">
        <label>Diastol</label><br>
        <input type="text" name="" class="form-control" required ng-model="chart.readings.diastol">
      </div>-->
      <div class="col-md-3">
        <label>Time</label><br>
        <input type="time" name="" class="form-control" required ng-model="time">
      </div>
      <div class="col-md-3">  
        <label style="content: ''"></label><br>   
        <input type="submit" name="" class="btn btn-info" value="Save" style="margin-top: 10px" ng-show="!loadingBS">
        <span ng-show="loadingBS" style="margin-top: 20px;display: inline-block;">Saving...</span>
      </div>
    </form>
    <hr>    
    <div class="pl-0">  
      <p>If your device result is in <b>mmol/l</b> unit please convert it to <b>mg/dl</b> below:</p>  
      <input type="number" name="" ng-model="mmol" placeholder="Enter mmol/l value"> <button ng-click="convertToDl()">convert to mg/dl</button> 
      <br><br>
      <b>mg/dl: {{tomgdl}}</b>
    </div>
    <hr>
    <section class="mt-2" style="margin-left: -15px" ng-if="chartData.bs_readings">
      <label>Data Entries:</label>
      <div style="max-height: 550px;overflow: auto;">
        <table class="table">
          <thead>
            <th>FBS</th>
            <th>RBS</th>
            
            <th>Time</th>
            <th>Action</th>
          </thead>
          <tbody ng-repeat="i in chartData.bs_readings | orderBy: '-day'">
            <td>
              <span ng-show="!i.isEdit">{{i.fasting || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.fasting">
              </div>
            </td>
            <td>
              <span ng-show="!i.isEdit">{{i.random || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.random">
              </div>
            </td>
            
            <td>
              <span ng-show="!i.isEdit">{{i.label}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.label">
              </div>
            </td>
            <td>
              <div ng-if="!i.isEdit">
                <a href="" class="btn btn-sm btn-simple round mr-1" ng-click="editReading(i)">
                  <i class="fa fa-pencil-alt"></i>
                </a>
                <a class="btn btn-sm btn-simple round" ng-click="deleteChartReadingBS(i)">
                  <i class="fa fa-trash-alt" ng-show="!i.loading"></i>
                  <span ng-show="i.loading">Deleting...</span>
                </a>
              </div>
              <div ng-show="i.isEdit">
                <a href="" class="btn btn-info btn-sm mr-1" ng-click="updateReading(i,'bs_readings')">{{(i.isloading) ? "Saving..." : "Save"}}</a>
                <a href="" class="btn btn-simple btn-sm" ng-click="cancelEdit(i)"><i class="fa fa-times"></i></a>
              </div>
            </td>
          </tbody>          
        </table>
      </div>
    </section>
    
  </div>
  <hr>
  <section ng-if="chartData.bs_readings.length > 0">
      <canvas id="line" class="chart chart-line" chart-data="data1" chart-colors="colors1"
    chart-labels="labels1" chart-series="series1"
    chart-dataset-override="datasetOverride" chart-click="onClick1">
    </canvas>

    <div style="position: relative;height: 50px" ng-show="chartData.bs_readings">
    <button class="btn btn-sm btn-simple" style="position: absolute;top: 15px; left: 45px" ng-click="setChart1('negative')" ng-hide="bsMarker == 0"><i class="fa fa-arrow-left"></i> previous</button>
    <button class="btn btn-sm btn-simple" style="position: absolute;top: 15px; right: 45px" ng-click="setChart1('positive')" ng-hide ="bsMarker === megaArrBS.length - 1">next <i class="fa fa-arrow-right"></i> </button>
    </div>

    <div style="text-align: center;padding-top: 10px" class="text-muted">
      <span>Year: {{chart.year}}</span>&nbsp;&nbsp;&nbsp;
      <span>Unit: mg/dl</span>
    </div>
    <br>
    <div>
      <label>Lastly updated by:</label><br>
      <div>{{(chartData.bs_readings[chartData.bs_readings.length -1]) ? (chartData.bs_readings[chartData.bs_readings.length -1].entered_by_name) : ""}}</div>
      <span class="block">{{(chartData.bs_readings[chartData.bs_readings.length -1]) ? (chartData.bs_readings[chartData.bs_readings.length -1].entered_by_address) : ""}}</span>
      <span class="block">{{(chartData.bs_readings[chartData.bs_readings.length -1]) ? (chartData.bs_readings[chartData.bs_readings.length -1].entered_by_email) : ""}}</span><span>
      {{(chartData.bs_readings[chartData.bs_readings.length -1]) ? (chartData.bs_readings[chartData.bs_readings.length -1].label) : ""}}</span><br><br>
       <label>Abnormalities detected from last readings:</label><br>

       <ul class="pl-1">
          <li ng-repeat="k in chartData.bs_readings[chartData.bs_readings.length -1].abnormalities" ng-if="chartData.bs_readings[chartData.bs_readings.length -1].abnormalities.length > 0" class="pl-0 ml-0">{{k}}</li>
       </ul>
       <p class="text-center" ng-if="chartData.bs_readings[chartData.bs_readings.length -1].abnormalities.length == 0">No abnormal BP readings detected.</p>
      <!--<label>Date: </label> <span>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].day | date : "fullDate") : ""}}</span>-->
    </div>    
      <!--<label>Date: </label> <span>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].day | date : "fullDate") : ""}}</span>-->
    </div>
  </section>
  <p class="text-muted p-2" style="text-align: center;" ng-if="!chartData.bs_readings || chartData.bs_readings.length == 0">No data to display</p>
  <div  style="height: 20px">
    
  </div>
</div>

<div style="height: 50px"></div>

<!-- Temperature Chart Template -->
<div class="">
  <h4 class="h6">Temperature</h4>
</div>
<div class="card p-2" style="position: relative;">
  <header>
    <div style="position: absolute;right: 25px;top:20px">
      <select ng-model="chart.year">
        <option value="{{year.year}}" selected ng-repeat="year in yearList">{{year.year}}</option>
      </select>
    </div>
    <div ng-show="checkLogIn.typeOfUser !== 'Patient' ">
      <!--<div class="img-col">                                                    
                <img class="img" style="background-image: url({{holdPatientForChart.profile_pic_url}})"></div>
            </div>-->
            <div class="body-col">                                                    
               <b class="block">{{holdPatientForChart.name}}</b>
               <span>{{holdPatientForChart.gender}}</span><br>
               <span>{{holdPatientForChart.age}}</span><br>
               <a href="" ng-click="userPatient(holdPatientForChart.userId,false)" style="text-decoration: underline;" ng-show="checkLogIn.typeOfUser === 'Doctor'"><i class="fa fa-folder-open text-warning"></i> Go to e-treatment</a>
            </div>
    </div>
  </header>
  <hr>
  <div style="position: relative;">
    <a href="" style="display: inline-block;width: 30px;background-color: #FDB45C;height: 10px;content: ' '"></a> <span> &nbsp;Temperature</span>&nbsp;&nbsp;&nbsp;

    

      <!--<a href="" style="display: inline-block;width: 30px;background-color:#FDB45C;height: 10px;content: ' '"></a> <span> &nbsp;Diastol</span>-->

      <button href="#dataEntry2" class="grayish collapsed btn btn-sm btn-success dropdown-toggle" data-toggle="collapse" data-parent="#accordion"  aria-expanded="false" aria-controls="collapsefifty" style="position: absolute;right: 0px;top: -10px;">Data</button>
  </div>
  <br>
  <div id="dataEntry2" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
    <div style="text-align: right;">
      <label>Unit: °C</label>
    </div>
    <form class="row" ng-submit="sendDataTemp()">
      <div class="col-md-2 pr-1">
        <label>Temperature</label><br>
        <input type="text" name="" class="form-control" required ng-model="chart.readings2.temperature">
      </div>
      
      <div class="col-md-3">
        <label>Time</label><br>
        <input type="time" name="" class="form-control" required ng-model="time">
      </div>
      <div class="col-md-3">  
        <label style="content: ''"></label><br>   
        <input type="submit" name="" class="btn btn-info" value="Save" style="margin-top: 10px" ng-show="!loadingTemp">
        <span ng-show="loadingTemp" style="margin-top: 20px;display: inline-block;">Saving...</span>
      </div>
    </form>

    <section class="mt-2" style="margin-left: -15px" ng-if="chartData.temp_readings">
      <label>Data Entries:</label>
      <div style="max-height: 550px;overflow: auto;">
        <table class="table">
          <thead>
            <th>
              Temperature
            </th>
      
            <th>Time</th>
            <th>Action</th>
          </thead>
          <tbody ng-repeat="i in chartData.temp_readings | orderBy: '-day'">
            <td>
              <span ng-show="!i.isEdit">{{i.temperature || '-'}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.temperature">
              </div>
            </td>         
            <td>
              <span ng-show="!i.isEdit">{{i.label}}</span>
              <div ng-show="i.isEdit">
                <input type="text" name="" ng-model="i.label">
              </div>
            </td>
            <td>
              <div ng-if="!i.isEdit">
                <a href="" class="btn btn-sm btn-simple round mr-1" ng-click="editReading(i)">
                  <i class="fa fa-pencil"></i>
                </a>
                <a class="btn btn-sm btn-simple round" ng-click="deleteChartReadingTemp(i)">
                  <i class="fa fa-trash-o" ng-show="!i.loading"></i>
                  <span ng-show="i.loading">Deleting...</span>
                </a>
              </div>
              <div ng-show="i.isEdit">
                <a href="" class="btn btn-info btn-sm mr-1" ng-click="updateReading(i,'temp_readings')">{{(i.isloading) ? "Saving..." : "Save"}}</a>
                <a href="" class="btn btn-simple btn-sm" ng-click="cancelEdit(i)"><i class="fa fa-times"></i></a>
              </div>
            </td>
          </tbody>
          
        </table>
      </div>
    </section>
    
  </div>
  <hr>
  <section ng-if="chartData.temp_readings.length > 0">
      <canvas id="line" class="chart chart-line" chart-data="data2" chart-colors="colors2"
    chart-labels="labels2" chart-series="series2"
    chart-dataset-override="datasetOverride" chart-click="onClick2">
    </canvas>
    <div style="position: relative;height: 50px" ng-show="chartData.temp_readings">
      <button class="btn btn-sm btn-simple" style="position: absolute;top: 15px; left: 45px" ng-click="setChart2('negative')" ng-hide="tempMarker == 0 && megaArrTemp.length > 0"><i class="fa fa-arrow-left"></i> previous</button>
      <button class="btn btn-sm btn-simple" style="position: absolute;top: 15px; right: 45px" ng-click="setChart2('positive')" ng-hide ="tempMarker === megaArrTemp.length - 1">next <i class="fa fa-arrow-right"></i> </button>
    </div>
    <div style="text-align: center;" class="text-muted">
      <span>Year: {{chart.year}}</span>&nbsp;&nbsp;&nbsp;
      <span>Unit: °C</span>
    </div>
    <br>
    <div>
      <label>Lastly updated by:</label><br>
      <div>{{(chartData.temp_readings[chartData.temp_readings.length -1]) ? (chartData.temp_readings[chartData.temp_readings.length -1].entered_by_name) : ""}}</div>
      <span class="block">{{(chartData.temp_readings[chartData.temp_readings.length -1]) ? (chartData.temp_readings[chartData.temp_readings.length -1].entered_by_address) : ""}}</span>
      <span class="block">{{(chartData.temp_readings[chartData.temp_readings.length -1]) ? (chartData.temp_readings[chartData.temp_readings.length -1].entered_by_email) : ""}}</span>
      {{(chartData.temp_readings[chartData.temp_readings.length -1]) ? (chartData.temp_readings[chartData.temp_readings.length -1].label) : ""}}
      <!--<label>Date: </label> <span>{{(chartData.bp_readings[chartData.bp_readings.length -1]) ? (chartData.bp_readings[chartData.bp_readings.length -1].day | date : "fullDate") : ""}}</span>-->
    </div>
  </section>
  <p class="text-muted p-2" style="text-align: center;" ng-if="!chartData.temp_readings || chartData.temp_readings.length == 0">No data to display</p>
  
    </div>     <!-- end -->
         
        </div>
        </div>

  </script>


  <script type="text/ng-template" id='prescription.html'>
    <div class="modal fade">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">            
            <h5>Prescription</h5>
            <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
          </div>
          <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">

<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>

<div class="pr-1 mt-2" style="position: relative;"> 
  <button class="btn btn-success" ng-click="writePrescription()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "prescription.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who prescribed.</span>
     </label>
  </label>
</div>

<div style="" class="mb-1 card p-1"  ng-repeat="docInfo in prescriptionRecordsResult |filter : filterResult | orderBy: '-date'" id="{{docInfo.prescriptionId}}" ng-if="!prescription.isSorted"> 
<div>

  <div class="pl-1 pt-1" style="position: relative;">
    <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
    <span am-time-Ago="docInfo.date" style="position: absolute;top:5px;right: 20px"></span>
  </div>
  <hr>
  <div  style="line-height: 30px;" id="{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">

         <strong style="font-weight: bold;padding: 15px 0px 5px;line-height: 35px" > Prescribed by: </strong> <span>{{docInfo.title}}  {{docInfo.doctor_firstname}} {{docInfo.doctor_lastname}}</span> <br>

         <span ng-if="docInfo.doctor_work_place"><strong style="" ng-if="docInfo.doctor_specialty" >Specialty: </strong> <span>{{docInfo.doctor_specialty}}</span><br></span>

         <span ng-if="docInfo.doctor_work_place"><strong > Place of work: </strong> <span>{{docInfo.doctor_work_place}}</span><br></span>

         <strong> Address:</strong> <span>{{docInfo.doctor_address}} {{docInfo.doctor_city}} {{docInfo.doctor_country}}</span><br>
        

         <strong>Date of prescription</strong> : <span>{{docInfo.date | date: "mediumDate"}} ( <span am-time-Ago="docInfo.date"></span> )</span><br>

         <strong>Prescription ID :</strong> <span>{{(docInfo.copy) ? "Copied!" : docInfo.prescriptionId}}</span>
      <a href="" clipboard supported="supported" text="docInfo.prescriptionId" on-copied="success(docInfo)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br> 

         <p style="padding-right:10px;word-wrap: break-word;" ng-show="docInfo.explanation"><strong>Description</strong> : <span>{{docInfo.explanation}}</span></p>
         <p style="color:red;padding: 5px 20px 0 0" ng-if="!docInfo.doctor_work_place"><i class="fa fa-warning"></i> This prescription may have been written by non-professional.</p>

        
     
  </div>
  <div class="p-1" style="margin-top: -15px">      
          
          <div class="no-mobile-item-display">
            
              <table class="table table-striped">
                <tr>
                  <thead>
                    <th>S/N</th>
                    <th>Drug Name</th>
                    <th>Dosage</th>
                    <th>Frequency</th>
                    <th>Duration</th>
                    <th class="text-muted">Select</th>                    
                  </thead>                  
                </tr>
                <tr>
                  <tbody ng-repeat="prescription in docInfo.prescription_body">                 
                    <td>{{prescription.sn}}</td>
                    <td>{{prescription.drug_name}}</td>
                    <td>{{prescription.dosage}}</td>
                    <td>{{prescription.frequency}}</td>
                    <td>{{prescription.duration}}</td>
                    <td><label class="custom-control custom-checkbox">
                     <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description" style="opacity:0;">.</span>
                     </label>
                  </td>       
                  </tbody>
                </tr>
              </table>
            
          </div>
          <div class="mobile-item-display">               
            <section  ng-repeat="prescription in docInfo.prescription_body" style="padding: 5px 0;border-bottom: 1px solid #eee;position: relative;width: 100%">
                <div style="width: 98%">   
                <span> {{prescription.sn}}) </span>&nbsp;
                <span> {{prescription.drug_name}}</span>&nbsp;
                <span> ( {{prescription.dosage}} )</span>&nbsp;
                <span> {{prescription.frequency}}</span>&nbsp;
                <span> {{prescription.duration}}</span>
                <div style="position: absolute;right: -12px;bottom: 0px"> 
                  <label class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked">
                    <span class="custom-control-indicator"></span>
                    <span class="custom-control-description" style="opacity:0;">.</span>
                  </label>
                </div>
              </div>
            </section>
          </div>        
      </div>
    </div>
 
  </div>

  <div ng-if="prescription.isSorted">
    <section>
      <div class="">
        <h5>You ({{sortedPrescriptions.mine.length}})</h5>
      </div>
      <div  class="card mb-1  p-1"  ng-repeat="docInfo in sortedPrescriptions.mine |filter : filterResult | orderBy: '-date'" id="{{docInfo.prescriptionId}}">
        <div class="pl-1 pt-1" style="position: relative;">
          <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
          <span am-time-Ago="docInfo.date" style="position: absolute;top:5px;right: 20px"></span>
        </div>
        <hr>

        <div  style="line-height: 30px;" id="{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">

               <strong style="font-weight: bold;padding: 15px 0px 5px;line-height: 35px" > Prescribed by: </strong> <span>{{docInfo.title}}  {{docInfo.doctor_firstname}} {{docInfo.doctor_lastname}}</span> <br>

               <span ng-if="docInfo.doctor_work_place"><strong style="" ng-if="docInfo.doctor_specialty" >Specialty: </strong> <span>{{docInfo.doctor_specialty}}</span><br></span>

               <span ng-if="docInfo.doctor_work_place"><strong > Place of work: </strong> <span>{{docInfo.doctor_work_place}}</span><br></span>

               <strong> Address:</strong> <span>{{docInfo.doctor_address}} {{docInfo.doctor_city}} {{docInfo.doctor_country}}</span><br>
              

               <strong>Date of prescription</strong> : <span>{{docInfo.date | date: "mediumDate"}} ( <span am-time-Ago="docInfo.date"></span> )</span><br>

               <strong>Prescription ID :</strong> <span>{{(docInfo.copy) ? "Copied!" : docInfo.prescriptionId}}</span>
            <a href="" clipboard supported="supported" text="docInfo.prescriptionId" on-copied="success(docInfo)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br> 

               <p style="padding-right:10px;word-wrap: break-word;" ng-show="docInfo.explanation"><strong>Description</strong> : <span>{{docInfo.explanation}}</span></p>

               <p style="color:red;padding: 10px 20px 0 0" ng-if="!docInfo.doctor_work_place"><i class="fa fa-warning"></i> This prescription may have been written by non-professional.</p>

               <!-- <a href="{{docInfo.doctor_profile_url}}" title="view profile" ng-if="docInfo.doctor_work_place" class="text-info">View doctor's profile</a><br>-->
           
        </div>
        <div class="p-1" style="margin-top: -15px">      
                
                <div class="no-mobile-item-display">
                  
                    <table class="table table-striped">
                      <tr>
                        <thead>
                          <th>S/N</th>
                          <th>Drug Name</th>
                          <th>Dosage</th>
                          <th>Frequency</th>
                          <th>Duration</th>
                          <th class="text-muted">Select</th>                    
                        </thead>                  
                      </tr>
                      <tr>
                        <tbody ng-repeat="prescription in docInfo.prescription_body">                 
                          <td>{{prescription.sn}}</td>
                          <td>{{prescription.drug_name}}</td>
                          <td>{{prescription.dosage}}</td>
                          <td>{{prescription.frequency}}</td>
                          <td>{{prescription.duration}}</td>
                          <td><label class="custom-control custom-checkbox">
                           <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked" >
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;">.</span>
                           </label>
                        </td>       
                        </tbody>
                      </tr>
                    </table>
                  
                </div>
                <div class="mobile-item-display">               
                  <section  ng-repeat="prescription in docInfo.prescription_body" style="padding: 5px 0;border-bottom: 1px solid #eee;position: relative;width: 100%">
                      <div style="width: 98%">   
                      <span> {{prescription.sn}}) </span>&nbsp;
                      <span> {{prescription.drug_name}}</span>&nbsp;
                      <span> ( {{prescription.dosage}} )</span>&nbsp;
                      <span> {{prescription.frequency}}</span>&nbsp;
                      <span> {{prescription.duration}}</span>
                      <div style="position: absolute;right: -12px;bottom: 0px"> 
                        <label class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;">.</span>
                        </label>
                      </div>
                    </div>
                  </section>
                </div>        
            </div>
          </div>
        
    </section>

    <section ng-repeat="j in sortedPrescriptions.others |filter : filterResult | orderBy: '-date'" id="{{docInfo.prescriptionId}}">
      <div class="mb-2 mt-2">
        <h5>
          <a href="{{j.profile}}">
            {{j.title}} {{j.firstname}} {{j.lastname}} ({{j.prescriptions.length}})
          </a>
        </h5>
        
      </div>
      <div  class="card mb-1 p-1"  ng-repeat="docInfo in j.prescriptions |filter : filterResult | orderBy: '-date'" id="{{docInfo.prescriptionId}}" ng-if="prescription.isSorted">
        <div class="pl-1 pt-1" style="position: relative;">
          <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
          <span am-time-Ago="docInfo.date" style="position: absolute;top:5px;right: 20px"></span>
        </div>
        <hr>

        <div  style="line-height: 30px;" id="{{'pres' + docInfo.ref_id + docInfo.prescriptionId}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">

               <strong style="font-weight: bold;padding: 15px 0px 5px;line-height: 35px" > Prescribed by: </strong> <span>{{docInfo.title}}  {{docInfo.doctor_firstname}} {{docInfo.doctor_lastname}}</span> <br>

               <span ng-if="docInfo.doctor_work_place"><strong style="" ng-if="docInfo.doctor_specialty" >Specialty: </strong> <span>{{docInfo.doctor_specialty}}</span><br></span>

               <span ng-if="docInfo.doctor_work_place"><strong > Place of work: </strong> <span>{{docInfo.doctor_work_place}}</span><br></span>

               <strong> Address:</strong> <span>{{docInfo.doctor_address}} {{docInfo.doctor_city}} {{docInfo.doctor_country}}</span><br>
              

               <strong>Date of prescription</strong> : <span>{{docInfo.date | date: "mediumDate"}} ( <span am-time-Ago="docInfo.date"></span> )</span><br>

               <strong>Prescription ID :</strong> <span>{{(docInfo.copy) ? "Copied!" : docInfo.prescriptionId}}</span>
            <a href="" clipboard supported="supported" text="docInfo.prescriptionId" on-copied="success(docInfo)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br> 

               <p style="padding-right:10px;word-wrap: break-word;" ng-show="docInfo.explanation"><strong>Description</strong> : <span>{{docInfo.explanation}}</span></p>

               <p style="color:red;padding: 10px 20px 0 0" ng-if="!docInfo.doctor_work_place"><i class="fa fa-warning"></i> This prescription may have been written by non-professional.</p>

                <a href="{{docInfo.doctor_profile_url}}" title="view profile" ng-if="docInfo.doctor_work_place" class="text-info">View doctor's profile</a><br>
           
        </div>
        <div class="p-1" style="margin-top: -15px">      
                
                <div class="no-mobile-item-display">
                  
                    <table class="table table-striped">
                      <tr>
                        <thead>
                          <th>S/N</th>
                          <th>Drug Name</th>
                          <th>Dosage</th>
                          <th>Frequency</th>
                          <th>Duration</th>
                          <th class="text-muted">Select</th>                    
                        </thead>                  
                      </tr>
                      <tr>
                        <tbody ng-repeat="prescription in docInfo.prescription_body">                 
                          <td>{{prescription.sn}}</td>
                          <td>{{prescription.drug_name}}</td>
                          <td>{{prescription.dosage}}</td>
                          <td>{{prescription.frequency}}</td>
                          <td>{{prescription.duration}}</td>
                          <td><label class="custom-control custom-checkbox">
                           <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked" >
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;">.</span>
                           </label>
                        </td>       
                        </tbody>
                      </tr>
                    </table>
                  
                </div>
                <div class="mobile-item-display">               
                  <section  ng-repeat="prescription in docInfo.prescription_body" style="padding: 5px 0;border-bottom: 1px solid #eee;position: relative;width: 100%">
                      <div style="width: 98%">   
                      <span> {{prescription.sn}}) </span>&nbsp;
                      <span> {{prescription.drug_name}}</span>&nbsp;
                      <span> ( {{prescription.dosage}} )</span>&nbsp;
                      <span> {{prescription.frequency}}</span>&nbsp;
                      <span> {{prescription.duration}}</span>
                      <div style="position: absolute;right: -12px;bottom: 0px"> 
                        <label class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;">.</span>
                        </label>
                      </div>
                    </div>
                  </section>
                </div>        
            </div>
          </div>
         
        

      </section>
    </div>
  </div>



          
        </div>   
      </div>
    </div>
  </script>


   <script type="text/ng-template" id="write-prescription-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header"> 
              <h6>Write Prescription</h6>
        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                 
              <section>
                 <span class="pb-0 mb-0 block">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</span>
                 <span class="block">{{holdPatientDatails.gender}}</span>
                 <span class="block">{{holdPatientDatails.age}}</span>
              </section>
             
              <section ng-show="!isSearchToSend">                               
                             
                     
                      <div class=""> <!-- mobile-item-display -->                           
                          <table class="table" ng-repeat="prescription in drugList">
                              <thead><th>sn: </th> <td>{{prescription.sn}}</td></thead>
                              <thead><th class="pb-1" style="width: 25%">Drug name: </th> <td style="width: 75%"><input  type="text" placeholder="Enter drug name" ng-model="prescription.drug_name" uib-typeahead="drug.name for drug in drugs | filter:$viewValue | limitTo:15" class="form-control"></td></thead>
                              <thead><th class="pb-1">Dosage: </th> <td><input type="text" name="dose" ng-model="prescription.dosage" placeholder="Enter dosage" class="form-control"></td></thead>
                              <thead><th class="pb-1">Frequency: </th> <td><input  type="text" placeholder="Enter frequency" ng-model="prescription.frequency" uib-typeahead="f for f in frequencies | filter:$viewValue | limitTo:15" class="form-control"></td></thead>
                              <thead><th class="pb-1">Duration: </th> <td><input  type="text" placeholder="Enter duration" ng-model="prescription.duration" uib-typeahead="d for d in durations | filter:$viewValue | limitTo:15" class="form-control" style=""></td></thead>
                              <hr class="bg-warning">
                          </table>
                      </div>
                      
                      <div style="text-align: right;margin: 10px 0">
                          <i class="fa fa-plus btn btn-simple round btn-sm" style="cursor:pointer; margin-right: 10px" title="Add field" ng-click="addDrug()"></i>
                              <i class="fa fa-minus btn btn-simple round btn-sm" style="cursor:pointer" title="Remove last field" ng-click="removeDrug()" ng-show="drugList.length > 1"></i>
                      </div>
                      <div class="mb-1">
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Instructions / explanations for prescription(s) above (optional)</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <textarea class="form-control p-1" name="drug intake guide" placeholder="For eg. Take Ibuprofen only after meals" ng-model="patient.explanation" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      
                      </div>
                       <div>
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Would you like to pay the bill for the prescription(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <label class="custom-control custom-radio">
                            Yes
                           <input type="radio" class="custom-control-input" value="Yes" ng-model="patient.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label> &nbsp;&nbsp;&nbsp;


                          <label class="custom-control custom-radio">
                            No
                           <input type="radio" class="custom-control-input" value="No" ng-model="patient.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label>  
                      
                      </div>
                       <div class="clearfix"></div>
                      <br>

                      <!--<div>
                          <input type="submit" value="Continue" class="btn btn-primary"  ng-show="!loading">
                          <span ng-show="loading">Processing...</span>
                      </div>  -->       
                  </section>

                  <section>
                      <div>
                          <label>Would you like to use our courier service to deliver the drugs to a location?</label>
                          <div>
                              <label class="custom-control custom-radio">
                                Yes
                               <input type="radio" class="custom-control-input" value="Yes" ng-model="patient.isCourier">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description" style="opacity:0;"></span>
                              </label> &nbsp;&nbsp;&nbsp;


                              <label class="custom-control custom-radio">
                                No
                               <input type="radio" class="custom-control-input" value="No" ng-model="patient.isCourier">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description" style="opacity:0;"></span>
                              </label> 
                          </div>
                          <div ng-show="patient.isCourier == 'Yes'" class="mt-1">
                              <div>
                                  <label class="block pb-0">We'll deliver the package to this address</label>
                                  <input type="text" name="" class="form-control" ng-model="patient.delivery_address" placeholder="{{patient.patientDetails.address}}">
                              </div>
                              <div>
                                  <label class="block pb-0">We'll call this line</label>
                                  <input type="text" name="" class="form-control" ng-model="patient.phone1" placeholder="{{patient.patientDetails.phone}}">
                              </div>
                          </div> 
                      </div>
                  </section>
                  <br>
                  <section>                     
                      <form ng-submit="findPharmacy()">
                          <div class="col-md-10 col-sm-10 col-xs-10 pl-0 ml-0">
                              <input type="text" name="" placeholder="City" ng-model="city" class="form-control">
                          </div>
                          <div class="col-md-2 col-sm-2 col-xs-2 pl-0 ml-0" style="padding-top: 3px">
                              <button type="submit" name=""  class="btn btn-success"><i class="fa fa-search"></i></button>
                          </div>
                      </form>
                      <div class="clearfix"></div>
                      <div>                 
                          <div ng-show="searchResult.length > 2" class="mt-2">
                              <input type="text" name="" placeholder=" Filter list" ng-model="item" class="simple-border">
                          </div>
                          <br>
                          <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1" ng-show="patient.isCourier === 'No' || j.courier_access">
                              <label class="pb-0 mb-0">{{j.name}}</label><br>
                              <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                              <span>{{j.phone}}</span>

                              <span style="position: absolute;bottom: 10px;right: 5px">
                                  <button class="btn btn-sm btn-success" ng-click="sendDrug(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success"  ng-show="j.isSent"></i>
                              </span><br>
                          </div>
                      </div>
                      <div ng-show="isLoading" class="mt-2" style="text-align: center;">
                          <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                      </div>
                  </section> 
                  <div style="height: 120px"></div>   
            </div>        
          </div> 
        </div>
      </div>
    </script>



    <script type="text/ng-template" id='e-case-laboratory.html'>
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">            
              <h5>Laboratory</h5>
              <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
            </div>
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">





<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>

<div class="pr-1 mt-2" style="position: relative;">
  
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "laboratory.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!laboratory.isSorted">
  <section  class="card mb-2 relative p-2" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">      
    <div class="pb-0 pt-1 pl-1 pr-1 mb-2">
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span><br></span>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                <hr>
            </div>
           
        <div class="mb-1">
                <h6>Test(s) requested:</h6>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
          <div ng-show="test.conclusion == 'Pending'">
                <h6>Test Report: </h6>
                <p ng-if="test.conclusion == 'Pending'" style=""> No report received at this time</p>
            </div>
    </div>    
    
    <div class="pt-0 pb-1 pl-1 pr-1">
      <h6 ng-show="test.receive_date">Test Report: </h6>          
      <div ng-if="test.receive_date" class="patient-tests" ng-repeat = "testRan in test.report">
        <article ng-if="!testRan.report_sheet">
          <div><strong>{{testRan.name}}:</strong></div>
          <p style="background-color: lightYellow;font-size: 16px;padding: 15px">
            {{testRan.report}}
          </p>
        </article>

        <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format !== 'antigen'">
                  <thead>
                      <th style="width: 19%">Name</th>
                      <th style="width: 18%">TUM</th>
                      <th style="width: 18%">Result</th>
                      <th style="width: 18%">Range</th>
                      <th style="width: 18%">Unit</th>
                      <th style="width: 18%">Flag</th>
                  </thead>
                  <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                   <tbody ng-repeat="k in testRan.report_sheet" ng-class="{'text-danger': k.r_flag == 'Low' || k.r_flag == 'High'}">
                      <td style="width: 19%">{{k.r_name}}</td>
                      <td style="width: 18%">{{k.r_tum}}</td>
                      <td style="width: 18%">{{k.r_result}}</td>
                      <td style="width: 18%">{{k.r_range}}</td>
                      <td style="width: 18%">{{k.r_unit}}</td>
                      <td style="width: 18%">{{k.r_flag}}</td>
                  </tbody>                              
            </table>  
            
            <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format === 'antigen'">
                    <thead style="text-align: left;padding: 10px 0;font-size: 14px">                           
                        <th>&nbsp;</th>
                        <th>O. (Antigen)</th>                                           
                        <th>H. (Antigen)</th>                           
                    </thead>               
                    <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                    <tbody ng-repeat="k in testRan.report_sheet">                           
                        <tr ng-if="k.r_result_O">
                            <td><b>{{k.r_name}}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>
                            <td>{{k.r_result_H || k.r_result }}</td>
                        </tr>
                        
                        <tr ng-if="!k.r_result_O">
                            <td><b>{{k.r_name }}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>                               
                        </tr>
                    </tbody>
                </table>                        
      </div>
      
      <div ng-show="test.receive_date">
        
        <!--<div>
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.lab_pdf_report[0].pdf_report}}" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-click="pdfViewer(test.lab_pdf_report[0].pdf_report)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a>&nbsp;&nbsp;

          <a href="{{test.lab_pdf_report[0].pdf_report}}" title="Download test report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a>&nbsp;&nbsp;

          <a href="" title="Forward report to someone via email" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Laboratory',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a>&nbsp;&nbsp;
          
        </div>-->             
      </div>
      <!--<a href="" class="position"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Laboratory')"></i></a>-->
    </div>      
  </section>
</div>

<div ng-if="laboratory.isSorted">
  <div>
    <h5>You ({{sortedLaboratory.mine.length}})</h5>
  </div>
  <section  class="card mb-1 relative p-2" ng-repeat="test in sortedLaboratory.mine | filter : filterResult" id="{{test.ref_id}}">      
    <div class="pb-0 pt-1 pl-1 pr-1">
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span><br></span>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
                <h6>Test(s) requested:</h6>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
    <div class="pt-0 pb-1 pl-1 pr-1">
      <h6 ng-show="test.receive_date">Test Report: </h6>          
      <div ng-if="test.receive_date" class="patient-tests" ng-repeat = "testRan in test.report">
        <article ng-if="!testRan.report_sheet">
          <div><strong>{{testRan.name}}:</strong></div>
          <p style="background-color: lightYellow;font-size: 16px;padding: 15px">
            {{testRan.report}}
          </p>
        </article>


        <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format !== 'antigen'">
                  <thead>
                      <th style="width: 19%">Name</th>
                      <th style="width: 18%">TUM</th>
                      <th style="width: 18%">Result</th>
                      <th style="width: 18%">Range</th>
                      <th style="width: 18%">Unit</th>
                      <th style="width: 18%">Flag</th>
                  </thead>
                  <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                   <tbody ng-repeat="k in testRan.report_sheet" ng-class="{'text-danger': k.r_flag == 'Low' || k.r_flag == 'High'}">
                      <td style="width: 19%">{{k.r_name}}</td>
                      <td style="width: 18%">{{k.r_tum}}</td>
                      <td style="width: 18%">{{k.r_result}}</td>
                      <td style="width: 18%">{{k.r_range}}</td>
                      <td style="width: 18%">{{k.r_unit}}</td>
                      <td style="width: 18%">{{k.r_flag}}</td>
                  </tbody>                              
            </table>  
            
            <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format === 'antigen'">
                    <thead style="text-align: left;padding: 10px 0;font-size: 14px">                           
                        <th>&nbsp;</th>
                        <th>O. (Antigen)</th>                                           
                        <th>H. (Antigen)</th>                           
                    </thead>               
                    <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                    <tbody ng-repeat="k in testRan.report_sheet">                           
                        <tr ng-if="k.r_result_O">
                            <td><b>{{k.r_name}}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>
                            <td>{{k.r_result_H || k.r_result }}</td>
                        </tr>
                        
                        <tr ng-if="!k.r_result_O">
                            <td><b>{{k.r_name }}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>                               
                        </tr>
                    </tbody>
                </table>                            
      </div>
      
      <div ng-show="test.receive_date">
        
        <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.lab_pdf_report[0].pdf_report}}" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-click="pdfViewer(test.lab_pdf_report[0].pdf_report)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a>&nbsp;&nbsp;

          <a href="{{test.lab_pdf_report[0].pdf_report}}" title="Download test report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a>&nbsp;&nbsp;

          <a href="" title="Forward report to someone via email" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Laboratory',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a>&nbsp;&nbsp;
        </div> -->             
      </div>
      <!--<a href="" class="position"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Laboratory')"></i></a>-->
    </div>      
  </section>
    <section ng-repeat="j in sortedLaboratory.others |filter : filterResult | orderBy: '-date'" id="{{docInfo.prescriptionId}}">
    <div class="mb-1 card-center-1 mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>
    <div class="card card-center-1 mb-1 relative" ng-repeat="test in j.tests | filter : filterResult" id="{{test.ref_id}}">     
      <div class="pb-0 pt-1 pl-1 pr-1">
                <div  style="position: relative;padding-top: 10px">
                  <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                  <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
              </div>
          <hr>
          <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                    <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                    <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                    <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                    <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                    <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                    <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                    <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                  <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                  <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                  <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                  
              </div>
             
          <div class="mb-1">
                  <h6>Test(s) requested:</h6>
                  <div ng-repeat="ranTest in test.test_to_run">                   
                    <label class="custom-control custom-checkbox">
                          <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description"> {{ranTest.name}}</span>
                      </label>         
                  </div>
              </div> 
             
          
      </div>    
      
      <div class="pt-0 pb-1 pl-1 pr-1">
        <h6 ng-show="test.receive_date">Test Report: </h6>          
        <div ng-if="test.receive_date" class="patient-tests" ng-repeat = "testRan in test.report">
          <article ng-if="!testRan.report_sheet">
            <div><strong>{{testRan.name}}:</strong></div>
            <p style="background-color: lightYellow;font-size: 16px;padding: 15px">
              {{testRan.report}}
            </p>
          </article>


          <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format !== 'antigen'">
                  <thead>
                      <th style="width: 19%">Name</th>
                      <th style="width: 18%">TUM</th>
                      <th style="width: 18%">Result</th>
                      <th style="width: 18%">Range</th>
                      <th style="width: 18%">Unit</th>
                      <th style="width: 18%">Flag</th>
                  </thead>
                  <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                   <tbody ng-repeat="k in testRan.report_sheet" ng-class="{'text-danger': k.r_flag == 'Low' || k.r_flag == 'High'}">
                      <td style="width: 19%">{{k.r_name}}</td>
                      <td style="width: 18%">{{k.r_tum}}</td>
                      <td style="width: 18%">{{k.r_result}}</td>
                      <td style="width: 18%">{{k.r_range}}</td>
                      <td style="width: 18%">{{k.r_unit}}</td>
                      <td style="width: 18%">{{k.r_flag}}</td>
                  </tbody>                              
            </table>  
            
            <table class="table table-striped" ng-if="testRan.report_sheet && testRan.format === 'antigen'">
                    <thead style="text-align: left;padding: 10px 0;font-size: 14px">                           
                        <th>&nbsp;</th>
                        <th>O. (Antigen)</th>                                           
                        <th>H. (Antigen)</th>                           
                    </thead>               
                    <caption style="caption-side: top;color:darkRed">{{testRan.name}}:</caption>
                    <tbody ng-repeat="k in testRan.report_sheet">                           
                        <tr ng-if="k.r_result_O">
                            <td><b>{{k.r_name}}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>
                            <td>{{k.r_result_H || k.r_result }}</td>
                        </tr>
                        
                        <tr ng-if="!k.r_result_O">
                            <td><b>{{k.r_name }}</b></td>
                            <td>{{k.r_result_O || k.r_result }}</td>                               
                        </tr>
                    </tbody>
                </table>                    

                              
        </div>
        
        <div ng-show="test.receive_date">
          
          <!--<div class="relative">
            <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.lab_pdf_report[0].pdf_report}}" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-click="pdfViewer(test.lab_pdf_report[0].pdf_report)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a>&nbsp;&nbsp;

            <a href="{{test.lab_pdf_report[0].pdf_report}}" title="Download test report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a>&nbsp;&nbsp;

            <a href="" title="Forward report to someone via email" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Laboratory',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a>&nbsp;&nbsp;

          </div>    -->            
        </div>
       
      </div>      
    </div>
  </section>

</div>

            </div>
          </div>   
        </div>
      </div>
    </script>



 <script type="text/ng-template" id="write-laboratory-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header"> 
              <h6>Write Laboratory Test</h6>
        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                 
              <section>
                 <span class="block pb-0 mb-0">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</h5>
                 <span class="block pb-0 mb-0">{{holdPatientDatails.gender}}</span>
                 <span class="block pb-0 mb-0">{{holdPatientDatails.age}}</span>
              </section>
             <hr>
              <section ng-show="!isSearchToSend">                               
                    <div>
                        <label>Add Tests ( {{TestList.length}} ) *</label>
                    </div>
                    <div ng-repeat="lab in TestList">
                         
                         <span class="text-danger">{{invMsg}}</span>
                        <input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                        {{getTest(test.name)}} 
                    </div>
                    <div style="text-align: right">
                        <i class="fa fa-plus btn btn-simple btn-sm round" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                        <i class="fa fa-minus btn btn-simple btn-sm round" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                    </div>        
                    <div>
                        <label>Indication *</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                    </div>
                    <br>
                    <div>
                        <label>Clinical Summary *</label>
                        <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                    </div>
                    <br>
                   
                    <div>
                        <label>LMP: ( Female )</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <br>
                     <div>
                        <label>Parity: ( Female ) </label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div> 
                    <br>
                     <div>
                        <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                        <label>Would you like to pay the bill for the test(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                      
                        <label class="custom-control custom-radio">
                          Yes
                         <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;"></span>
                        </label> &nbsp;&nbsp;&nbsp;


                        <label class="custom-control custom-radio">
                          No
                         <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;"></span>
                        </label>  
                    
                    </div>   
                    <br>                   
                  </section>

                  <section>                     
                        <form ng-submit="findLabs()">
                            <div class="col-md-10 col-sm-10 col-xs-10 pl-0 ml-0">
                                <input type="text" name="" ng-model="city" class="form-control">
                            </div>
                            <div class="col-md-2 col-sm-2 col-xs-2 pl-0 ml-0" style="padding-top: 3px">
                              <button type="submit" name=""  class="btn btn-success"><i class="fa fa-search"></i></button>
                          </div>
                        </form>
                        <div class="clearfix"></div>
                        <br>
                        <div>                 
                            <div ng-show="searchResult.length > 2">
                                <input type="text" name="" placeholder=" Filter list" ng-model="item">
                            </div>
                            <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                                <label class="pb-0 mb-0">{{j.name}}</label><br>
                                <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                                <span>{{j.phone}}</span>
                                <span style="position: absolute;bottom: -5px;right: 5px">
                                    <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                                </span>
                            </div>
                        </div>
                        <div ng-show="loading" class="mt-2" style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                        </div>
                  </section> 
                  <div style="height: 120px"></div>   
            </div>        
          </div> 
        </div>
      </div>
    </script>



    <script type="text/ng-template" id='e-case-radiology.html'>
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">            
              <h5>Radiology</h5>
              <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
            </div>
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">





<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>



<div class="pr-1 mt-2" style="position: relative;">
 
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "radiology.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!radiology.isSorted">
  <section class="card p-2 mb-1" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">  
  
  <div class="p-1">
            <div  style="position: relative;padding-top: 10px">
              <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
              <span am-time-Ago="test.sent_date" style="position: absolute;top:3px;right: 15px"></span>
          </div>
      <hr>
      <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
              <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
              <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} <span ng-show="test.receive_date">( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )</span><br>


              <strong>Indication: </strong> <span>{{test.indication}}</span><br>

              <div ng-show="test.patient_id_of_study">
               <strong>Patient ID of Study:</strong> : <span>{{(test.copy) ? "Copied!" : test.patient_id_of_study}}</span> <a href="" clipboard supported="supported" text="test.patient_id_of_study" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a>
              </div>
                
              
          </div>
          <br>
      <div>
              <h6>Study requested:</h6>
              <br>
              <div ng-repeat="ranTest in test.test_to_run">                   
                <label class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description"> {{ranTest.name}}</span>
                  </label>         
              </div>
            

          </div> 
          <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise/Further investigations:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
    </div>
  </section>

</div>


<div ng-if="radiology.isSorted">
  <div>
    <h5>You ({{sortedRadiology.mine.length}})</h5>
  </div>
  <section  class="card p-2 mb-1 relative p-1" ng-repeat="test in sortedRadiology.mine | filter : filterResult" id="{{test.ref_id}}"> 

    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

           
            </div>-->
          </div>
  </section>
   <section  class="card mb-1 relative p-1" ng-repeat="test in sortedRadiology.others | filter : filterResult" id="{{test.ref_id}}">  
      <div class="mb-1 mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>    
    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

           
            </div>-->
          </div>
  </section>

</div>

            </div>
          </div>   
        </div>
      </div>
    </script>



    <script type="text/ng-template" id="write-radiology-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="font-size: inherit;"> 
              <h6>Write Radiology Test</h6>
        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                 
              <section style="font-size: inherit;">
                 <label class="pb-0 mb-0 font-1-2">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</label><br>
                 <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.gender}}</span>
                 <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.age}}</span>
              </section>
             <hr>
              <section ng-show="!isSearchToSend">                               
                    <div>
                        <label>Add Tests ( {{TestList.length}} ) *</label>
                    </div>
                    <div ng-repeat="lab in TestList">
                         
                         <span class="text-danger">{{invMsg}}</span>
                        <input  type="text" placeholder="Enter test name"  ng-model="lab.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                       
                    </div>
                    <div style="text-align: right">
                        <i class="fa fa-plus btn btn-simple btn-sm round" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                        <i class="fa fa-minus btn btn-simple btn-sm round" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                    </div>        
                    <div>
                        <label>Indication *</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                    </div>
                    <br>
                    <div>
                        <label>Clinical Summary</label>
                        <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <br>
                   
                    <div>
                        <label>LMP: ( Female )</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <br>
                     <div>
                        <label>Parity: ( Female ) </label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div> 
                    <br>
                     <div>
                        <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                        <label>Would you like to pay the bill for the test(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                      
                        <label class="custom-control custom-radio">
                          Yes
                         <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;"></span>
                        </label> &nbsp;&nbsp;&nbsp;


                        <label class="custom-control custom-radio">
                          No
                         <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                          <span class="custom-control-indicator"></span>
                          <span class="custom-control-description" style="opacity:0;"></span>
                        </label>  
                    
                    </div>   
                    <br>                   
                  </section>

                  <section>                     
                        <form ng-submit="findLabs()">
                            <div class="col-md-10 col-sm-10 col-xs-10 pl-0 ml-0">
                                <input type="text" name="" ng-model="city" class="form-control">
                            </div>
                            <div class="col-md-2 col-sm-2 col-xs-2 pl-0 ml-0" style="padding-top: 3px">
                              <button type="submit" name=""  class="btn btn-success"><i class="fa fa-search"></i></button>
                          </div>
                        </form>
                        <div class="clearfix"></div>
                        <br>
                        <div>                 
                            <div ng-show="searchResult.length > 2">
                                <input type="text" name="" placeholder=" Filter list" ng-model="item">
                            </div>
                            <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                                <label class="pb-0 mb-0">{{j.name}}</label><br>
                                <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                                <span>{{j.phone}}</span>
                                <span style="position: absolute;bottom: -5px;right: 5px">
                                    <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                                </span>
                            </div>
                        </div>
                        <div ng-show="loading" class="mt-2" style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                        </div>
                  </section> 
                  <div style="height: 120px"></div>   
            </div>        
          </div> 
        </div>
      </div>
    </script>



    <script type="text/ng-template" id='e-case-ultrasound.html'>
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">            
              <h5>Ultrasound</h5>
              <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
            </div>
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">




<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>




<div class="pr-1 mt-2" style="position: relative;">
 
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "radiology.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!radiology.isSorted">
  <section class="card p-2 mb-1" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">  
  
  <div class="p-1">
            <div  style="position: relative;padding-top: 10px">
              <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
              <span am-time-Ago="test.sent_date" style="position: absolute;top:3px;right: 15px"></span>
          </div>
      <hr>
      <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
              <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
              <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} <span ng-show="test.receive_date">( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )</span><br>


              <strong>Indication: </strong> <span>{{test.indication}}</span><br>

              <div ng-show="test.patient_id_of_study">
               <strong>Patient ID of Study:</strong> : <span>{{(test.copy) ? "Copied!" : test.patient_id_of_study}}</span> <a href="" clipboard supported="supported" text="test.patient_id_of_study" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a>
              </div>
                
              
          </div>
          <br>
      <div>
              <h6>Study requested:</h6>
              <br>
              <div ng-repeat="ranTest in test.test_to_run">                   
                <label class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description"> {{ranTest.name}}</span>
                  </label>         
              </div>
            

          </div> 
          <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise/Further investigations:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <div class="relative">
          <!--<a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender,'Ultrasound')"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>-->        
          
             

              <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>
            </div>
          </div>
    </div>
  </section>

</div>


<div ng-if="radiology.isSorted">
  <div>
    <h5>You ({{sortedRadiology.mine.length}})</h5>
  </div>
  <section  class="card mb-1 relative p-1" ng-repeat="test in sortedRadiology.mine | filter : filterResult" id="{{test.ref_id}}"> 

    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <div class="relative">
          <!--<a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>-->

                <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>

            
            </div>
          </div>
  </section>
   <section  class="card mb-1 relative p-1" ng-repeat="test in sortedRadiology.others | filter : filterResult" id="{{test.ref_id}}">  
      <div class="mb-1 mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>    
    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <div class="relative">
          <!--<a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>-->

            <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>
            
            </div>
          </div>
  </section>

</div>

            </div>
          </div>   
        </div>
      </div>
    </script>


     <script type="text/ng-template" id="image-viewer.html">
         <div class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
              <div class="title"></div>
                    <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px; position: absolute;top: 10px; right: 15px">&times;</button>                            
              </div>
              
              <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                 
                  <div ng-repeat="file in files" class="mb-1">
                    <label>{{file.originalname}}</label><br>
                    <img src="{{file.path}}" class="img-fluid" alt="image">
                  </div>
              </div>
              <div class="modal-body" ng-if="file.type == 'video/ogg' || file.type == 'video/mp4'">
                <video controls="false" src="{{file.path}}" style="width: 100%;height: auto;"></video>
              </div>
              
            </div>    
        </div>
     </script>


      <script type="text/ng-template" id="write-ultrasound-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="font-size: inherit;"> 
              <h6>Ultrasound Test</h6>        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                
              <div>
               
                      <section>
                         <label class="pb-0 mb-0">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</label><br>
                         <span class="block pb-0 mb-0">{{holdPatientDatails.gender}}</span>
                         <span class="block pb-0 mb-0">{{holdPatientDatails.age}}</span>
                      </section>
                      <br>    
                      <div>
                          <label>Add test *</label>
                      </div>
                      <div ng-repeat="test in TestList">
                           
                           <span class="text-danger">{{invMsg}}</span>
                          <!--<input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                          {{getTest(test.name)}}-->
                          
                          <input type="text" name="ultra" class="form-control" ng-model='test.name' placeholder="Write ultrasound name">
                      
                      </div>
                      <div style="text-align: right">
                          <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                          <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                      </div>        
                      <div>
                          <label>Indication *</label>
                          <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                      </div>
                      <br>
                      <div>
                          <label>Clinical Summary </label>
                          <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                     
                      <div>
                          <label>LMP: ( Female )</label>
                          <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                       <div>
                          <label>Parity: ( Female ) </label>
                          <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div> 
                      <br>
                       <div>
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Would you like to pay the bill for the investigation(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <label class="custom-control custom-radio">
                            Yes
                           <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label> &nbsp;&nbsp;&nbsp;


                          <label class="custom-control custom-radio">
                            No
                           <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label>  
                      
                      </div>   
                            
                  <section>
                  <hr>
                  <div>       
                      <form ng-submit="findLabs()">
                          <div class="col-md-8 col-sm-8 col-xs-8 pl-0 ml-0">
                              <input type="text" name="" ng-model="city" class="form-control">
                          </div>
                          <div class="col-md-2 col-sm-3 col-xs-3 pl-0 ml-0">
                              <input type="submit" name="" value="Search" class="btn btn-success">
                          </div>
                          <div class="clearfix"></div>
                      </form>
                      <div class="clearfix"></div>
                      <br>
                      <div ng-show="searchResult.length > 2">
                        <input type="text" name="" placeholder=" Filter list by name or address" ng-model="item" class="simple-border">
                      </div>
                      <br>
                      <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                        <label class="pb-0 mb-0">{{j.name}}</label><br>
                        <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                        <span>{{j.phone}}</span>
                        <span style="position: absolute;bottom: -5px;right: 5px">
                          <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                        </span>
                      </div>
                      <div ng-repeat='j in searchResult2 | filter: item' style="position: relative;" class="mb-1">
                          <label class="pb-0 mb-0">{{j.name}}</label><br>
                          <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                          <span>{{j.phone}}</span>
                          <span style="position: absolute;bottom: -5px;right: 5px">
                              <button class="btn btn-sm btn-success" ng-click="sendTest(j,true)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                          </span>
                      </div>
                    </div>
                    <div ng-show="loading" class="mt-2" style="text-align: center;">
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                    </div>
                  </section>
              </div>
            </div>        
          </div> 
        </div>
      </div>
    </script>


    <script type="text/ng-template" id='e-case-ecg.html'>
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">            
              <h5>ECG</h5>
              <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
            </div>
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">




<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>

<!--<div class="card-center-1 card">
  <div class="row"> 
    <div class="col-md-3 col-xs-3 pl-2 pt-2 pb-2">
      <img src="{{patientInfo.profile_pic_url}}" style="max-height: 70px; width: auto;">
    </div>
    <div class="col-md-7 col-xs-7 pl-2 pt-2 pb-2">
        <label class="block pb-0 mb-0">{{patientInfo.title}} {{patientInfo.firstname}} {{patientInfo.lastname}}</label>
        <span>{{patientInfo.gender}}</span><br>
        <span>{{patientInfo.age}}</span><br>
        <span>{{patientInfo.city}}</span>
      </div>
    </div>
    
</div>-->


<div class="pr-1 mt-2" style="position: relative;"> 
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "radiology.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!radiology.isSorted">
  <section class="card p-2 mb-1" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">  
  
  <div class="p-1">
            <div  style="position: relative;padding-top: 10px">
              <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
              <span am-time-Ago="test.sent_date" style="position: absolute;top:3px;right: 15px"></span>
          </div>
      <hr>
      <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
              <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
              <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} <span ng-show="test.receive_date">( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )</span><br>


              <strong>Indication: </strong> <span>{{test.indication}}</span><br>

              <div ng-show="test.patient_id_of_study">
               <strong>Patient ID of Study:</strong> : <span>{{(test.copy) ? "Copied!" : test.patient_id_of_study}}</span> <a href="" clipboard supported="supported" text="test.patient_id_of_study" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a>
              </div>
                
              
          </div>
          <br>
      <div>
              <h6>Study requested:</h6>
              <br>
              <div ng-repeat="ranTest in test.test_to_run">                   
                <label class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description"> {{ranTest.name}}</span>
                  </label>         
              </div>
            

          </div> 
          <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise/Further investigations:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender,'Ultrasound')"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>        
          
             

              <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>
            </div>-->
          </div>
    </div>
  </section>

</div>


<div ng-if="radiology.isSorted">
  <div class="">
    <h5>You ({{sortedRadiology.mine.length}})</h5>
  </div>
  <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.mine | filter : filterResult" id="{{test.ref_id}}"> 

    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>
   <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.others | filter : filterResult" id="{{test.ref_id}}">  
      <div class="mb-1  mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>    
    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

            <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>

</div>

            </div>
          </div>   
        </div>
      </div>
    </script>



    <script type="text/ng-template" id="write-ecg-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="font-size: inherit;"> 
              <h6>ECG Test</h6>        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                
              <div>
               
                      <section>
                         <label class="pb-0 mb-0 font-1-2">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</label><br>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.gender}}</span>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.age}}</span>
                      </section>
                      <br>    
                      <div>
                          <label>Add test *</label>
                      </div>
                      <div ng-repeat="test in TestList">
                           
                           <span class="text-danger">{{invMsg}}</span>
                          <!--<input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                          {{getTest(test.name)}}-->
                          
                          <input type="text" name="ecg" class="form-control" ng-model='test.name' placeholder="Test name">
                      
                      </div>
                      <div style="text-align: right">
                          <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                          <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                      </div>        
                      <div>
                          <label>Indication *</label>
                          <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                      </div>
                      <br>
                      <div>
                          <label>Clinical Summary </label>
                          <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                     
                      <div>
                          <label>LMP</label>
                          <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                       <div>
                          <label>Parity</label>
                          <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div> 
                      <br>
                       <div>
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Would you like to pay the bill for the investigation(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <label class="custom-control custom-radio">
                            Yes
                           <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label> &nbsp;&nbsp;&nbsp;


                          <label class="custom-control custom-radio">
                            No
                           <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label>  
                      
                      </div>   
                            
                  <section>
                  <hr>
                  <div>       
                      <form ng-submit="findLabs()">
                          <div class="col-md-8 col-sm-8 col-xs-8 pl-0 ml-0">
                              <input type="text" name="" ng-model="city" class="form-control">
                          </div>
                          <div class="col-md-2 col-sm-3 col-xs-3 pl-0 ml-0">
                              <input type="submit" name="" value="Search" class="btn btn-success">
                          </div>
                          <div class="clearfix"></div>
                      </form>
                      <div class="clearfix"></div>
                      <br>
                      <div ng-show="searchResult.length > 2">
                        <input type="text" name="" placeholder=" Filter list by name or address" ng-model="item" class="simple-border">
                      </div>
                      <br>
                      <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                        <label class="pb-0 mb-0">{{j.name}}</label><br>
                        <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                        <span>{{j.phone}}</span>
                        <span style="position: absolute;bottom: -5px;right: 5px">
                          <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check btn btn-sm btn-success" ng-show="j.isSent"></i>
                        </span>
                      </div>
                      <div ng-repeat='j in searchResult2 | filter: item' style="position: relative;" class="mb-1">
                          <label class="pb-0 mb-0">{{j.name}}</label><br>
                          <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                          <span>{{j.phone}}</span>
                          <span style="position: absolute;bottom: -5px;right: 5px">
                              <button class="btn btn-sm btn-success" ng-click="sendTest(j,true)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                          </span>
                      </div>
                    </div>
                    <div ng-show="loading" class="mt-2" style="text-align: center;">
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                    </div>
                  </section>
              </div>
            </div>        
          </div> 
        </div>
      </div>
    </script>


    <script type="text/ng-template" id='e-case-endoscopy.html'>
        <div class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">            
                <h5>Endoscopy</h5>
                <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
              </div>
              <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">




<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>




<div class="pr-1 mt-2" style="position: relative;">
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "radiology.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!radiology.isSorted">
  <section class="card mb-1 p-2" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">  
  
  <div class="p-1">
            <div  style="position: relative;padding-top: 10px">
              <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
              <span am-time-Ago="test.sent_date" style="position: absolute;top:3px;right: 15px"></span>
          </div>
      <hr>
      <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
            
              <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} <span ng-show="test.receive_date">( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )</span><br>


              <strong>Indication: </strong> <span>{{test.indication}}</span><br>

              <div ng-show="test.patient_id_of_study">
               <strong>Patient ID of Study:</strong> : <span>{{(test.copy) ? "Copied!" : test.patient_id_of_study}}</span> <a href="" clipboard supported="supported" text="test.patient_id_of_study" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a>
              </div>
                
              
          </div>
          <br>
      <div>
              <h6>Study requested:</h6>
              <br>
              <div ng-repeat="ranTest in test.test_to_run">                   
                <label class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description"> {{ranTest.name}}</span>
                  </label>         
              </div>
            

          </div> 
          <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise/Further investigations:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender,'Ultrasound')"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>        
          
          

              <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>
            </div>-->
          </div>
    </div>
  </section>

</div>


<div ng-if="radiology.isSorted">
  <div class="">
    <h5>You ({{sortedRadiology.mine.length}})</h5>
  </div>
  <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.mine | filter : filterResult" id="{{test.ref_id}}"> 

    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
               
                  <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                  <strong>Indication: </strong> <span>{{test.indication}}</span>                 
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
      </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>
   <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.others | filter : filterResult" id="{{test.ref_id}}">  
      <div class="mb-1 mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>    
    <div>
            <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>

</div>


              </div>
            </div>   
          </div>
        </div>
      </script>

       <script type="text/ng-template" id="write-endoscopy-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="font-size: inherit;"> 
              <h6>Endoscopy Test</h6>        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">                
              <div>
               
                      <section>
                         <label class="pb-0 mb-0 font-1-2">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</label><br>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.gender}}</span>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.age}}</span>
                      </section>
                      <br>    
                      <div>
                          <label>Add test *</label>
                      </div>
                      <div ng-repeat="test in TestList">
                           
                           <span class="text-danger">{{invMsg}}</span>
                          <!--<input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                          {{getTest(test.name)}}-->
                          
                          <input type="text" name="endoscopy" class="form-control" ng-model='test.name' placeholder="Test name">
                      
                      </div>
                      <div style="text-align: right">
                          <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                          <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                      </div>        
                      <div>
                          <label>Indication *</label>
                          <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                      </div>
                      <br>
                      <div>
                          <label>Clinical Summary </label>
                          <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                     
                      <div>
                          <label>LMP</label>
                          <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                       <div>
                          <label>Parity</label>
                          <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div> 
                      <br>
                       <div>
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Would you like to pay the bill for the investigation(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <label class="custom-control custom-radio">
                            Yes
                           <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label> &nbsp;&nbsp;&nbsp;


                          <label class="custom-control custom-radio">
                            No
                           <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label>  
                      
                      </div>   
                            
                  <section>
                  <hr>
                  <div>       
                      <form ng-submit="findLabs()">
                          <div class="col-md-8 col-sm-8 col-xs-8 pl-0 ml-0">
                              <input type="text" name="" ng-model="city" class="form-control">
                          </div>
                          <div class="col-md-2 col-sm-3 col-xs-3 pl-0 ml-0">
                              <input type="submit" name="" value="Search" class="btn btn-success">
                          </div>
                          <div class="clearfix"></div>
                      </form>
                      <div class="clearfix"></div>
                      <br>
                      <div ng-show="searchResult.length > 2">
                        <input type="text" name="" placeholder=" Filter list by name or address" ng-model="item" class="simple-border">
                      </div>
                      <br>
                      <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                        <label class="pb-0 mb-0">{{j.name}}</label><br>
                        <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                        <span>{{j.phone}}</span>
                        <span style="position: absolute;bottom: -5px;right: 5px">
                          <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                        </span>
                      </div>
                      <div ng-repeat='j in searchResult2 | filter: item' style="position: relative;" class="mb-1">
                          <label class="pb-0 mb-0">{{j.name}}</label><br>
                          <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                          <span>{{j.phone}}</span>
                          <span style="position: absolute;bottom: -5px;right: 5px">
                              <button class="btn btn-sm btn-success" ng-click="sendTest(j,true)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                          </span>
                      </div>
                    </div>
                    <div ng-show="loading" class="mt-2" style="text-align: center;">
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                    </div>
                  </section>
              </div>
            </div>        
          </div> 
        </div>
      </div>
    </script>


    <script type="text/ng-template" id='e-case-other-procedures.html'>
        <div class="modal fade">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">            
              <h5>Other Procedures</h5>
              <button type="button" class="close"  data-dismiss="modal" aria-hidden="true">&times;</button>          
            </div>
            <div class="modal-body" style="max-height: 1500px;overflow-y: auto;">

<div style="text-align: center;">
  <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px" ng-if="loading"></i>
</div>

<div class="pr-1 mt-2" style="position: relative;">
 
  <button class="btn btn-success" ng-click="writeInvestigation()" style="position: absolute;top: -20px; right: 10px">New</button>
  <label>
    <label class="custom-control custom-checkbox">
        <input type="checkbox" class="custom-control-input" ng-model= "radiology.isSorted" >
        <span class="custom-control-indicator"></span>
        <span class="custom-control-description">Sort by who requested.</span>
     </label>
  </label>
</div>
<div ng-if="!radiology.isSorted">
  <section class="card mb-1 p-2" ng-repeat="test in labTest | filter : filterResult" id="{{test.ref_id}}">  
  
  <div class="p-1">
            <div  style="position: relative;padding-top: 10px">
              <button class="collapsed dropdown-toggle btn btn-neutral btn-sm pl-0" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
              <span am-time-Ago="test.sent_date" style="position: absolute;top:3px;right: 15px"></span>
          </div>
      <hr>
      <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
              <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
              <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} <span ng-show="test.receive_date">( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )</span><br>


              <strong>Indication: </strong> <span>{{test.indication}}</span><br>

              <div ng-show="test.patient_id_of_study">
               <strong>Patient ID of Study:</strong> : <span>{{(test.copy) ? "Copied!" : test.patient_id_of_study}}</span> <a href="" clipboard supported="supported" text="test.patient_id_of_study" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a>
              </div>
                
              
          </div>
          <br>
      <div>
              <h6>Study requested:</h6>
              <br>
              <div ng-repeat="ranTest in test.test_to_run">                   
                <label class="custom-control custom-checkbox">
                      <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description"> {{ranTest.name}}</span>
                  </label>         
              </div>
            

          </div> 
          <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise/Further investigations:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender,'Ultrasound')"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>        
          
           

              <a href="" ng-click="viewImage(test.files)" style="position: absolute;bottom: 0;right: 10px" class="text-info" ng-show="test.files.length > 0">See images</a>
            </div>-->
          </div>
    </div>
  </section>

</div>


<div ng-if="radiology.isSorted">
  <div>
    <h5>You ({{sortedRadiology.mine.length}})</h5>
  </div>
  <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.mine | filter : filterResult" id="{{test.ref_id}}"> 

    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>
   <section  class="card mb-1 relative p-2" ng-repeat="test in sortedRadiology.others | filter : filterResult" id="{{test.ref_id}}">  
      <div class="mb-1 mt-2">
      <h5>
        <a href="{{j.profile}}" ng-show="j.tests.length > 0">
          {{j.title}} {{j.firstname}} ({{j.tests.length}})
        </a>
      </h5>
      
    </div>
    <div class="clearfix"></div>
    <br>    
    <div>
              <div  style="position: relative;padding-top: 10px">
                <button class="collapsed dropdown-toggle btn btn-sm btn-neutral" role="button" data-toggle="collapse" data-parent="#accordion" href="#{{'test' + test.ref_id + test.test_id}}" aria-expanded="false" aria-controls="collapsefifty">View details</button>
                <span am-time-Ago="test.sent_date" style="position: absolute;top:12px;right: 15px"></span>
            </div>
        <hr>
        <div style="line-height: 25px;margin-bottom:5px" id="{{'test' + test.ref_id + test.test_id}}" class="panel-collapse collapse p-1" role="tabpanel" aria-labelledby="headingfifty">
                  <strong>Center Name: </strong> <span>{{test.center_name}}</span><br>

                  <strong>Center Address: </strong> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                  <strong>Center Phone: </strong> <span>{{test.center_phone}}</span><br>

                  <strong>Referred by:</strong>  <span>{{test.referral_title}} {{test.referral_lastname}} {{test.referral_firstname || "Not specified"}}</span><br>

                  <strong>Reference Number:</strong> : <span>{{(test.copy) ? "Copied!" : test.ref_id}}</span> <a href="" clipboard supported="supported" text="test.ref_id" on-copied="success(test)" on-error="fail(err)" title="{{copy}}" class="fa fa-copy text-danger" style="padding: 5px"> Copy</a><br>

                  <strong>Date requested:</strong> <span>{{test.sent_date | date : "mediumDate"}} ( <span am-time-Ago="test.sent_date" ng-if="test.sent_date"></span> )</span><br>

                  <span ng-if="test.conclusion === 'Pending'"><strong>Status: </strong> <span style="color: red">Awaiting test result</span></span><br>
                <!--<p><strong>Date sent: </strong>{{test.sent_date | date : "mediumDate"}} &nbsp; <strong>Time: </strong>{{test.sent_date | date : "shortTime"}}</p>-->
                <strong>Date received: </strong> {{test.receive_date | date: "mediumDate" || "Pending"}} ( <span am-time-Ago="test.receive_date" ng-if="test.receive_date"></span> )<br>

                <strong>Indication: </strong> <span>{{test.indication}}</span>                  
                
            </div>
           
        <div class="mb-1">
               <h6>Study requested:</h6>
                <br>
                <div ng-repeat="ranTest in test.test_to_run">                   
                  <label class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" ng-model= "ranTest.picked" >
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description"> {{ranTest.name}}</span>
                    </label>         
                </div>
            </div> 
           
        
    </div>    
    
      <br> 
          <div style="line-height: 30px">
            <h6>Report: </h6>
            <div ng-show="test.conclusion !== 'Pending' || test.findings">
              <blockquote>
                <label>Findings:</label>
                <span>{{test.findings || ''}}</span>            
              </blockquote>
              <blockquote>
                <label>Conclusion:</label>
                <span>{{test.conclusion || ''}}</span>
              </blockquote>
              <blockquote>
                <label>Advise:</label>
                <span>{{test.advise || ''}}</span>
              </blockquote>
            </div>
            <p ng-show="test.conclusion === 'Pending' && !test.findings">No report received at this time.</p>

          <!--<div class="relative">
          <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.pdf_report[0].pathname}}" ng-show="test.receive_date" class="btn btn-simple btn-sm text-primary hidden-md-down" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><a href="" ng-show="test.receive_date" ng-click="pdfViewer(test.pdf_report[0].pathname)" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"> <i class="fa fa-file-pdf-o"></i> </a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="{{test.pdf_report[0].pathname}}" ng-show="test.receive_date" title="Download report (PDF)" class="btn btn-simple btn-sm text-primary"><i class="fa fa-download"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>

          <a href="" title="Forward report to someone via email" ng-show="test.receive_date" class="btn btn-sm btn-simple text-primary"><i class="fa fa-share-alt" ng-click="email(test,'Radiology',patientInfo.firstname,patientInfo.lastname,patientInfo.age,patientInfo.gender)"></i></a><span ng-show="test.receive_date">&nbsp;&nbsp;</span>       
          
              <a href="{{'/dicom-mobile?id=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm text-primary hidden-md-up" target="_blank"><i class="fa fa-eye"></i></a><a href="{{'/dcm?id=' + test.patient_id_of_study + '&key=' + test.study_id}}" ng-show="test.patient_id_of_study" class="btn btn-simple btn-sm hidden-md-down text-primary" target="_blank"><i class="fa fa-eye"></i></a>

              <a href="" style="position: absolute;bottom: 0;right: 10px"><i class="fa fa-share btn btn-simple btn-sm text-primary" aria-hidden="true"  title="Forward to another center to re-run test" ng-click="forwardTest(test,'Radiology')"></i></a>
            </div>-->
          </div>
  </section>

</div>

            </div>
          </div>   
        </div>
      </div>
    </script>

      <script type="text/ng-template" id="write-other-procedures-ecase.html">
      <div class="modal fade">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header" style="font-size: inherit;"> 
              <h6>Procedure</h6>        
              <button type="button" class="close" ng-click="close('Cancel')" data-dismiss="modal" aria-hidden="true" style="color:red;font-size: 32px">&times;</button>                                 
            </div>       
            <div class="modal-body"  style="max-height: 1500px;overflow-y: auto;">                
              <div>
               
                      <section>
                         <label class="pb-0 mb-0 font-1-2">{{holdPatientDatails.title}} {{holdPatientDatails.firstname}} {{holdPatientDatails.lastname}}</label><br>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.gender}}</span>
                         <span class="block pb-0 mb-0 font-1_2">{{holdPatientDatails.age}}</span>
                      </section>
                      <br>    
                      <div>
                          <label>Add test *</label>
                      </div>
                      <div ng-repeat="test in TestList">
                           
                           <span class="text-danger">{{invMsg}}</span>
                          <!--<input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                          {{getTest(test.name)}}-->
                          
                          <input type="text" name="other_procedure" class="form-control" ng-model='test.name' placeholder="Test name">
                      
                      </div>
                      <div style="text-align: right">
                          <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                          <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()" ng-show="TestList.length > 1"> </i>
                      </div>        
                      <div>
                          <label>Indication *</label>
                          <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea" required></textarea>
                      </div>
                      <br>
                      <div>
                          <label>Clinical Summary </label>
                          <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                     
                      <div>
                          <label>LMP</label>
                          <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div>
                      <br>
                       <div>
                          <label>Parity</label>
                          <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                      </div> 
                      <br>
                       <div>
                          <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
                          <label>Would you like to pay the bill for the investigation(s)?</label><!--</span> Diagnosis ( Provisional or Final ) </label>--><br>
                        
                          <label class="custom-control custom-radio">
                            Yes
                           <input type="radio" class="custom-control-input" value="Yes" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label> &nbsp;&nbsp;&nbsp;


                          <label class="custom-control custom-radio">
                            No
                           <input type="radio" class="custom-control-input" value="No" ng-model="treatment.referral_pays">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description" style="opacity:0;"></span>
                          </label>  
                      
                      </div>   
                            
                  <section>
                  <hr>
                  <div>       
                      <form ng-submit="findLabs()">
                          <div class="col-md-8 col-sm-8 col-xs-8 pl-0 ml-0">
                              <input type="text" name="" ng-model="city" class="form-control">
                          </div>
                          <div class="col-md-2 col-sm-3 col-xs-3 pl-0 ml-0">
                              <input type="submit" name="" value="Search" class="btn btn-success">
                          </div>
                          <div class="clearfix"></div>
                      </form>
                      <div class="clearfix"></div>
                      <br>
                      <div ng-show="searchResult.length > 2">
                        <input type="text" name="" placeholder=" Filter list by name or address" ng-model="item" class="simple-border">
                      </div>
                      <br>
                      <div ng-repeat='j in searchResult | filter: item' style="position: relative;" class="mb-1">
                        <label class="pb-0 mb-0">{{j.name}}</label><br>
                        <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                        <span>{{j.phone}}</span>
                        <span style="position: absolute;bottom: -5px;right: 5px">
                          <button class="btn btn-sm btn-success" ng-click="sendTest(j)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                        </span>
                      </div>
                      <div ng-repeat='j in searchResult2 | filter: item' style="position: relative;" class="mb-1">
                          <label class="pb-0 mb-0">{{j.name}}</label><br>
                          <span style="display: block;width: 92%">{{j.address}} {{j.city}} {{j.country}}</span>
                          <span>{{j.phone}}</span>
                          <span style="position: absolute;bottom: -5px;right: 5px">
                              <button class="btn btn-sm btn-success" ng-click="sendTest(j,true)" ng-show="!j.isSent">{{(j.loading) ? 'Sending...' : 'Send'}}</button><i class="fa fa-check text-success" ng-show="j.isSent"></i>
                          </span>
                      </div>
                    </div>
                    <div ng-show="loading" class="mt-2" style="text-align: center;">
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange"> </i>
                    </div>
                  </section>
              </div>
            </div>        
          </div> 
        </div>
      </div>
    </script>



    <!--<div class="clearfix"></div>-->
   
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <!--<script type="text/javascript" src="/assets/js/adapter.js"></script>
    <script type="text/javascript" src="/assets/js/rtcClient.js"></script>-->
    <!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js">
    </script>-->
   
    <script src="/assets/js/app.js"></script>
    <script src="/assets/js/now-ui-kit.js"></script>
   
    <script src="/assets/js/ngresource.js"></script>
    <script src="/assets/js/angular-clipboard.js"></script>
    <script src="/assets/js/ui-bootstrap-tpls.js"></script>
     
     <script src="/assets/js/moment.min.js"></script>  
    <script src="/assets/js/angular-moment.min.js"></script>
    <script src="/assets/js/modalService.js"></script>
      <script type="text/javascript" src="/assets/js/charts.js/dist/Chart.min.js"></script>
    <script type="text/javascript" src="/assets/js/angular-chart.js/dist/angular-chart.min.js"></script>
    <script type="text/javascript" src="/assets/js/my-tokbox-video.js"></script>

    
    



    
</body>


</html>