<div style="height:5px"></div>
                
<div class="target" style="position: relative;">
    
    <div class="row">
        
        
        <div class="col-sm-12 col-md-3 col-lg-3 pt-pb">

                <div class="col-sm-12"  style="background:rgba(255,255,255, .8);">
                 <a href="#{{path}}" ng-if="path"><i class="fa fa-arrow-left pt-1 pb-1"></i></a>

             <div class="offset-sm-0 pb-4 pt-4 userpe mb-4"><a href="">
                <img title="profile image" class="profilePic-150" src="{{patientInfo.profile_pic_url}}"></a>
            </div>
             <div>
                <div class="font-1_2" style="margin-top: 10px"><b>{{patientInfo.title}} {{patientInfo.firstname}} {{patientInfo.lastname}}</b>
                </div>
                <div class="pb-1">
                     <sub class="text-muted" style="margin-top:-3px; font-size:1em;">{{patientInfo.age}}</sub><br>
                     <sub class="text-muted" style="margin-top:-3px; font-size:1em;">{{patientInfo.gender}}</sub><br>
                    <!--<sub class="text-muted" style="margin-top:-3px; font-size:1em;">{{patientInfo.body_weight}}</sub><br> -->     
                     <sub class="text-muted" style="margin-top:-3px; font-size:1em;">{{patientInfo.city}} {{patientInfo.country}}</sub>
                 </div>
                 <div>
                     <a href="" class="btn btn-sm btn-danger" ng-click="inviteOnline(patientInfo)">Invite Online</a>
                 </div>
             </div>

            <hr>
 

            <!--left col-->
             <h6> <span>MANAGEMENT</span> </h6>
             <a href="" class="grayish"  ng-click="viewMedicalHistory()" ng-class="{'btn-info': isToSeeRecord}" ><i class="fa fa-medkit text-primary"></i> <span>Medical Record</span> </a>
<a href="" class="grayish" ng-click="viewSession()" ng-class="{'btn-info': isToViewSession}"><i class="fa fa-folder-open text-warning"></i> Treatment Sessions</a>

<a href="" class="grayish" ng-click="writePrescription()" ng-class="{'btn-info': isToPrescribe}"><i class="icon-Pills" style="color: red"></i> Prescription</a>

<a href="" class="grayish" ng-click="viewLabReport()" ng-class="{'btn-info': isToViewLabPrescriptionReq}">
  <i class="fa fa-flask text-info"  style="position:relative">
  </i> Laboratory  
    <!--<span class="tag tag-info pull-right" ng-if="labLen > 0">{{labLen}}</span>-->
</a>

<a href="" class="grayish" ng-click="viewRadioReport()" ng-class="{'btn-info': isToViewLabPrescriptionReq}">
  <i class="fa fa-file-image-o text-info"  style="position:relative">
  </i> Radiology  
    <!--<span class="tag tag-info pull-right" ng-if="labLen > 0">{{labLen}}</span>-->
</a>

<a href="" class="grayish" ng-click="viewLabPrescriptionRequest()" ng-class="{'btn-info': isToViewLabPrescriptionReq}">
	<i class="fa fa-flask text-info"  style="position:relative">
	</i> Other Laboratory  
    <span class="tag tag-info pull-right" ng-if="labLen > 0">{{labLen}}</span>
</a>


<a href="" class="grayish" ng-click="viewRadioPrescriptionRequest()" ng-class="{'btn-info': isToViewRadPrescriptionReq}">
	<i class="fa fa-flask text-warning" style="position:relative" title="Patient recent radiology test for your prescription">
    </i> Other Radiology
    <span class="tag tag-info pull-right" ng-if="radioLen > 0">{{radioLen}}</span>
</a>

<a href="" class="grayish" ng-click="outPatientBilling()" ng-class="{'btn-info': isOutPatientBilling}">
    <i class="fa fa-money text-simple" style="position:relative" title="Bill patient for completed medical care expenses">
    </i> Generate Bill
</a>
<a href="" class="grayish" ng-click="referToAnother()" ng-class="{'btn-info': isOutRefer}">
    <i class="fa fa-user-md text-simple"  style="position:relative" title="Refer this patient to a specialist.">
    </i> Refer to a Specialist
</a>
  </div>
</div>
        


        <div class="col-sm-12 col-md-9 col-lg-9" contenteditable="false">
                       <div class="row">
                          <div class="col-md-12 p-0">
        	<div class="card">
                <div class="top-bar row" style="border-bottom:1px solid rgba(0,0,0,0.2);box-shadow:0px 5px 5px #ccc">
                    <div class="col-md-3 col-sm-3 col-lg-3 col-xs-6" style="display: inline-block;">
                        <!--<button class="btn btn-success btn-sm" style="font-size: 16px" ng-click="chatLive()">
                        <i class="fa fa-comment"></i> </button>&nbsp;&nbsp;&nbsp;-->

                        <span ng-cloak style="font-size: 12px;color: green">{{patientInfo.title}} {{patientInfo.firstname}} is 
                            <em ng-if="typing">{{typing}}</em> 
                            <em ng-if="patientAvailability && !typing" ng-cloak>Online</em>
                            <em ng-if="!patientAvailability" ng-cloak style="color:red">Offline</em>
                        </span>
                    </div>
                    <div class="col-md-9 col-sm-9 col-lg-9" style="text-align: right;">

                         <label for="file-input" class="ick">
                          <i class="fa fa-paperclip" aria-hidden="true"></i>
                        </label><input type="file" class="file-input hide" name="file-input" id="file-input" file-model-chat="files">

                        <a href="" style="padding-left:13px"  class="ick" ng-click="chatLive()" title="chat with {{patientInfo.firstname}}"><i class="fa fa-comment"></i></a>

                        <!--<a class="ick" href="" style="padding-left:10px" title="Add attachment"  ng-click=""><span class="fa fa-paperclip"></span></a>-->

                       
                        <a class="ick" href="" style="padding-left:13px" title="Video chat with {{patientInfo.firstname}}" ng-click="videoRequest('video',patientInfo)"><span class="fa fa-video-camera"></span></a>
                         <a class="ick" href="" style="padding-left:13px" title="Book appointment with {{patientInfo.firstname}}"  ng-click="appointment(patientInfo)"><span class="fa fa-calendar"></span></a>
                        <a class="ick" href="" style="padding-left:13px" title="Delete all chats"  ng-click="deleteChat()"><span class="fa fa-trash-o"></span></a>
                    </div>
                </div>


		<!-- removable div-->
            <div ng-if="isChat || isChat === undefined">
               
                <div class="panel-body msg_container_base bg-default" id="base1" style="height: 420px">

                    <div id="sentmessage1">
                        
                    </div>
                    
                </div>

                
                <form class="panel-footer" ng-submit="sendChat2()">
                    <!--<div style="position: relative;">
                        <input type="file" style="position: absolute;left: 2px;top: 0" id="file" file-model-chat="files">
                    </div>-->
                    <div class=" pb-2" style="position: relative;">
                        <textarea contenteditable="true" class="chat-text-area" ng-model="user.text2"  ng-keypress="getkeys($event)" placeholder="Type a message..." ng-keyup="autoExpand2($event)" id="textarea2" style="box-shadow: none!important;"> <span class="textout" >{{typeMessage}}</span> </textarea>
                        <button type="submit" class="chat-btn btn btn-neutral text-warning"><i class="fa fa-send"></i></button>
                    </div>
                    <div class="clearfix"></div>
                </form>

             
            </div>
    </div>

 <!-- view session-->
<section ng-if="isToViewSession" ng-class="{'transition-background':isTrans}" style="position: relative;">
    <div class="medical-record-Area card p-1"  style="border-top: 1px solid rgba(0,0,0,0.4)">
    <div>
        <h5 style="">Treatment sessions</h5>
    </div>    
    <div class="row">
        <div class="col-md-7 col-lg-7">
            <button ng-click="getInitialComplaint()" class="text-danger btn btn-round btn-simple" style="font-size: 14px">
                View initial complaint
            </button>
            <button ng-click="createNewSession()" class="text-danger btn btn-round btn-simple" style="font-size: 14px">
               Create new session
            </button>
            <hr>
        </div>
        <div class="col-md-5 col-lg-5">
             <!--<a href="" class="text-success btn btn-round btn-simple"  ng-click="writePrescription()"><i class="icon-Pills"></i> Drug</a> &nbsp;&nbsp;-->
        </div>
    </div>

    <h6 class="pl-2"><a href="" ng-click="viewSession()" style="text-decoration: underline!important;"><i class="fa fa-folder-open text-warning"></i> Sessions</a></h6> <br>
    <div>    
    <!--<h6>Most recent</h6>
        <article  style='padding: 10px; cursor:pointer;margin-bottom: 10px;box-shadow: 1px 5px 5px rgba(0,0,0,0.5);color:#fff;position: relative;' class="bg-warning" ng-click="viewTreatmentSession(recentSession)" ng-if="recentSession.diagnosis || recentSession.date">
            <span style="display: block;">{{recentSession.date | date : "mediumDate" }}</span> <span style="padding-left: 20p" ng-bind-html="recentSession.diagnosis.presenting_complain || 'Empty'"></span> <small style="float:right">Last modified: {{recentSession.last_modified | date : "mediumDate"}}</small>
            <button class="btn btn-neutral btn-sm" style="position: absolute;top: 5px; right: 4px" ng-click="viewTreatmentSession(recentSession)">Continue With Treatment</button>
        </article>-->
       
        
        <table class="table-responsiv table no-mobile-item-display" style="width: 100%" ng-if="sessionData.length > 0">
            <thead>
                <th style="width: 20%">Date created</th>
                <th style="width: 45%">Complaint</th>
                <th style="width: 20%">Last modified</th>
                <th style="width: 15%">Action</th>
            </thead>
            <tbody ng-repeat = "session in sessionData" ng-click="viewTreatmentSession(session)" ng-if="session.date">
                <td style="width: 20%">{{session.date | date : "mediumDate" }}</td>
                <td style="width: 45%" ng-bind-html="session.diagnosis.presenting_complain || 'Empty'"></td>
                <td style="width: 20%">{{session.last_modified | date : "mediumDate"}}</td>
                <td style="width: 15%"><button class="btn btn-sm btn-success"  ng-click="viewTreatmentSession(session)">Continue treatment</button></td>
            </tbody>
            
        </table>
        <div class="mobile-item-display">                            
            <table class="table" ng-repeat = "session in sessionData" ng-click="viewTreatmentSession(session)" ng-if="session">
                <thead><th>Date created: </th> <td>{{session.date | date : "fullDate" }}</td></thead>
                <thead><th>Complaint: </th> <td ng-bind-html="session.diagnosis.presenting_complain || 'Empty'"></td></thead>
                <thead><th>Last modified: </th> <td>{{session.last_modified | date : "mediumDate"}}</td></thead>
                <thead><td><button class="btn btn-sm btn-success" style="" ng-click="viewTreatmentSession(session)">Continue treatment</button></thead>
                <hr>
            </table>
           
        </div>
        
        <!--<article ng-repeat = "session in sessionData" ng-click="viewTreatmentSession(session)" style='padding: 10px; cursor:pointer;margin-bottom: 10px;box-shadow: 1px 5px 5px rgba(0,0,0,0.5);color:#fff;position: relative;' class="bg-warning">
            <span style="display: block;">{{session.date | date : "mediumDate" }}</span> <span style="" ng-bind-html="session.diagnosis.presenting_complain || 'Empty'"></span> <small style="float:right">Last modified: {{session.last_modified | date : "mediumDate"}}</small>
            <button class="btn btn-neutral btn-sm" style="position: absolute;top: 5px; right: 4px" ng-click="viewTreatmentSession(session)">Continue With Treatment</button>
        </article>-->
    </div>
  
    <div style="position:absolute;top:150px;left: 300px;text-align: center" ng-if="loading">
        <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px"></i>
    </div>
</div>
</section>


<!--- view all session laboratory requested -->
<section ng-if="isToViewAllSessionLab" class="card p-1">
    <h6>All Laboratory Tests from Sessions</h6>
    <div ng-repeat="test in testResult | orderBy: '-sent_date'" class="pb-1">
          <div ng-if="test.center_name">
             <label class="mt-2 mb-1">Center name: </label> <span>{{test.center_name}}</span><br>
             <label>Address: </label> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span>
          </div>
          <div>
               <strong>Type: </strong> <span>{{test.type}}</span>
          </div>
          <div>
               <strong>Phone: </strong> <span>{{test.center_phone}}</span>
          </div>
          <div> 
            <strong>Date sent: </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
          </div>
          <div>
            <strong>Date received: </strong> {{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span>
          </div><br>
         
          <div>  
            <label>Investigations:</label><br>
            <div class="pl-1" ng-if="test.ranTest.length > 0">
                <span ng-repeat="rantest in test.ranTest" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} </span>
            </div>
            <div class="pl-1" ng-if="test.ranTest.length === 0">
                <span ng-repeat="i in test.test_to_run" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{i.sn}}) </span> {{i.name}} </span>
            </div>                     
          </div>
          <div>
              <strong>Indication: </strong> <span>{{test.indication}}</span>
          </div>
          <div class="pt-1">
              <label>Result:</label><br>
              <p style="margin-top: 50px" ng-if="test.conclusion === 'Pending'">Awaiting investigation reports</p>
              <div ng-if="test.conclusion !== 'Pending'" >
                <!--<div ng-repeat = "result in test.report">                        
                    <strong style="display: block;padding: 5px 15px">{{result.test}}:</strong>
                    <p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>
                </div>-->
                <div>   
                <!--<table class="table">
                    <thead class="bg-info text-white">
                        <th style="width: 19%">Name</th>
                        <th style="width: 18%">TUM</th>
                        <th style="width: 18%">Result</th>
                        <th style="width: 18%">Range</th>
                        <th style="width: 18%">Units</th>
                        <th style="width: 18%">Flag</th>
                    </thead>
                </table>-->
                <!--<strong style="display: block;padding: 5px 15px"></strong>-->
                <!--<p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>-->
                <table class="table" ng-repeat = "result in test.report" ng-if="!result.report">
                     <thead>
                        <th style="width: 19%">Name</th>
                        <th style="width: 18%">TUM</th>
                        <th style="width: 18%">Result</th>
                        <th style="width: 18%">Range</th>
                        <th style="width: 18%">Units</th>
                        <th style="width: 18%">Flag</th>
                    </thead>
                    <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                     <tbody ng-repeat="k in result.report_sheet">
                        <td style="width: 19%">{{k.r_name}}</td>
                        <td style="width: 18%">{{k.r_tum}}</td>
                        <td style="width: 18%">{{k.r_result}}</td>
                        <td style="width: 18%">{{k.r_range}}</td>
                        <td style="width: 18%">{{k.r_unit}}</td>
                        <td style="width: 18%">{{k.r_flag}}</td>
                    </tbody>                              
                </table>
              </div>
              <div style="padding: 5px 5px;word-wrap: break-word;" ng-repeat="result in test.report">               
                <blockquote ng-if="result.report">
                    {{result.report}}
                </blockquote>
              </div>
                <div class="pt-1">
                    <label style="padding: 5px 5px">Conclusion:</label>
                    <blockquote style="padding: 10px;word-wrap: break-word;">{{test.conclusion}}</blockquote>
                </div>
              </div>
          </div>
          
          
        <hr>
      </div>
</section>

<!--- view all session laboratory requested -->
<section ng-if="isToViewAllSessionRadio" class="card p-1">
    <h6>All Radiology Tests from Sessions</h6>
</section>


<!-- view medical record-->
<section ng-if="isToSeeRecord">
    <div class="medical-record-Area card p-1"  style="border-top: 1px solid rgba(0,0,0,0.4);padding-top: 10px">
        <div>
            <h5 class="">Medical Record</h5>
        </div>        
        <div class="btn-group" ng-if="medicalRecordHistory.status">&nbsp;&nbsp;
            <button class="btn btn-success" ng-click="viewDiagnosis()">Medical Reports</button>&nbsp;&nbsp;
            <button class="btn btn-success" ng-click="viewPreviousPrescriptions()">Pharmaceutical</button>&nbsp;&nbsp;
            <button class="btn btn-success" ng-click="viewPreviousRadiology()" >Radiology</button>&nbsp;&nbsp;
            <button class="btn btn-success" ng-click="viewPreviousLaboratory()">Laboratory</button>
        </div>
        <div ng-if="!medicalRecordHistory.status" style="text-align: center">
            <div class="text-danger">{{failureMsg }}</div>
            <div class="text-info">{{successMsg }}</div>
            <strong class="text-muted">Oops! {{medicalRecordHistory.message}}</strong>
            <span style="display: block;">Get Medical Record Access Key (MRAK) from this patient and enter below</span>
            <form>
                <div style="width: 70%;margin:0 auto">
                    <input type="text" name="" class="form-control" placeholder="enter key" ng-model="access.key">
                </div>
                <div>
                    <button class="btn btn-danger" ng-click="getPermission()"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i> {{ (loading) ? "" : "Get permission"}}</button>
                </div>
            </form>
        </div>
        <hr>
        <div ng-if="isDiagnosis">
            <h5 class="p-1">Medical Reports </h5>
             <div class="form-group pl-0">
                <input type="text" name="" class="form-control" placeholder="filter by Disease, Doctor's name, Specialty, Date, etc. " ng-model="filterReport">
            </div>
            <div style="line-height: 30px" ng-repeat="k in medicalRecordHistory.reports | filter : filterReport">
               
                <strong>Re:  </strong> {{patientInfo.title}} {{patientInfo.firstname}} {{patientInfo.lastname}}, {{patientInfo.gender}}, {{patientInfo.age}}<br>
                <strong>Date of report:  </strong> <span>{{k.date | date: "fullDate"}} ( <span am-time-ago="k.date"></span> )</span><br>
                <strong ng-if="k.diagnosis">Diagnosis: </strong> <span ng-if="k.diagnosis" ng-bind-html="k.diagnosis"></span><br>
                <strong>Report: </strong><blockquote style="padding: 0 10px" ng-bind-html="k.report"></blockquote>
                <strong>Written by: 
                    <span style="font-weight: normal;display: block;line-height: 25px"> 
                        <img src="{{k.doctor_profile_pic_url}}" style="max-width: 75px;max-height: 75px;float: left;">
                        <article style="display: inline-block;float: left;padding-left: 10px">
                            <span><b>{{k.doctor_name}}</b></span>
                            <span style="display: block;">{{k.doctor_specialty}}</span>
                            <span>Works at {{k.doctor_work_place}}, {{k.doctor_address}}, {{k.doctor_city}}, {{k.doctor_country}}</span>
                        </article>
                    </span>
                </strong> 
                <div class="clearfix"></div>
                <hr class="bg-warning">
            </div>
        </div> 

        <div ng-if="isPharmacy">
            <h5 class="p-1">Prescription History</h5>
              <div class="form-group pl-0">
                <input type="text" ng-model="search" class="form-control" placeholder="Filter list by drug name, doctor firstname or anything">
            </div>
         
            <div ng-repeat="prescription in prescriptionList | filter: search | orderBy: '-date'" class="table" style="margin-bottom: 20px">
                <div style="">

                    <img ng-src="{{prescription.doctor_profile_pic_url}}" ng-if="prescription.doctor_profile_pic_url" style="width: 72px;height: 72px;float: left;">
                    <div class="side-article">
                        <strong class="text-primary">{{prescription.title}} {{prescription.doctor_firstname}} {{prescription.doctor_lastname}}</strong>
                        <small style="display: block">{{prescription.doctor_specialty}}</small>
                        <small>{{prescription.doctor_work_place}} {{prescription.doctor_address}} {{prescription.doctor_city}} {{prescription.doctor_country}}</small>  <br>
                    
                        <small><b>Date</b>: {{prescription.date | date : "mediumDate"}}</small>
                        <small style=""><b>Diagnosis</b>: {{prescription.provisional_diagnosis || "N/A"}}</small>
                    </div>
                   <div class="clearfix"></div>
                </div>
                
                <table class="table table-hover table-respnsive no-mobile-item-display">
                    <tbody>
                        <th><span>S/N</span></th>
                        <th class="pl-1"><span>Drug name</span></th>
                        <th class="pl-1"><span>Dosage</span></th>
                        <th class="pl-1"><span>Frequency</span></th>
                        <th class="pl-1"><span>Duration</span></th>
                    </tbody>            
                
                    <tbody ng-repeat= "drug in prescription.prescription_body">                             
                        <td >{{drug.sn}}</td>
                        <td class="pl-1">{{drug.drug_name}}</td>
                        <td class="pl-1">{{drug.dosage}}</td>
                        <td class="pl-1">{{drug.frequency}}</td>
                        <td class="pl-1">{{drug.duration}}</td>
                    </tbody>
                </table>
                <div class="mobile-item-display">                            
                    <table class="table" ng-repeat= "drug in prescription.prescription_body">
                        <thead><th>Drug name: </th> <td>{{drug.drug_name}}</td></thead>
                        <thead><th>Dosage: </th> <td>{{drug.dosage}}</td></thead>
                        <thead><th>Frequency: </th> <td>{{drug.frequency}}</td></thead>
                        <thead><th>Duration: </th> <td>{{drug.duration}}</td></thead>
                        <hr>
                    </table>
                </div>
                <hr class="bg-primary">                                 
            </div>                    
        </div>         
        <div ng-if="isRadiology">
            <h5 class="p-1">Radiology History</h5>
            <div class="form-group pl-0">
                <input type="text" ng-model="search" class="form-control" placeholder="Filter list by test name, center name or anything">
            </div>
            <div ng-repeat="test in radiologyTests | filter: search | orderBy: '-sent_date'" class="table card" style="margin-bottom: 20px;">
                  <div>                  
                    <strong class="text-primary">{{test.center_name}}</strong><br>
                    <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                    <span><i class="fa fa-phone"></i> {{test.center_phone}}</span>               
                </div>
                <div>
                    <span><b>Date</b>: {{test.sent_date | date : "mediumDate"}}</span>   
                </div>
                <div>
                    <strong>Indication :</strong> <span>{{test.indication}}</span>
                </div>
                <div>                   
                    <strong>Investigations</strong><br>
                    <ol>
                        <li ng-repeat= "i in test.test_to_run">{{i.name}}</li>
                    </ol>
                   <!--<div>
                         <strong>Report</strong>
                         <div ng-repeat= "i in test.test_to_run" ng-if="i.data">                         
                             <blockquote>
                                <label class="text-muted">{{i.name}} :</label>
                                <span>{{i.data}} </span> 
                                <span ng-if="!i.data">Awaiting report</span>                         
                             </blockquote>
                             
                         </div>
                    </div>-->
                    <!--<div>   
                        <table class="table">
                            <thead class="bg-info text-white">
                                <th style="width: 19%">Name</th>
                                <th style="width: 18%">TUM</th>
                                <th style="width: 18%">Result</th>
                                <th style="width: 18%">Range</th>
                                <th style="width: 18%">Units</th>
                                <th style="width: 18%">Flag</th>
                            </thead>
                        </table>
                      
                        <table class="table" ng-repeat= "result in test.report">
                            <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                            <tbody ng-repeat="k in result.report_sheet">
                                <td style="width: 19%">{{k.r_name}}</td>
                                <td style="width: 18%">{{k.r_tum}}</td>
                                <td style="width: 18%">{{k.r_result}}</td>
                                <td style="width: 18%">{{k.r_range}}</td>
                                <td style="width: 18%">{{k.r_unit}}</td>
                                <td style="width: 18%">{{k.r_flag}}</td>
                            </tbody>                              
                        </table>
                    </div>-->
                    <div>
                        <div ng-repeat= "i in test.test_to_run" ng-if="i.data">                         
                             <blockquote>
                                <label class="text-muted">{{i.name}} :</label>
                                <span>{{i.data}} </span> 
                                <span ng-if="!i.data">Awaiting report</span>                         
                             </blockquote>
                             
                         </div>
                    </div>
                     
                    <div>                         
                        <strong>Conclusion</strong>
                        <blockquote>{{test.conclusion}}</blockquote>
                    </div>

                    <div ng-if="test.files" style="color: blue">
                        attached files {{test.files.length}}
                    </div>
                </div>
                <hr class="bg-primary">                               
            </div>                   
        </div>

        <div ng-if="isLaboratory">
            <h5 class="p-1">Laboratory History</h5>
            <div class="form-group pl-0">
                <input type="text" ng-model="search" class="form-control" placeholder="Filter list by test name, center name or anything">
            </div>
            <div ng-repeat="test in laboratoryTests  | filter: search | orderBy: '-sent_date'" class="table card" style="margin-bottom: 20px">
                <div>                  
                    <strong class="text-primary">{{test.center_name}}</strong><br>
                    <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
                    <span><i class="fa fa-phone"></i> {{test.center_phone}}</span>               
                </div>
                <div>
                    <span><b>Date</b>: {{test.sent_date | date : "mediumDate"}}</span>   
                </div>
                <div>
                    <strong>Indication :</strong> <span>{{test.indication}}</span>
                </div>
                <div>                   
                    <strong>Investigations</strong><br>
                    <ol>
                        <li ng-repeat= "i in test.test_to_run">{{i.name}}</li>
                    </ol>
                    

                    <!--<div>
                         <strong>Report</strong>
                         <div ng-repeat= "i in test.test_to_run" ng-if="i.data">                         
                             <blockquote>
                                <label class="text-muted">{{i.name}} :</label>
                                <span>{{i.data}} </span> 
                                <span ng-if="!i.data">Awaiting report</span>                         
                             </blockquote>
                             
                         </div>
                    </div>-->

                    <div>   
                        <!--<table class="table">
                            <thead class="bg-info text-white">
                                <th style="width: 19%">Name</th>
                                <th style="width: 18%">TUM</th>
                                <th style="width: 18%">Result</th>
                                <th style="width: 18%">Range</th>
                                <th style="width: 18%">Units</th>
                                <th style="width: 18%">Flag</th>
                            </thead>
                        </table>-->
                        <!--<strong style="display: block;padding: 5px 15px"></strong>-->
                        <!--<p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>-->
                        <table class="table" ng-repeat= "result in test.report">
                            <thead class="bg-info text-white">
                                <th style="width: 19%">Name</th>
                                <th style="width: 18%">TUM</th>
                                <th style="width: 18%">Result</th>
                                <th style="width: 18%">Range</th>
                                <th style="width: 18%">Units</th>
                                <th style="width: 18%">Flag</th>
                            </thead>
                            <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                            <tbody ng-repeat="k in result.report_sheet">
                                <td style="width: 19%">{{k.r_name}}</td>
                                <td style="width: 18%">{{k.r_tum}}</td>
                                <td style="width: 18%">{{k.r_result}}</td>
                                <td style="width: 18%">{{k.r_range}}</td>
                                <td style="width: 18%">{{k.r_unit}}</td>
                                <td style="width: 18%">{{k.r_flag}}</td>
                            </tbody>                              
                        </table>
                    </div>
                
                    <div>                         
                        <strong>Conclusion</strong>
                        <blockquote>{{test.conclusion}}</blockquote>
                    </div>

                </div>
                <hr class="bg-primary">                               
                                                    
            </div>                 
        </div>                           
    </div>
</section>


<!-- prescribe -->

<section  ng-if="isToPrescribe">
    <div class="medical-record-Area card p-1 table" style="">
        <div class="col-md-10 pl-0">
             <h5>Write Prescription</h5>            
        </div>  
        <div class="col-md-2">
             <a href="" ng-click="viewSession()"><i class="fa fa-folder-open text-warning"></i> View sessions</a>
        </div> 
        <div class="clearfix"></div>
        <table class="table-respnsive table-striped no-mobile-item-display">       
            <thead>
                <th class="tbm-0">&nbsp;</th>
                <th class="tbm-1"> Drug Name </th>
                <th class="tbm-2"> Dosage </th>
                <th class="tbm-3"> Frequency </th>
                <th class="tbm-4"> Duration </th>
            </thead>
        
            <tbody ng-repeat="prescription in drugList">                                
                <td style="padding-left: 10px" class="tbm-0"><b>{{prescription.sn}}</b></td>
                <!--<td><textarea ng-model="prescription.drug_name" style="max-width: 200px;max-height: 80px"></textarea></td>-->
                <td class="tbm-1"><input  type="text" placeholder="Enter drug name" ng-model="prescription.drug_name" uib-typeahead="drug.name for drug in drugs | filter:$viewValue | limitTo:15" class="form-control">
                </td>
                <td class="tbm-2"><input name="dose" type="text" ng-model="prescription.dosage" placeholder="Enter dosage" class="form-control"></td>
                <!--<td class="tbm-3"><input type="text" ng-model="prescription.frequency" class="form-control"></td>-->
                <td class="tbm-1"><input  type="text" placeholder="Enter frequency" ng-model="prescription.frequency" uib-typeahead="f for f in frequencies | filter:$viewValue | limitTo:15" class="form-control">
                </td>
                <!--<td class="tbm-4"><input type="text" ng-model="prescription.duration" class="form-control"></td>-->
                <td class="tbm-1"><input  type="text" placeholder="Enter duration" ng-model="prescription.duration" uib-typeahead="d for d in durations | filter:$viewValue | limitTo:15" class="form-control" style="">
                </td>
            </tbody>                             
        </table>
        <div class="mobile-item-display">                            
            <table class="table" ng-repeat="prescription in drugList">
                <thead><th>sn: </th> <td>{{prescription.sn}}</td></thead>
                <thead><th>Drug name: </th> <td><input  type="text" placeholder="Enter drug name" ng-model="prescription.drug_name" uib-typeahead="drug.name for drug in drugs | filter:$viewValue | limitTo:15" class="form-control"></td></thead>
                <thead><th>Dosage: </th> <td><input type="text" name="dose" ng-model="prescription.dosage" placeholder="Enter dosage" class="form-control"></td></thead>
                <thead><th>Frequency: </th> <td><input  type="text" placeholder="Enter frequency" ng-model="prescription.frequency" uib-typeahead="f for f in frequencies | filter:$viewValue | limitTo:15" class="form-control"></td></thead>
                <thead><th>Duration: </th> <td><input  type="text" placeholder="Enter duration" ng-model="prescription.duration" uib-typeahead="d for d in durations | filter:$viewValue | limitTo:15" class="form-control" style=""></td></thead>
                <hr class="bg-warning">
            </table>
        </div>
        
        <div style="text-align: right;margin: 10px 0">
            <i class="fa fa-plus btn btn-neutral" style="cursor:pointer; margin-right: 10px" title="Add field" ng-click="addDrug()"></i>
                <i class="fa fa-minus btn btn-neutral" style="cursor:pointer" title="Remove last field" ng-click="removeDrug()"></i>
        </div>
        <div>
            <!--<textarea class="form-control p-1" placeholder="Complain" ng-model="treatment.complain"></textarea>-->
            <label>Instructions / explanations for prescription(s) above (optional)</label><!--</span> Diagnosis ( Provisional or Final ) </label>-->
            <div>
                <textarea class="form-control p-1" name="drug intake guide" placeholder="For eg. Take Ibuprofen only after meals" ng-model="treatment.explanation" ng-keyup="autoExpand($event)" id="textarea"></textarea>
            </div>
        </div>
        <div class="pt-1"> 
            <a href="" ng-click="toPatient()" class="btn btn-info btn-sm"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="loading"></i><i class="fa fa-send" ng-if="!loading"></i> {{(loading) ? '' : ' Patient only'}}</a>
            <a href="" ng-click="toPharmacy()" class="btn btn-info btn-sm"><i class="fa fa-send"></i> Patient / Phamarcy</a>
            <a href="" class="btn btn-neutral btn-sm dropdown-toggle" data-toggle="dropdown" ng-click="viewPreviousPrescriptionByDoctor()">{{(isToViewOldPrescription !== true) ? 'Previous Prescriptions' : 'Close Previous Prescriptions' }}</a>  
        </div>                          
        <div class="clearfix">
          
        </div>
    
    <div ng-if="isToViewOldPrescription" >
    <hr>                   
        <div ng-repeat="prescription in wroteByThisDoctor | orderBy: '-date'" class="table" style="margin-bottom: 20px;padding-left: 0">
            <div style="background-color: d7dde4;font-size: 14px;padding: 0">                   
                <div>
                    <label>Prescribed by:</label>
                    <span style="display: block;">{{prescription.title}} {{prescription.doctor_firstname}} {{prescription.doctor_lastname}}</span>
                    <small style="display: block">{{prescription.doctor_specialty}}</small>                    
                </div>
                <div>
                    <label>Place of Work: </label>
                    <small style="display: block;">{{prescription.doctor_work_place}} {{prescription.doctor_address}} {{prescription.doctor_city}} {{prescription.doctor_country}}</small>  
                                     
                </div>
                <div>
                    <label>Description:</label>
                     <small style="display: block;padding: 10px 0"> {{prescription.explanation || "N/A"}}</small>
                </div>
                <div>
                    <label>Date of Prescription:</label>
                    <small style="display: block;">{{prescription.date | date : "shortDate"}} ( <span am-time-ago="prescription.date"></span> )</small> 
                </div> 
                           
            </div>  
            <table class="table-respnsive no-mobile-item-display">            
                <tbody>
                    <th><strong>S/N</strong></th>
                    <th class="pl-1"><strong>Drug name</strong></th>
                    <th class="pl-1"><strong>Dosage</strong></th>
                    <th class="pl-1"><strong>Frequency</strong></th>
                    <th class="pl-1"><strong>Duration</strong></th>
                </tbody>          
                <tbody ng-repeat= "drug in prescription.prescription_body">                             
                    <td>{{drug.sn}}</td>
                    <td class="pl-1">{{drug.drug_name}}</td>
                    <td class="pl-1">{{drug.dosage}}</td>
                    <td class="pl-1">{{drug.frequency}}</td>
                    <td class="pl-1">{{drug.duration}}</td>
                </tbody>  
            </table>
            <div class="mobile-item-display">                            
                <table class="table" ng-repeat= "drug in prescription.prescription_body">
                    <thead><th>Drug name: </th> <td>{{drug.drug_name}}</td></thead>
                    <thead><th>Dosage: </th> <td>{{drug.dosage}}</td></thead>
                    <thead><th>Frequency: </th> <td>{{drug.frequency}}</td></thead>
                    <thead><th>Duration: </th> <td>{{drug.duration}}</td></thead>
                    <hr>
                </table>
            </div>
            <hr class="bg-primary">                                                  
        </div>                                   
    </div>
</div>
</section>

<section ng-if="isSearchToSend === true" class="medical-record-Area card p-2">
    <a href="" ng-click="goBack()"><i class="fa fa-arrow-left"></i> Back</a> 
    
       <!--<form>
        
           <input type="text" name="city" ng-model="treatment.city" class="form-control" style="width: 30%;display: inline-block;">
           <input type="text" name="country" ng-model="treatment.country" class="form-control" style="width: 30%;display: inline-block;">
           <input type="button" ng-click="changeOption()" class="btn btn-primary" value="search">
       </form>-->

      
      
       <div class="row">
        <section class="col-sm-12 col-md-7 col-lg-7 p-1">
           <form ng-submit="changeOption()">
               <input type="text" ng-model="treatment.city" placeholder="City" class="form-control" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:15" style="display: inline-block;width: 70%">
             
               <input type="submit" class="btn btn-primary btn-sm" value="Search">
           </form>
           <hr>
           <label ng-if="searchResult.length > 0">Choose a center below</label><br>
           <section ng-if="searchResult.length > 5">
                <input type="text" ng-model="filterResult" placeholder="Filter centers" class="form-control">
           </section>
           <!--<div style="overflow-y: auto; max-height: 400px">
               <div ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                   <a href="" ng-click="selected(center)"><b>{{center.name}}</b>
                   <span style="display: block" class="fa fa-globe"> {{center.address}},{{center.city}},{{center.country}}</span></a>
               </div> 
               <div ng-if="isLoading" style="text-align: center;padding-top: 40px">
                   <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="isLoading"></i>
               </div>                              
            </div>-->
            <section ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
               <a href="" ng-click="selected(center)" style="font-weight: 400;color: green"><b>{{center.name}}</b><br><span>{{center.address}},{{center.city}},{{center.country}}</span><br><span>{{center.phone}}</span></a>
            </section>
            <section style="text-align: center;">
            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>   
            </section>                       
        </section>
        
        <section class="col-sm-12 col-md-5 col-lg-5 p-1">
            <h6 style="background-color: #d7dde4;padding: 10px">Selected Center</h6>                            
            <section  style="line-height: 30px;">
                <strong style="display: block;margin-top: 5px;">{{pickedCenter.name}}</strong>
                <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
            </section>
            <p ng-if="!pickedCenter" class="text-danger" style="text-align: center;padding: 10px">none</p>

            <h6 style="padding: 7px;background-color: #d7dde4;padding: 10px">Availability <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></h6>
            
            <a href="" class="p-1" ng-repeat="d in drugList">
                <span style="display: block" ng-class="{'notAvail': d.available === false}"><i class="icon-Pills" style="color: green"></i> <b>{{d.drug_name}}</b> ( {{d.dosage}} ) &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
            </a>
            <div style="padding: 20px;text-align: center;">
                <button class="btn btn-danger form-control" ng-click="sendDrug()" ng-if="pickedCenter"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i> {{(message) ? message : (loading) ? '': 'Send'}}</button>
            </div>
        </section>                             
       </div>                           
   
</section>      




<!-- prescribe based on lab result -->

<section ng-if="isToViewLabPrescriptionReq">
    <h5 class="card p-1">Other Laboratory</h5>
    <div class="medical-record-Area card p-1">
    <section ng-repeat="test in labPrescriptionReq | orderBy: '-date_sent'" style="border-bottom: 1px solid #000; margin-bottom: 10px">
        <span ng-if="test.attended || theAttended.length > 0"  class="sentto">
            Sent to ?
            <ul style="color: green">                           
                <li ng-repeat="i in test.attended || theAttended"><small>{{i.name}} {{i.address}} {{i.city}} {{i.country}} &nbsp; <span am-time-ago="i.date_sent" class="text-info"></span></small></li>
            </ul>
        </span>
        <div style="text-align:center">
            <strong class="font-1_2">{{test.center_name}} </strong>
            <span style="display:block;">{{test.center_address}} {{test.cente_city}} {{test.center_country}}</span>        
            <span style="display: block">{{test.center_phone}}</span>            
        </div>
        <div class="pb-1">
            <strong>Date Requested: </strong> {{test.date_sent | date: 'mediumDate'}} ( <span am-time-ago="test.date_sent" class="text-info"></span> )
        </div>
        <div>
            <strong>Indication: </strong> <span>{{test.indication}}</span>
        </div>
       
         <div class="pb-1">
           <strong>Investigation Result</strong> 
        </div>                   
        <div>                      
            <article> 
                <!--<h6>{{test.name}} :</h6>  
                <p style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{test.data}}</p>-->            
                <div>   
                    <table class="table">
                        <thead>
                            <th style="width: 19%">Name</th>
                            <th style="width: 18%">TUM</th>
                            <th style="width: 18%">Result</th>
                            <th style="width: 18%">Range</th>
                            <th style="width: 18%">Units</th>
                            <th style="width: 18%">Flag</th>
                        </thead>
                    </table>
                    <table class="table" ng-repeat="result in test.test_result">
                        <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                        <tbody ng-repeat="k in result.list">
                            <td style="width: 19%">{{k.r_name}}</td>
                            <td style="width: 18%">{{k.r_tum}}</td>
                            <td style="width: 18%">{{k.r_result}}</td>
                            <td style="width: 18%">{{k.r_range}}</td>
                            <td style="width: 18%">{{k.r_unit}}</td>
                            <td style="width: 18%">{{k.r_flag}}</td>
                        </tbody>                              
                    </table>
                </div>
            </article>
        </div>
        <div>
            <label style="color: darkRed;margin-left: 5px">Conclusion :</label>
            <p style="padding: 5px 5px; background-color: lightyellow;word-wrap: break-word;">{{test.conclusion}}</p>
        </div>
        <div style="text-align: right">
            <i class="fa fa-file-image-o" title="View X-Ray files associated with this test result" ng-if="test.files.length > 0"
            style="font-size:24px;color:rgba(0,150,0,0.9); cursor:pointer;margin:20px 10px" ng-click="viewFile()"></i>&nbsp;&nbsp;
            <!--<i class="icon-Pills icon-style" title="Write prescription based on this test result" style="cursor:pointer" ng-click="prescribe(test)"></i>-->
            <i class="icon-Pills icon-style" title="Write prescription based on this test result" style="cursor:pointer"  ng-click="writePrescription()"></i>&nbsp;&nbsp;
           
            <i class="fa fa-times" title="Delete this request" style="cursor:pointer" ng-click="delete(test)"></i>
        </div>
    </section>
</div>
</section>


 <!-- prescribe based on lab result -->

<section ng-if="isToViewRadPrescriptionReq">
    <h5 class="card p-1">Other Radiology</h5>
    <div class="medical-record-Area card p-1">
    <section ng-repeat="test in radioPrescriptionReq | orderBy: '-date_sent'" style="margin-bottom: 10px" class=" card p-1">
        <span ng-if="test.attended"  class="sentto">
            Sent to ?
            <ul style="color: green">
                <li ng-repeat="i in test.attended || theAttended"><small>{{i.name}} {{i.address}} {{i.city}} {{i.country}} {{i.patient}}&nbsp;  <span am-time-ago="i.date_sent" class="text-danger"></span></small></li>
            </ul>
        </span>
        <div style="text-align:center">
            <strong class="font-1_2">{{test.center_name}} </strong>
            <span style="display:block;">{{test.center_address}} {{test.cente_city}} {{test.center_country}}</span>        
            <span style="display: block">{{test.center_phone}}</span>            
        </div>
        <div class="pb-1">
            <strong>Date Requested: </strong> {{test.date_sent | date: 'mediumDate'}} ( <span am-time-ago="test.date_sent" class="text-info"></span> )
        </div>
        <div>
            <strong>Indication: </strong> <span>{{test.indication}}</span>
        </div>
       
         <div class="pb-1">
           <strong>Findings</strong> 
        </div>            
                          
        <div>                      
            <article ng-repeat="result in test.test_result"> 
                <label>{{result.name}} :</label><br>
                <blockquote style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{result.data}}</blockquote>
            </article>
        </div>
        <div>
            <label style="color: darkRed;margin-left: 5px">Conclusion :</label> 
            <p style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{test.conclusion}}</p>
        </div>
        <div style="text-align: right">
            <i class="fa fa-file-image-o font-1_4 text-primary" title="View files associated with this test result" ng-if="test.files.length > 0"
            style="cursor:pointer;margin:20px 10px 0;float: left;" ng-click="viewFile(test.files,test.test_result)"> {{test.files.length}} file(s)</i>&nbsp;&nbsp;
            <i class="icon-Pills icon-style" title="Write prescription based on this test result" style="cursor:pointer;margin:20px 10px 0" ng-click="writePrescription()"></i>&nbsp;&nbsp;
            <i class="fa fa-times" title="Delete this request" style="cursor:pointer;margin:20px 10px 0" ng-click="delete(test)"></i>
        </div>
    </section>
</div>
</section>


<section ng-if="isToLabReport">
    <h5 class="card p-1">Laboratory <span style="float: right;font-size: 14px"><a href="" ng-click="requestNewLab()" class="btn btn-neutral">{{(!isNewLab) ? 'Request new' : 'View reports'}}</a> <a href="" ng-click="writePrescription()" class="btn btn-neutral">Prescribe</a></span></h5>
    <p ng-if="!testResult || loading" style="text-align: center;padding: 20px;font-size: 18px"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="loading"></i> </p>
    <div class="medical-record-Area" ng-repeat="j in testResult" ng-if="isResults">
   
     <div ng-repeat="test in j.diagnosis.laboratory_test_results | orderBy: '-sent_date'" class="p-1 card" ng-if="j.diagnosis.laboratory_test_results.length > 0">

             <table>
                <tbody>
                    <tr>
                        <td><label>Center Name:</label> </td>
                        <td><h5>{{test.test_ran_by}}</h5></td>
                    </tr>
                    <tr>
                        <td><label>Address:</label> </td>
                        <td>{{test.center_address}} {{test.center_city}} {{test.center_country}}</td>
                    </tr>
                    <tr>
                        <td><label>Contact:</label> </td>
                        <td><label>Phone:</label> {{test.center_phone}}  <label>Email:</label> {{ test.center_email}}</td>
                    </tr>
                      <tr>
                        <td><label>Investigation(s) Requested:</label> </td>
                        <td> <span ng-repeat="rantest in test.test_to_run" style="display: block;padding-top: 3px" >{{rantest.name}} &nbsp;&nbsp;<span ng-if="!rantest.select && test.receive_date != 'Pending'" class="text-danger">not available</span></span> </td>
                    </tr>

                    <tr>
                        <td><label>Date sent:</label> </td>
                        <td>{{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )</td>
                    </tr>
                     <tr>
                        <td><label>Date Received:</label> </td>
                        <td>{{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span></td>
                    </tr>
                    <tr>
                        <td><label>Indication/Summary:</label> </td>
                        <td>
                          <span>{{test.indication || 'N/A'}}</span><br>
                          <span>{{test.clinical_summary || 'N/A'}}</span>
                        </td>
                    </tr>
                  
                    <tr>
                        <td><label>Status:</label> </td>
                        <td>
                            <span ng-if="test.conclusion == 'Pending'" class="text-danger"> Awaiting test result</span>
                            <span ng-if="test.conclusion !== 'Pending'" ng-click="viewReportAndDCM(test)" class="text-primary">Available</span>
                        </td>
                    </tr>
                    <tr ng-if="test.conclusion !== 'Pending'">
                        <td><label>Investigation Report:</label></td>
                        <td> <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.report}}" class="text-primary" target="_blank"><i class="fa fa-file"></i> View test result</a></td>
                    </tr>
                </tbody>
            </table>






         <!--<div style="text-align: center;">
             <label>{{test.test_ran_by}}</label><br>
             <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
             <span>{{test.center_phone}}</span>
          </div>
          <div>
               <strong>Type: </strong> <span>Laboratory Investigation</span>
          </div>
          <div> 
            <strong>Date sent: </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
          </div>
          <div>
            <strong>Date received: </strong> {{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span>
          </div><br>
         
          <div>  
            <label>Investigation Requested:</label><br>
            <div class="pl-1">
                <span ng-repeat="rantest in test.test_to_run" style="display: block;padding-top: 3px" ><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} &nbsp;&nbsp;<span ng-if="!rantest.select && test.receive_date != 'Pending'" class="text-danger">not available</span></span> 
            </div>
            <div class="pl-1" ng-if="test.ranTest.length === 0">
                <span ng-repeat="i in test.test_to_run" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{i.sn}}) </span> {{i.name}} </span>
            </div>                  
          </div>
          <div>
              <strong>Indication: </strong> <span>{{test.indication || 'N/A'}}</span>
          </div>
          <div ng-if="test.lmp">
              <strong>LMP: </strong> <span>{{test.lmp}}</span>
          </div>
          <div ng-if="test.parity">
              <strong>Parity: </strong> <span>{{test.parity}}</span>
          </div>
          <div class="pt-1">
              <label>Result:</label><br>
              <p style="margin-top: 50px" ng-if="test.conclusion === 'Pending'">Awaiting investigation reports</p>
              <div ng-if="test.conclusion !== 'Pending'" >
               
                <div>   
               
                <table class="table" ng-repeat = "result in test.report" ng-if="!result.report">
                     <thead>
                        <th style="width: 19%">Name</th>
                        <th style="width: 18%">TUM</th>
                        <th style="width: 18%">Result</th>
                        <th style="width: 18%">Range</th>
                        <th style="width: 18%">Units</th>
                        <th style="width: 18%">Flag</th>
                    </thead>
                    <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                     <tbody ng-repeat="k in result.report_sheet">
                        <td style="width: 19%">{{k.r_name}}</td>
                        <td style="width: 18%">{{k.r_tum}}</td>
                        <td style="width: 18%">{{k.r_result}}</td>
                        <td style="width: 18%">{{k.r_range}}</td>
                        <td style="width: 18%">{{k.r_unit}}</td>
                        <td style="width: 18%">{{k.r_flag}}</td>
                    </tbody>                              
                </table>
              </div>
              <div style="padding: 5px 5px;word-wrap: break-word;" ng-repeat="result in test.report">               
                <blockquote ng-if="result.report">
                    {{result.report}}
                </blockquote>
              </div>
                <div class="pt-1">
                    <label style="padding: 5px 5px">Conclusion:</label>
                    <blockquote style="padding: 10px;word-wrap: break-word;">{{test.conclusion}}</blockquote>
                </div>
              </div>
          </div>-->
          
          
        <hr>
      </div>
  
    </div>

    <!-- new lab request -->
    <section ng-if="isNewLab" ng-controller="investigationController">
        <div class="p-2 card">
                <section ng-show="!isSearchToSend" class="col-md-10">  
                    <h6>New Laboratory Test </h6><br>
                   
                    <!--<div>
                       <label>Test name: </label>
                    </div>
                    <div ng-repeat="lab in TestList">
                        <label>{{lab.sn}} </label><br>
                        <input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                        {{getTest(test.name)}} 
                    </div>-->
                    <table class="table-striped">
                      <tbody>
                          <tr ng-repeat="lab in TestList">
                            <td style="width: 5%">
                              <label>{{lab.sn}} </label>
                            </td>
                            <td>
                              <input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                              {{getTest(test.name)}} 
                            </td>
                          </tr>
                      </tbody>
                    </table>

                    <div style="text-align: right">
                        <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                            <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()"></i>
                    </div>
                    
                    
                    <div class="pb-1">
                        <label>Indication:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <div class="pb-1">
                        <label>Clinical Summary:</label>
                        <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>LMP:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>Parity:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    
                    
                    <div>
                        <!--<button class="btn btn-success" bg-click="sendToPatient()">to Patient</button>-->
                        <div>
                            <button class="btn btn-success" ng-click="sendToLab()">Continue</button>
                        </div>
                    </div>
                </section>
                <div class="clearfix"></div>
       

                <div ng-if="isSearchToSend" style="margin-top: -15px">                    
                    
                   <a href="" ng-click="goBack()"><i class="fa fa-arrow-left"></i> Back</a> 
                  
                 
                   <section class="row">
                        <section class="col-sm-12 col-md-7 col-lg-7 p-1">
                            <form ng-submit="changeOption()">
                               <input type="text" ng-model="treatment.city" placeholder="City" class="form-control" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:15" style="display: inline-block;width: 70%">
                               <!--<input type="text" name="country" ng-model="treatment.country" placeholder="Country" class="form-control" style="width: 40%;display: inline-block;">-->
                               <input type="submit" class="btn btn-primary btn-sm" value="Search">
                           </form>
                           <hr>
                           <label ng-if="searchResult.length > 0">Choose a center below</label><br>
                           <section ng-if="searchResult.length > 5">
                                <input type="text" name="" ng-model="filterResult" placeholder="Filter centers" class="form-control">
                           </section>
                                                      

                           <section ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                               <a href="" ng-click="selected(center)" style="font-weight: 400;color: green"><b>{{center.name}}</b><br><span>{{center.address}},{{center.city}},{{center.country}}</span></a>
                           </section>
                           <section style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>   
                            </section> 
                            <section ng-show="searchResult.length == 0" style="text-align: center;">
                                <p>No center was found based on search criteria.</p>
                            </section>                        
                            
                        </section>
                        <section class="col-sm-12 col-md-5 col-lg-5 p-1">

                           <h6 style="background-color: #d7dde4;padding: 10px">Selected Center</h6>
                            
                           <section  style="line-height: 30px;">
                                    <strong style="display: block;margin-top: 5px;">{{pickedCenter.name}}</strong>
                                    <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                                    <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
                            </section>
                            <p ng-if="!pickedCenter" class="text-danger" style="text-align: center;padding: 10px">none</p>

                            <h6 style="padding: 7px;background-color: #d7dde4;padding: 10px">Availability <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></h6>
                            
                            <a href="" ng-repeat="d in TestList" style="display: block;margin-top: 10px;padding-left: 5px">
                                <span ng-class="{'notAvail': d.available === false}">{{d.name}} &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
                            </a>

                            <div style="padding: 20px;text-align: center;">
                                <button class="btn btn-success form-control" ng-click="sendTest()" ng-if="pickedCenter"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="isLoading"></i> {{(isLoading) ? "" : (message) ? message : 'Send'}}</button>
                            </div>
                        </section>                              
                   </section>                           
                    
                </div>     
            </div> 
    </section>
</section>

<section ng-if="isToRadioReport">   
    <h5 class="card p-1">Radiology <span style="float: right;font-size: 14px"><a href="" ng-click="requestNewRadio()" class="btn btn-simple">{{(!isNewRadio) ? 'Request new' : 'View reports'}}</a> <a href="" ng-click="writePrescription()" class="btn btn-simple">Prescribe</a></span></h5>

    <p ng-if="!testResult || loading" style="text-align: center;padding: 20px;font-size: 18px"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="loading"></i></p>

     <div class="medical-record-Area" ng-repeat="k in testResult" ng-if="isResults">
         <div ng-repeat="test in k.diagnosis.radiology_test_results | orderBy: '-sent_date'" class="p-1 card" ng-if="k.diagnosis.radiology_test_results.length > 0">

            <table>
                <tbody>
                    <tr>
                        <td>Diagnostic Center Name: </td>
                        <td>{{test.test_ran_by}}</td>
                    </tr>
                    <tr>
                        <td>Address: </td>
                        <td>{{test.center_address}} {{test.center_city}} {{test.center_country}}</td>
                    </tr>
                    <tr>
                        <td>Center Phone: </td>
                        <td>{{test.center_phone}}</td>
                    </tr>
                      <tr>
                        <td>Investigation Requested: </td>
                        <td> <span ng-repeat="rantest in test.test_to_run" style="display: block;padding-top: 3px" >{{rantest.name}} &nbsp;&nbsp;<span ng-if="!rantest.select && test.receive_date != 'Pending'" class="text-danger">not available</span></span> </td>
                    </tr>

                    <tr>
                        <td>Patient ID of Study: </td>
                        <td>{{test.patient_id_of_study || "N/A"}}</td>
                    </tr>

                    <tr>
                        <td>Date sent: </td>
                        <td>{{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )</td>
                    </tr>
                     <tr>
                        <td>Date Received: </td>
                        <td>{{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span></td>
                    </tr>
                    <tr>
                        <td>Indication/Summary: </td>
                        <td><span>{{test.indication || 'N/A'}}</span></td>
                    </tr>
                  
                    <tr ng-if="test.reportDetails.study_link2 !== 'undefined'">
                        <td>DICOM viewer links</td>
                        <td>                          
                           <a href="{{test.reportDetails.study_link_mobile}}" class="text-info">View in Mobile/Tablet devices</a><br>
                           <a href="{{test.reportDetails.study_link2}}" class="text-info">View in Desktop or Laptops</a><br>
                          
                        </td>
                    </tr>
                    <tr>
                        <td>Status: </td>
                        <td>
                            <span ng-if="test.conclusion == 'Pending'" class="text-danger"> Awaiting study report</span>
                            <button class="btn btn-info dropdown-toggle" ng-if="test.conclusion !== 'Pending'" ng-click="viewReportAndDCM(test)">Available, see report</button>
                        </td>
                    </tr>
                    <tr ng-show="test.isReportDCM">
                        <td>Study Report:</td>
                        <td> <a href="{{'https://drive.google.com/viewerng/viewer?embedded=true&url=https://applinic.com' + test.reportDetails.pdf_report[0].pathname}}" class="text-danger" target="_blank"><i class="fa fa-file"></i> View Study Report</a></td>
                    </tr>
                </tbody>
            </table>

             <hr>
         </div>
     <!--<div ng-repeat="test in k.diagnosis.radiology_test_results | orderBy: '-sent_date'" class="p-1 card" ng-if="k.diagnosis.radiology_test_results.length > 0">
          <div style="text-align: center;">
             <label>{{test.test_ran_by}}</label><br>
             <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span><br>
             <span>{{test.center_phone}}</span>
          </div>
          <div>
               <strong>Type: </strong> <span>Radiology Investigation</span>
          </div>
          <div> 
            <strong>Date sent: </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
          </div>
          <div>
            <strong>Date received: </strong> {{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span>
          </div><br>
         
          <div>  
            <label>Investigation Requested:</label><br>
            <div class="pl-1">
                <span ng-repeat="rantest in test.test_to_run" style="display: block;padding-top: 3px" ><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} &nbsp;&nbsp;<span ng-if="!rantest.select && test.receive_date != 'Pending'" class="text-danger">not available</span></span> 
            </div>
          
          </div>
          <div>
              <strong>Indication: </strong> <span>{{test.indication || 'N/A'}}</span>
          </div>
          <div ng-if="test.lmp">
              <strong>LMP: </strong> <span>{{test.lmp}}</span>
          </div>
          <div ng-if="test.parity">
              <strong>Parity: </strong> <span>{{test.parity}}</span>
          </div>
          <div>
              <label>Findings:</label>
          </div>
         

          <div ng-if="test.test_result" ng-if="test.conclusion != 'Pending'">                      
            <article ng-repeat="result in test.test_result"> 
                <label style="color: darkRed">{{result.name}} :</label><br>
                <blockquote style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{result.data}}</blockquote>
            </article>
          </div>
          <div ng-if="test.report" ng-if="test.conclusion != 'Pending'">
            <article ng-repeat="result in test.report"> 
                <label style="color: darkRed;">{{result.name}} :</label><br>
                <blockquote style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{result.report_sheet}}</blockquote>
            </article>
          </div>
          <div ng-if="test.conclusion != 'Pending'">
            <label style="color: darkRed;margin-left: 5px">Conclusion :</label> 
            <p style="padding: 20px; background-color: lightyellow;word-wrap: break-word;">{{test.conclusion}}</p>
          </div>
          <div style="text-align: right">
            <i class="fa fa-file-image-o font-1_4 text-primary" title="View files associated with this test result" ng-if="test.files.length > 0"
            style="cursor:pointer;margin:20px 10px 0;" ng-click="viewFile(test.files,test.test_result)"> {{test.files.length}} file(s)</i>
          </div>
          <div>
            <p ng-if="test.conclusion == 'Pending'" class="text-danger"><b> Awaiting test report</b></p>
          </div>
          
          
        <hr>
      </div>-->
  
    </div>

     <!-- new lab request -->
    <section ng-if="isNewRadio" ng-controller="investigationController">
        <div class="p-2 card">
                <section ng-show="!isSearchToSend" class="col-md-10">  
                    <h6>New Radiology Investigation Request </h6><br>
                   
                    <div>
                       <label>Investigation(s): </label>
                    </div>
                    <table class="table-striped">
                      <tbody>
                          <tr ng-repeat="lab in TestList">
                            <td style="width: 5%">
                              <label>{{lab.sn}} </label>
                            </td>
                            <td>
                              <input  type="text" placeholder="Enter study name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                              {{getTest(test.name)}} 
                            </td>
                          </tr>
                      </tbody>
                    </table>

                    <div style="text-align: right">
                        <i class="fa fa-plus btn btn-neutral" style="font-size:14px;margin-right: 5px;cursor: pointer;" title="Add field" ng-click="addTest()"></i>
                        <i class="fa fa-minus btn btn-neutral" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()"></i>
                    </div>
                    
                    <div>
                        <label>Indication:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <br>
                    <div>
                        <label>Clinical Summary:</label>
                        <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    
                    <div ng-if="patientInfo.gender === 'female'">
                        <label>LMP:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <br>
                    <div ng-if="patientInfo.gender === 'female'">
                        <label>Parity:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>      
                    
                    <div class="mt-1">
                      <div>
                          <button class="btn btn-success" ng-click="sendToRad()">Continue</button>
                      </div>
                    </div>
                </section>

                <div class="clearfix"></div>

                <div ng-if="isSearchToSend" style="margin-top: -15px">                    
                    
                   <a href="" ng-click="goBack()"><i class="fa fa-arrow-left"></i> Back</a> 
                  
                 
                   <section class="row">
                        <section class="col-sm-12 col-md-7 col-lg-7 p-1">
                            <form ng-submit="changeOption()">
                               <input type="text" ng-model="treatment.city" placeholder="City" class="form-control" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:15" style="display: inline-block;width: 70%">
                               <!--<input type="text" name="country" ng-model="treatment.country" placeholder="Country" class="form-control" style="width: 40%;display: inline-block;">-->
                               <input type="submit" class="btn btn-primary btn-sm" value="Search">
                           </form>
                           <hr>
                           <label ng-if="searchResult.length > 0">Choose a center below</label><br>
                           <section ng-if="searchResult.length > 5">
                                <input type="text" name="" ng-model="filterResult" placeholder="Filter centers" class="form-control">
                           </section>
                                                      

                           <section ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                               <a href="" ng-click="selected(center)" style="font-weight: 400;color: green"><b>{{center.name}}</b><br><span>{{center.address}},{{center.city}},{{center.country}}</span></a>
                           </section>
                           <section style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>   
                            </section>                          
                            
                        </section>
                        <section class="col-sm-12 col-md-5 col-lg-5 p-1">

                           <h6 style="background-color: #d7dde4;padding: 10px">Selected Center</h6>
                            
                           <section  style="line-height: 30px;">
                                    <strong style="display: block;margin-top: 5px;">{{pickedCenter.name}}</strong>
                                    <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                                    <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
                            </section>
                            <p ng-if="!pickedCenter" class="text-danger" style="text-align: center;padding: 10px">none</p>

                            <h6 style="padding: 7px;background-color: #d7dde4;padding: 10px">Availability <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></h6>
                            
                            <a href="" ng-repeat="d in TestList" style="display: block;margin-top: 10px;padding-left: 5px">
                                <span ng-class="{'notAvail': d.available === false}">{{d.name}} &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
                            </a>

                            <div style="padding: 20px;text-align: center;">
                                <button class="btn btn-success form-control" ng-click="sendTest()" ng-if="pickedCenter"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="isLoading"></i> {{(isLoading) ? "" : (message) ? message : 'Send'}}</button>
                            </div>
                        </section>                              
                   </section>                           
                    
                </div>     
            </div> 
    </section>
  
</section>


<section ng-if="isTreatmentSession" ng-controller="inTreatmentController">
    <div class="medical-record-Area card p-1">
        <div style="position: relative;">
             <h5>Treatment Session <small style="float: right;font-size: 14px"> <span am-time-ago="sessionData.last_modified"></span></small></h5>
             
        </div>
        <div class="row">
          <!-- <span style="font-size:1.2em; font-weight:300;">This session was intiated on {{sessionData.date | date : "mediumDate"}}, <br> Through <b>{{sessionData.typeOfSession}}</b></span>-->
           <!--<button class="btn btn-simple" ng-click="clerk()" ng-class="{'bg-info text-white': true}">clerking</button> -->
          
            <a href="" ng-click="viewSession()"><i class="fa fa-arrow-left"></i> Back to sessions</a>  &nbsp;&nbsp; 
                <br><br>     
            <div class="col-md-6 col-lg-6">  
              
               <button class="btn btn-simple btn-round  btn-sm" ng-click="FollowUpsView()" ng-class="{'bg-info text-white': (isMain || isSubView)}" style="font-size:16px">Previous Consultation(s)</button>&nbsp;&nbsp;  

               <button class="btn btn-simple btn-round  btn-sm text-danger" ng-click="subSession()" ng-class="{'bg-info text-white': isSubNote}" style="font-size: 16px">Continue</button>
           </div>

           <div class="col-md-6 col-lg-6">
                 <a href="" class="text-success btn btn-round btn-simple"  ng-click="writePrescription()"><i class="icon-Pills"></i> Prescribe</a>&nbsp;&nbsp;
                  <a href="" class="text-success btn btn-round btn-simple" ng-click="laboratory()"><i class="fa fa-flask"></i> Laboratory</a>&nbsp;&nbsp;
                 <a href="" class="text-success btn btn-round btn-simple" ng-click="radiology()"><i class="fa fa-file-image-o"></i> Radiology</a>
           </div>

           
           <!--<button class="btn btn-simple" ng-click="reportView()" ng-class="{'bg-info text-white': isReportView}">Write Report</button>-->
        </div>
      
        <hr>
        <div style="padding-top: 10px" ng-if="isFollowups || isMain">
            <a href="" ng-repeat="j in sessionData.diagnosis.sub_session" style="">
                <button  class="btn btn-simple btn-sm btn-round"  ng-class="{'bg-info text-white': j.status}" ng-click="sub(j,sessionData.diagnosis.sub_session)">{{(j.sub_session_id === 'main') ? 'Initial Clerking' : 'Consultation on'}} <span ng-if="!j.date"> {{ sessionData.date | date : "fullDate" }}  </span><span ng-if="j.date"> {{ j.date | date : 'fullDate'}} </span></button>
            </a>
        </div>
        <div ng-if="isSubNote">
           <button class="btn btn-success" ng-click="takeNote()" ng-class="{'bg-info text-white': isNote}">Continuation Sheet</button>
            <button class="btn btn-success" ng-click="peView()" ng-class="{'bg-info text-white': isPE}">Physical Examination</button>

           <button class="btn btn-success" ng-click="investView()" ng-class="{'bg-info text-white': isInvestigation}"> Request Investigation</button>
          
          
        </div>
        <form ng-if="isClerk">
            <div ng-if="isMain">
                <div>
                    <label>Initial Clerking on {{ sessionData.date | date : "fullDate" }}</label>
                </div>
                <hr>
                <div class="col-md-12  col-sm-12 col-xs-12 form-group">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Complaint </div> 
                        <div class="col-sm-3 text-right">
                            <button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                            data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                            </button>
                        </div>
                    </label>
                    <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.presenting_complain">
                        
                    </span>
                   
                   <div class="collapse" id="collapseExample">
                      <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.presenting_complain" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                </div>


                <div class="col-md-12 col-sm-12 col-xs-12 form-group" style="display:inline-block !important;">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">History of the Complaint </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#historu" aria-expanded="false" aria-controls="collapseExample" ng-click = "setHistory()">
                  </button></div></label>
                   <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.history_of_presenting_complain">
                     </span>
                   <div class="collapse" id="historu">
                      <textarea class="form-control inc-height" placeholder="Write.." ng-model="sessionData.diagnosis.history_of_presenting_complain" ng-keyup="autoExpand($event)" id="textarea"></textarea >
                  </div>
                </div>

                 <div class="col-md-12 col-sm-12 col-xs-12 form-group">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Past Medical / Surgical History </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#past" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                  <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.past_medical_history">
                       
                </span>
                   <div class="collapse" id="past">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.past_medical_history" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div>

                  <div class="col-md-12 col-sm-12 col-xs-12 form-group">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Drug History </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#drug" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                   <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.drug_history">
                       
                    </span>
                   <div class="collapse" id="drug">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.drug_history" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div>


                  <div class="col-md-12 col-sm-12 col-xs-12 form-group mb-3">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Social History </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#social" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                   <div class="clearfix">              
                    <span ng-bind-html="sessionData.diagnosis.social_history">
                    </span>
                   <div class="collapse" id="social">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.social_history" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div> 
                  </div>


                  <div class="col-md-12 col-sm-12 col-xs-12 form-group mb-3">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Family History </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#family" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                  <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.family_history">
                       
                    </span>
                   <div class="collapse" id="family">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.family_history" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div>


                  <div class="col-md-12 col-sm-12 col-xs-12 form-group mb-3">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Summary </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#summary" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                   <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.summary">
                       
                    </span>
                   <div class="collapse" id="summary">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.summary" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div>

                   <div class="clearfix"></div>
                  <div class="col-md-12 col-sm-12 col-xs-12 form-group mb-3">
                    <label class="col-md-12 p-0" style="display:block;" for="firstname">
                        <div class="col-sm-9 p-0 pull-left"  style="font-size:1.2em; font-weight:500;">Provisional Diagnosis </div> 

                    <div class="col-sm-3 text-right"><button class="btn btn-simple btn-sm  pull-right fa fa-pencil" type="button" data-toggle="collapse" 
                    data-target="#provisional" aria-expanded="false" aria-controls="collapseExample">
                  </button></div></label>
                   <div class="clearfix"></div>               
                    <span ng-bind-html="sessionData.diagnosis.provisional_diagnosis">                       
                    </span>
                   <div class="collapse" id="provisional">
                        <textarea class="form-control inc-height" placeholder="Write.." ng-model="edit.provisional_diagnosis" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                  </div>
              </div>

              <div class="form-group" ng-if="isNote">                   
                   <label for="firstname">Take note: </label><br>
                   <textarea class="form-control" placeholder="Write..." ng-model="edit.sub_note" ng-keyup="autoExpand($event)" id="textarea"></textarea>          
              </div>
              
              <div class="clearfix"></div>
              <!--physical examination-->
               <!--<h5 class="" style="font-weight:300;">Physical Examination Entry</h5>-->
              <div ng-if="!isMain && isPE" class="pl-0"> <!-- break by ng if-->
                  <div class="col-md-12  col-sm-12 col-xs-12 form-group">
                  <!--<h5 class="" style="font-weight:300;">Physical Examination Entry</h5><br>-->
                    <label for="firstname"> General Examination:</label><br>
                    <blockquote ng-bind-html="sessionData.diagnosis.general_examination" class="pt-0"></blockquote>
                  <textarea class="form-control" placeholder="Write.." ng-model="edit.general_examination" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>

                  <div class="col-md-12  col-sm-12 col-xs-12 form-group">
                    <label for="firstname"> Systemic Examination:</label><br>
                    <blockquote ng-bind-html="sessionData.diagnosis.systemic_examination" class="pt-0"></blockquote>
                    <textarea class="form-control" placeholder="Write.."  ng-model="edit.systemic_examination" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>

                   <div class="col-md-12  col-sm-12 col-xs-12 form-group">
                    <label for="firstname">Diagnosis:</label><br>
                    <blockquote ng-bind-html="sessionData.diagnosis.final_diagnosis" class="pt-0"></blockquote>
                    <textarea class="form-control" placeholder="Write.." ng-model="edit.final_diagnosis" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>
                          
              </div>
               <div class="col-md-12  col-sm-12 col-xs-12 form-group" ng-if="!isMain && isReportView"> <!-- break by ng if-->
                <i class="fa fa-times p-2 text-muted" style="float: right;font-size: 18px;" ng-click="close()"></i>
                <!--<label>Final Diagnosis:</label>
                <span ng-bind-html="sessionData.diagnosis.final_diagnosis"></span>
                <input type="text" ng-model="edit.final_diagnosis" placeholder="Write..." class="form-control"><br>-->
                <h6>Write report based on overall findings below:</h6>
                <span ng-bind-html="sessionData.diagnosis.medical_report"></span>
                <textarea class="form-control" placeholder="Write.."  ng-model="edit.medical_report" ng-keyup="autoExpand($event)" id="textarea"></textarea><br>

                 <button ng-click="saveChanges()" ng-if="isChanges" class="btn btn-primary"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i>{{(loading) ? "" : "Save changes"}}</button>&nbsp;&nbsp;
                <i class="fa fa-check  text-success" style="font-size: 18px" ng-if="updateMsg"> {{updateMsg}}</i>
              </div>         
              <hr>
               <div ng-if="isSubView"> <!-- break by ng if-->
                  <label class="mr-2">Consultation on {{subRecord.date | date : "fullDate"}} 
                   
                  </label> <a href="" ng-if="!medReport.report" class="btn btn-success btn-sm" ng-click="reportView()" style="font-size: 14px"> &nbsp;<i class="fa fa-pencil"></i> Write medical report</a>
                  
                  <hr>
                  <div>
                      <label>Note:</label>
                      <blockquote ng-bind-html="subRecord.note" class="pt-0"></blockquote>
                  </div>

                 
                  <div>
                      <label>General Examination:</label>
                      <blockquote ng-bind-html="subRecord.general" class="pt-0"></blockquote>
                  </div>
                  <div>
                      <label>Systemic Examination:</label>
                      <blockquote ng-bind-html="subRecord.systemic" class="pt-0"></blockquote>
                  </div>
                  <div>
                      <label>Diagnosis:</label>
                      <blockquote ng-bind-html="subRecord.diagnosis" class="pt-0"></blockquote>
                  </div>
                  <div>
                    <label ng-if="subTests">Investigation Requested: </label>             
                    <div ng-repeat="test in subTests | orderBy: '-sent_date'" class="pt-1">
                      <div style="" ng-if="test.center_name">
                         <strong> Center name : </strong>{{test.center_name}}                          
                      </div>

                      <div style="" ng-if="test.center_name">
                         <strong> Type : </strong>{{test.type || "Laboratory"}}                          
                      </div>
                    
                      <div ng-if="test.center_name">
                         <strong> Address : </strong> {{test.center_address}} {{test.center_city}} {{test.center_country}}   
                      </div>                  
                    
                      <div ng-if="test.center_name">
                          <strong>Center phone number : </strong> {{test.center_phone}}
                      </div>
                      
                      <div> 
                        <strong>Date sent : </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
                      </div>
                    
                      <div>
                        <strong>Date received : </strong> {{test.receive_date | date: "mediumDate"}} ( <span am-time-ago="test.receive_date"></span> )
                      </div>
                     <br>
                    
                      <div>  
                        <label>Investigation(s): </label> 
                        <div class="pl-1" ng-if="test.ranTest.length > 0">
                            <span ng-repeat="rantest in test.ranTest" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} </span>
                        </div>
                        <ol class="pl-2" ng-if="test.ranTest.length === 0">
                            <li ng-repeat="i in test.test_to_run" style="padding: 3px 4px"><span ng-if="rantest.sn"> {{i.sn}}) </span> {{i.name}} </li>
                        </ol>           
                      </div>
                      <div>
                           <label>Indication: </label> <span>{{test.indication}}</span> <br>  
                      </div>
                      <div class="pt-1">
                          <label>Findings:</label>
                      </div>
                     
                      <div ng-if="test.conclusion !== 'Pending'" >
                          <div ng-if="test.type !== 'radiology'">   
                            <!--<table class="table">
                               
                            </table>-->
                            <!--<strong style="display: block;padding: 5px 15px"></strong>-->
                            <!--<p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>-->
                            <table class="table" ng-repeat = "result in test.report" ng-if="!result.report">
                                <thead class="bg-info text-white">
                                    <th style="width: 19%">Name</th>
                                    <th style="width: 18%">TUM</th>
                                    <th style="width: 18%">Result</th>
                                    <th style="width: 18%">Range</th>
                                    <th style="width: 18%">Units</th>
                                    <th style="width: 18%">Flag</th>
                                </thead>
                                <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                                 <tbody ng-repeat="k in result.report_sheet">
                                    <td style="width: 19%">{{k.r_name}}</td>
                                    <td style="width: 18%">{{k.r_tum}}</td>
                                    <td style="width: 18%">{{k.r_result}}</td>
                                    <td style="width: 18%">{{k.r_range}}</td>
                                    <td style="width: 18%">{{k.r_unit}}</td>
                                    <td style="width: 18%">{{k.r_flag}}</td>
                                </tbody>                              
                            </table>
                          </div>
                          <div style="padding: 10px 20px;word-wrap: break-word;" ng-repeat="result in test.test_to_run" ng-if="test.type === 'radiology'">                                                      
                            <blockquote ng-if="result.data">
                                <label style="padding: 5px 5px;" class="text-muted">{{result.name}} :</label> {{result.data}}
                            </blockquote>
                          </div>
                          <div class="pt-1">
                            <label style="padding: 5px 5px;color: darkRed">Conclusion:</label>
                            <blockquote style="padding: 10px 20px;word-wrap: break-word;">{{test.conclusion}}</blockquote>
                          </div>
                      </div>
                      <p style="padding: 10px 20px " ng-if="test.conclusion === 'Pending'">Awaiting investigation report.</p>
                      <div ng-if="test.files">
                          <strong> <i class="fa fa-file-o"></i> {{test.files.length}} files  attached&nbsp;&nbsp;&nbsp; <a href="" ng-if="test.files.length > 0">view</a></strong>
                      </div>
                        <hr class="text-muted">
                    </div>
                  </div>
                  <div ng-if="medReport.report">
                      <label>Medical Report:</label>
                      <blockquote ng-bind-html="medReport.report" class="pt-0"></blockquote>
                  </div>
                  

                  <!--<div form-group" ng-if="isReportView"> 
                   
                    <label>Final Diagnosis:</label>
                    <span ng-bind-html="sessionData.diagnosis.final_diagnosis"></span>
                    <input type="text" ng-model="edit.final_diagnosis" placeholder="Write..." class="form-control"><br>
                    <label>Write report based on overall findings:</label>
                    <span ng-bind-html="sessionData.diagnosis.medical_report"></span>
                    <textarea class="form-control" placeholder="Write.." style="height: 300px" ng-model="edit.medical_report" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                  </div>-->     
                  <div ng-if="loading">
                      <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange" ng-if="loading"></i>
                  </div>
               </div>     

               <div style="text-align: right; margin: 20px 20px 0 0;" ng-if="!isSubView">
                <button ng-click="saveChanges()" ng-if="isChanges" class="btn btn-primary"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i>{{(loading) ? "" : "Save changes"}}</button>&nbsp;&nbsp;
                <i class="fa fa-check  text-success" style="font-size: 18px" ng-if="updateMsg"> {{updateMsg}}</i>
              </div>
            </form>

           
            <div class="clearfix"></div>
           

            <div ng-if="isInvestigation" style="margin-top:-10px">             
                <h6>Investigation</h6>
                <button class="btn btn-simple text-danger btn-sm btn-round"  ng-click="newLab()"><i class="fa fa-pencil"></i> New Laboratory Request</button>
                <button class="btn btn-simple text-danger btn-sm btn-round"  ng-click="newRadio()" style="margin-right: 5px"><i class="fa fa-pencil"></i> New Radiology Request</button>
                <a href="" class="btn btn-simple text-danger btn-sm btn-round" ng-click="laboratory()">Previous Laboratory</a>
                <a href="" class="btn btn-simple text-danger btn-sm btn-round" ng-click="radiology()">Previous Radiology</a>
                <hr>
            </div>


            <div class="p-2" ng-if="isLab && !isSubView">
                <h6>Laboratory Report(s)</h6>
                 <div ng-repeat="test in testResult | orderBy: '-sent_date'" class="pb-1">
                      <div ng-if="test.center_name">
                         <label class="mt-2 mb-1">Center name: </label> <span>{{test.center_name}}</span><br>
                         <label>Address: </label> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span>
                      </div>
                      <div>
                           <strong>Type: </strong> <span>{{test.type}}</span>
                      </div>
                      <div>
                           <strong>Phone: </strong> <span>{{test.center_phone}}</span>
                      </div>
                      <div> 
                        <strong>Date sent: </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
                      </div>
                      <div>
                        <strong>Date received: </strong> {{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span>
                      </div><br>
                     
                      <div>  
                        <label>Investigations:</label><br>
                        <div class="pl-1" ng-if="test.ranTest.length > 0">
                            <span ng-repeat="rantest in test.ranTest" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} </span>
                        </div>
                        <div class="pl-1" ng-if="test.ranTest.length === 0">
                            <span ng-repeat="i in test.test_to_run" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{i.sn}}) </span> {{i.name}} </span>
                        </div>                     
                      </div>
                      <div>
                          <strong>Indication: </strong> <span>{{test.indication}}</span>
                      </div>
                      <div class="pt-1">
                          <label>Result:</label><br>
                          <p style="margin-top: 50px" ng-if="test.conclusion === 'Pending'">Awaiting investigation reports</p>
                          <div ng-if="test.conclusion !== 'Pending'" >
                            <!--<div ng-repeat = "result in test.report">                        
                                <strong style="display: block;padding: 5px 15px">{{result.test}}:</strong>
                                <p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>
                            </div>-->
                            <div>   
                            <!--<table class="table">
                                <thead class="bg-info text-white">
                                    <th style="width: 19%">Name</th>
                                    <th style="width: 18%">TUM</th>
                                    <th style="width: 18%">Result</th>
                                    <th style="width: 18%">Range</th>
                                    <th style="width: 18%">Units</th>
                                    <th style="width: 18%">Flag</th>
                                </thead>
                            </table>-->
                            <!--<strong style="display: block;padding: 5px 15px"></strong>-->
                            <!--<p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>-->
                            <table class="table" ng-repeat = "result in test.report" ng-if="!result.report">
                                 <thead class="bg-info text-white">
                                    <th style="width: 19%">Name</th>
                                    <th style="width: 18%">TUM</th>
                                    <th style="width: 18%">Result</th>
                                    <th style="width: 18%">Range</th>
                                    <th style="width: 18%">Units</th>
                                    <th style="width: 18%">Flag</th>
                                </thead>
                                <caption style="caption-side: top;color:darkRed">{{result.name}}:</caption>
                                 <tbody ng-repeat="k in result.report_sheet">
                                    <td style="width: 19%">{{k.r_name}}</td>
                                    <td style="width: 18%">{{k.r_tum}}</td>
                                    <td style="width: 18%">{{k.r_result}}</td>
                                    <td style="width: 18%">{{k.r_range}}</td>
                                    <td style="width: 18%">{{k.r_unit}}</td>
                                    <td style="width: 18%">{{k.r_flag}}</td>
                                </tbody>                              
                            </table>
                          </div>
                          <div style="padding: 5px 5px;word-wrap: break-word;" ng-repeat="result in test.report">               
                            <blockquote ng-if="result.report">
                                {{result.report}}
                            </blockquote>
                          </div>
                            <div class="pt-1">
                                <label style="padding: 5px 5px">Conclusion:</label>
                                <blockquote style="padding: 10px;word-wrap: break-word;">{{test.conclusion}}</blockquote>
                            </div>
                          </div>
                      </div>
                      
                      
                    <hr>
                  </div>
            </div>


            <div class="p-2" ng-if="isScan && !isSubView">
                <h6>Radiology Report(s)</h6>                
                  <div ng-repeat="test in testResult | orderBy: '-sent_date'" class="pb-1">
                      <div ng-if="test.center_name">
                         <label class="mt-2 mb-1">Center name: </label> <span>{{test.center_name}}</span><br>
                         <label>Address: </label> <span>{{test.center_address}} {{test.center_city}} {{test.center_country}}</span>
                      </div>
                      <div>
                          <strong> Type: </strong> <span>{{test.type}}</span>
                      </div>
                      <div>
                           <strong>Phone: </strong> <span>{{test.center_phone}}</span>
                      </div>
                      <div> 
                        <strong> Sent: </strong> {{test.sent_date | date: "mediumDate"}} ( <span am-time-ago="test.sent_date"></span> )
                      </div>
                      <div>
                        <strong>Date received: </strong> {{test.receive_date | date: "mediumDate"}} <span ng-if="test.receive_date !== 'Pending'">( <span am-time-ago="test.receive_date"></span> )</span>
                      </div><br>
                      <div>  
                        <label>Investigation: </label> <br>
                        <div class="pl-1" ng-if="test.ranTest.length > 0">
                            <span ng-repeat="rantest in test.ranTest" style="display: block;padding-top: 3px"><span ng-if="rantest.sn"> {{rantest.sn}}) </span> {{rantest.name}} </span>
                        </div>
                        <ol class="pl-2" ng-if="test.ranTest.length === 0">
                            <li ng-repeat="i in test.test_to_run" style="padding: 3px 4px"><span ng-if="rantest.sn"> {{i.sn}}) </span> {{i.name}} </li>
                        </ol>           
                      </div><br>
                      <div>
                          <strong>Indication: </strong> <span>{{test.indication}}</span>
                      </div>
                      <div class="pt-1">
                          <label>Result: </label><br>
                          <p style="margin-top: 50px" ng-if="test.conclusion === 'Pending'">Awaiting investigation reports</p>
                          <div ng-if="test.conclusion !== 'Pending'" >
                            <!--<div ng-repeat = "result in test.report">                        
                                <strong style="display: block;padding: 5px 15px">{{result.test}}:</strong>
                                <p style="padding: 10px 20px;word-wrap: break-word;">{{result.report}}</p>
                            </div>-->
                          
                         <div style="padding: 10px 20px;word-wrap: break-word;" ng-repeat="result in test.test_to_run">                                                  
                            <blockquote ng-if="result.data">
                                <label style="padding: 5px 5px" class="text-muted">{{result.name}} :</label> {{result.data}}
                            </blockquote>
                          </div>
                          <div class="pt-1">
                                <label style="padding: 5px 15px">Conclusion:</label>
                                <p style="padding: 10px 20px;word-wrap: break-word;">{{test.conclusion}}</p>
                            </div>
                          </div>
                      </div>
                      <!--<p style="padding: 10px 20px " ng-if="test.conclusion === 'Pending'">Awaiting investigation report.</p>-->
                      <div ng-if="test.conclusion !== 'Pending'">
                          <strong> <i class="fa fa-file-o"></i> {{test.files.length}} image files &nbsp;&nbsp;&nbsp; <a href="" ng-if="test.files.length > 0">view</a></strong>
                      </div>
                   
                  </div>
                    
                <!--<p ng-if="test.conclusion">{{}} center name and info here</p>-->
                <!--<button class="btn btn-info" ng-if="isScan" ng-click="newScan()">New lab test</button>-->
                <!--<button class="btn btn-info" ng-click="other()" ng-click="ECG()">Request for a other test </button>-->
            </div>

            <div class="p-2" ng-if="isNewLab && !isSubView" ng-controller="investigationController">
                <section ng-show="!isSearchToSend">  
                    <h6>New Laboratory Test </h6><br>
                   
                    <div>
                       <label>Test name: </label>
                    </div>
                    <div ng-repeat="lab in TestList">
                        <label>{{lab.sn}} </label><br>
                        <input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                        {{getTest(test.name)}} 
                    </div>

                    <div style="text-align: right">
                        <i class="fa fa-plus" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"> Add</i>
                            <i class="fa fa-minus" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()"> Remove</i>
                    </div>
                    
                    <div>
                        <label>Indication:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <div>
                        <label>Clinical Summary:</label>
                        <textarea placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>LMP:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>Parity:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    
                    
                    <div>
                        <!--<button class="btn btn-success" bg-click="sendToPatient()">to Patient</button>-->
                        <div>
                            <button class="btn btn-success" ng-click="sendToLab()">Continue</button>
                        </div>
                    </div>
                </section>

       

                <div ng-if="isSearchToSend" style="margin-top: -15px">                    
                    
                   <a href="" ng-click="goBack()"><i class="fa fa-arrow-left"></i> Back</a> 
                  
                 
                   <section class="row">
                        <section class="col-sm-12 col-md-7 col-lg-7 p-1">
                            <form ng-submit="changeOption()">
                               <input type="text" ng-model="treatment.city" placeholder="City" class="form-control" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:15" style="display: inline-block;width: 70%">
                               <!--<input type="text" name="country" ng-model="treatment.country" placeholder="Country" class="form-control" style="width: 40%;display: inline-block;">-->
                               <input type="submit" class="btn btn-primary btn-sm" value="Search">
                           </form>
                           <hr>
                           <label ng-if="searchResult.length > 0">Choose a center below</label><br>
                           <section ng-if="searchResult.length > 5">
                                <input type="text" name="" ng-model="filterResult" placeholder="Filter centers" class="form-control">
                           </section>
                                                      

                           <section ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                               <a href="" ng-click="selected(center)" style="font-weight: 400;color: green"><b>{{center.name}}</b><br><span>{{center.address}},{{center.city}},{{center.country}}</span></a>
                           </section>
                           <section style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>   
                            </section>                          
                            
                        </section>
                        <section class="col-sm-12 col-md-5 col-lg-5 p-1">

                           <h6 style="background-color: #d7dde4;padding: 10px">Selected Center</h6>
                            
                           <section  style="line-height: 30px;">
                                    <strong style="display: block;margin-top: 5px;">{{pickedCenter.name}}</strong>
                                    <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                                    <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
                            </section>
                            <p ng-if="!pickedCenter" class="text-danger" style="text-align: center;padding: 10px">none</p>

                            <h6 style="padding: 7px;background-color: #d7dde4;padding: 10px">Availability <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></h6>
                            
                            <a href="" ng-repeat="d in TestList" style="display: block;margin-top: 10px;padding-left: 5px">
                                <span ng-class="{'notAvail': d.available === false}">{{d.name}} &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
                            </a>

                            <div style="padding: 20px;text-align: center;">
                                <button class="btn btn-success form-control" ng-click="sendTest()" ng-if="pickedCenter"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="isLoading"></i> {{(isLoading) ? "" : (message) ? message : 'Send'}}</button>
                            </div>
                        </section>                              
                   </section>                           
                    
                </div>     
            </div> 



             <div class="p-2" ng-if="isNewRadio && !isSubView" ng-controller="investigationController">
                <section ng-show="!isSearchToSend">             
                    <h6>New Radiology Test</h6><br>
                    <!--<table style="width: 78%">
                     
                        <thead>
                            <th style="width: 5%"></th>
                            <th style="width: 95%">Test Name</th>                                    
                        </thead>
                   
                        <tbody ng-repeat="lab in TestList">                                                                           
                            <td style="padding: 5px">{{lab.sn}}</td>
                            <td style="width: 80%"><input  id="states" type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                                {{getTest(test.name)}} 
                            </td>                                                              
                        </tbody>
                                              
                    </table>-->
                    <div>
                       <label>Test name: </label>
                    </div>
                    <div ng-repeat="lab in TestList">
                        <label>{{lab.sn}} </label><br>
                        <input  type="text" placeholder="Enter test name"  ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" >
                        {{getTest(test.name)}} 
                    </div>

                    <div style="text-align: right">
                        <i class="fa fa-plus" style="font-size:14px;margin-right: 10px;cursor: pointer;" title="Add field" ng-click="addTest()"> Add</i>
                            <i class="fa fa-minus" style="font-size: 14px;cursor: pointer;" title="Remove last field" ng-click="removeTest()"> Remove</i>
                    </div>
                    
                    
                    <div>
                        <label>Indication:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.indication" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                    <div>
                        <label>Clinical Summary:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.clinical_summary" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>LMP:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.lmp" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                     <div ng-if="patientInfo.gender === 'female'">
                        <label>Parity:</label>
                        <textarea  placeholder="Write.." ng-model="treatment.parity" class="form-control pl-2" ng-keyup="autoExpand($event)" id="textarea"></textarea>
                    </div>
                   

                    <div>
                        <!--<button class="btn btn-success" bg-click="sendToPatient()">to Patient</button>-->
                        <div>
                            <button class="btn btn-success" ng-click="sendToRad()">Continue</button>
                        </div>
                    </div>

                </section>

                <div ng-if="isSearchToSend" style="margin-top: -15px">
                    <a href="" ng-click="goBack()"><i class="fa fa-arrow-left"></i> Back</a> 
                    <!--<div>
                       <form>
                           <input type="text" name="city" ng-model="treatment.city" placeholder="City" class="form-control" style="width: 40%;display: inline-block;">
                           <input type="text" name="country" ng-model="treatment.country" placeholder="Country" class="form-control" style="width: 40%;display: inline-block;">
                           <input type="button" ng-click="changeOption()" class="btn btn-primary" value="search">
                       </form>
                       <hr>
                       <div class="row ">
                            <div class="col-sm-12 col-md-7 col-lg-7" style="padding-left: 0">
                                <div style="padding-left: 0">
                                    <input type="text" name="" ng-model="filterResult" placeholder="Filter centers" class="form-control">
                               </div>
                               <div style="overflow-y: auto; height: 400px;padding-left:0 ">                                 

                                   <div ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                                       <a href="" ng-click="selected(center)">{{center.name}}<span style="display: block">{{center.address}},{{center.city}},{{center.country}}</span></a>
                                   </div> 

                                    <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>                              
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-5 col-lg-5" style="padding: 2px">

                                <div style="background-color: #d7dde4;padding: 3px 7px 5px"><b>Selected Center</b></div>
                                
                               <div class="pl-2" style="line-height: 30px">
                                        <strong style="display: block;margin-top: 5px">{{pickedCenter.name}}</strong>
                                        <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                                        <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
                                </div>

                                <div style="padding: 7px;background-color: #d7dde4;"> <b>Investigation Availability</b> <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></div>
                                
                                <span ng-repeat="d in TestList" style="display: block;margin-top: 10px;padding-left: 5px">
                                    <span ng-class="{'notAvail': d.available === false}">{{d.name}} &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
                                </span>

                                <div style="padding: 20px;text-align: center;">
                                    <button class="btn btn-success form-control" ng-click="sendTest()" ng-if="pickedCenter"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="isLoading"></i> {{(isLoading) ? "" : (message) ? message : 'Send'}}</button>
                                </div>
                            </div>                               
                       </div>                           
                    </div>-->
                     <section class="row">
                        <section class="col-sm-12 col-md-7 col-lg-7 p-1">
                            <form ng-submit="changeOption()">
                               <input type="text" ng-model="treatment.city" placeholder="City" class="form-control" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:15" style="display: inline-block;width: 70%">
                               <!--<input type="text" name="country" ng-model="treatment.country" placeholder="Country" class="form-control" style="width: 40%;display: inline-block;">-->
                               <input type="submit" class="btn btn-primary btn-sm" value="Search">
                           </form>
                           <hr>
                           <label ng-if="searchResult.length > 0">Choose a center below</label><br>
                           <section ng-if="searchResult.length > 5">
                                <input type="text" name="" ng-model="filterResult" placeholder="Filter centers" class="form-control">
                           </section>
                                                      

                           <section ng-repeat="center in searchResult | filter: filterResult" style="padding:10px;border-bottom: 1px solid rgba(0,0,0,0.1)">
                               <a href="" ng-click="selected(center)" style="font-weight: 400;color: green"><b>{{center.name}}</b><br><span>{{center.address}},{{center.city}},{{center.country}}</span></a>
                           </section>
                           <section style="text-align: center;">
                            <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:orange;font-size: 24px;margin-top: 35px" ng-if="loading"></i>   
                            </section>                          
                            
                        </section>
                        <section class="col-sm-12 col-md-5 col-lg-5 p-1">

                           <h6 style="background-color: #d7dde4;padding: 10px">Selected Center</h6>
                            
                           <section  style="line-height: 30px;">
                                    <strong style="display: block;margin-top: 5px;">{{pickedCenter.name}}</strong>
                                    <span style="display: block"><i class="fa fa-globe" ng-if="pickedCenter.address"></i> {{pickedCenter.address}} {{pickedCenter.city}} {{pickedCenter.country}}</span>
                                    <span style="display: block;margin-bottom: 5px"><i class="fa fa-phone" ng-if="pickedCenter.phone"></i> {{pickedCenter.phone}}</span>
                            </section>
                            <p ng-if="!pickedCenter" class="text-danger" style="text-align: center;padding: 10px">none</p>

                            <h6 style="padding: 7px;background-color: #d7dde4;padding: 10px">Availability <small class="updateInfo" ng-class="{'text-danger': status === 'Not Updated!'}">{{status}}</small></h6>
                            
                            <a href="" ng-repeat="d in TestList" style="display: block;margin-top: 10px;padding-left: 5px">
                                <span ng-class="{'notAvail': d.available === false}">{{d.name}} &nbsp;<span style="font-size: 8px" ng-if="d.available === true">available</span></span>
                            </a>

                            <div style="padding: 20px;text-align: center;">
                                <button class="btn btn-success form-control" ng-click="sendTest()" ng-if="pickedCenter"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="isLoading"></i> {{(isLoading) ? "" : (message) ? message : 'Send'}}</button>
                            </div>
                        </section>                              
                   </section>                         
                </div>     
            </div>        

            </div>

           

    </div>  
</section>








                <!--removable div-->
    		</div>

             <div ng-if="isOutPatientBilling" class="card p-1">
                <div ng-if="inMainBill">
                    <h6>Out Patient Billing</h6>
                    <table class="table table-striped table-responsive no-mobile-item-display">
                        <thead>
                            <th style="width:3%"></th>
                            <th style="width:67%;padding-left: 15px">Description</th>
                            <th style="width:25%;padding-left: 15px">Cost</th>
                            <th style="width:5%"></th>
                        </thead>
                        <tbody ng-repeat=" i in billList">
                            <td style="padding-top: 22px">{{i.sn}}</td>
                            <td><input type="text" name="" ng-model="i.description" class="form-control" style="font-size: 14px!important"></td>
                            <td><input type="number" name="" ng-model="i.cost" class="form-control" style="font-size: 14px!important"></td>
                            <td style="padding-top: 22px"><i class="fa fa-times btn btn-neutral btn-sm" ng-if="billList.length > 1" ng-click="removeBill(i.sn)"></i></td>
                        </tbody>
                    </table>
                    <div class="mobile-item-display">                            
                        <table class="table" ng-repeat=" i in billList">
                            <thead><th ></th> <td></td></thead>
                            <thead><th>Description</th> <td><input type="text" name="" ng-model="i.description" class="form-control" style="font-size: 14px!important"></td></thead>
                            <thead><th>Cost</th> <td><input type="number" name="" ng-model="i.cost" class="form-control" style="font-size: 14px!important"></td></thead>
                            <thead><th></th> <td><i class="fa fa-times btn btn-neutral btn-sm" ng-if="billList.length > 1" ng-click="removeBill(i.sn)"></i></td></thead>
                        </table>
                    </div>

                    <div style="">
                        <button class="btn btn-info" ng-click="previewBill()">Preview</button>
                        <i class="fa fa-plus btn btn-simple btn-round" ng-click="addBill()" style="float: right;"></i>
                    </div>
                </div>
                <div ng-if="isPreviewBill">
                     <a href="" ng-click="mainBill()" class="btn btn-simple btn-sm" style="float: right;"><i class="fa fa-pencil"></i> edit</a>
                     <div>
                         <!--<i class="fa fa-user-md" style="float: left;font-size: 34px;padding-right: 10px"></i> -->
                         <div style="">
                             <strong>{{checkLogIn.name}} </strong>
                             <span style="display: block;">{{checkLogIn.specialty}}</span>
                             <span style="display: block;">{{checkLogIn.work_place}} {{checkLogIn.address}}, {{checkLogIn.city}} {{checkLogIn.country}}</span>
                         </div>
                     </div>
                   
                     <div class="clearfix"></div>
                    <hr class="bg-simple">
                     <table class="tabletable-responsive no-mobile-item-display">
                        <thead>
                            <th style="width:3%"></th>
                            <th style="width:70%;padding-left: 15px"></th>
                            <th style="padding-left: 15px"></th>
                            <th style=""></th>
                        </thead>
                        <tbody ng-repeat=" i in billList">
                            <td>{{i.sn}}</td>
                            <td style="width:60%;padding-left: 15px">{{i.description}}</td>
                            <td>{{toCurrency(i.cost)}}</td>
                            <!--<td><i class="fa fa-times btn btn-neutral btn-sm" ng-if="billList.length > 1" ng-click="removeBill(i.sn)"></i></td>-->
                        </tbody>
                        <caption><b>Total: </b>  {{toCurrency(totalBilled)}}</caption>
                    </table>
                    <div class="mobile-item-display">                            
                        <table class="table" ng-repeat=" i in billList">
                            <thead><th style="width:20%"></th> <td>{{i.sn}}</td></thead>
                            <thead><th style="width:20%"></th> <td>{{i.description}}</td></thead>
                            <thead><th style="width:20%"></th> <td>{{toCurrency(i.cost)}}</td></thead>
                            <!--<thead><th style="width:20%"></th> <td><i class="fa fa-times btn btn-neutral btn-sm" ng-if="billList.length > 1" ng-click="removeBill(i.sn)"></i></td></thead> -->                         
                        </table>
                        <div>
                            <b>Total: </b>  {{toCurrency(totalBilled)}}
                        </div>
                    </div>
                    <div class="mt-1">
                        <button class="btn btn-danger" ng-click="sendBill()" ng-if="!isSent"> <i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i> {{(loading) ? "" : "Send Bill"}}</button> <i class="fa fa-check" ng-if="isSent"> Bill sent!!</i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
 
</div>
                         
                        </div>  
    </div>
        
        
</div>

 <!--<div class="panel-body msg_container_base bg-default">
                    <div ng-repeat="u in message1">
                         <div class="talk-bubble tri-right left-top" ng-if="u.received">
                          <div class="talktext">
                           <div>                      
                                <p>{{u.received}}</p>
                               
                            </div>
                                <time datetime="2009-11-13T20:00">&nbsp;{{u.time | date: "shortTime"}}</time>                                
                            </div>
                            </div>




                    <div class="row msg_container base_sent" ng-if="u.sent">
                      <div class="talk-bubble tri-right right-top bg-info">
                      <div class="talktext">
                          <div ng-class="{'msg_sent' : u.sent}">
                        <p>{{u.sent}}
                          </p>
                        
                    </div>
                  <time datetime="2009-11-13T20:00">&nbsp;{{u.time | date: "shortTime"}}</time>
                 
                     <i class="fa fa-check" style="font-size:10px" ng-class="{'msg-received': u.isReceived === true}"></i>
                      <i class="fa fa-check" style="font-size:10px;margin-left:-10px;margin-top:3px" ng-class="{'msg-received': u.isReceived === true}" ng-if="u.isSent === true">{{(u.isReceived === true) ? ' seen' : ""}}</i>    
                  </div>
                </div>  
            </div>


                        
                    </div>
                    <div>
                        <div class="messages" ng-if="typing" style="max-width: 20%;">  
                            <p> {{typing}} </p>                                
                        </div>
                    </div>
                     
                </div>-->