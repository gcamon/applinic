
<div class="col-sm-12 col-md-12 col-lg-12">
	<!--<header style="padding: 10px; font-size: 18px;font-weight: bold;"><i class="fa fa-arrow-left" style="cursor: pointer" ng-click="refresh()" ng-if="refInfo.laboratory.test_to_run.length > 0"> &nbsp;Back</i></header>-->
	<div class="row">
		
	<header  class="col-sm-12 col-md-3 clo-lg-3" ng-if="!reportSuccess">
		<div class="card"  style="text-align: center">
			<img src="{{refInfo.laboratory.patient_profile_pic_url}}" style="max-width: 100%; max-height: auto;">
			<div>
				<strong>{{refInfo.laboratory.patient_firstname}} {{refInfo.laboratory.patient_lastname}}</strong> 
				<span style="display: block"> (Patient)</span>
			</div>
			<hr>
			<div style="padding: 5px;text-align: left;">
				<span>{{refInfo.laboratory.patient_address}}</span>
			</div>	
			<hr>
			<div style="padding: 5px;text-align: left;">
				<span> Age | &nbsp;{{refInfo.laboratory.patient_age}}</span>  
				<span style="display:block;padding-top: 20px">Sex | &nbsp;{{refInfo.laboratory.patient_gender}}</span> 
			</div>	
		</div>
	</header>
	
	<div ng-if="refInfo.laboratory.test_to_run.length > 0" class="col-sm-12 col-md-9 clo-lg-9">
		<div class="row">
			<div class="col-sm-12 col-md-12 col-lg-12 card" ng-if="hasSent && !isPreview">
				<h4 class="mb-0 mt-0 p-2 font-1_4">Investigation Details</h4> 

				<div class="col-sm-12 " style="padding:20px" ng-if="!isPreview">
					 <div class="mb-0 mt-0 pl-0 font-1_2" ><b>Clinical Summary: </b></div>
					<p class="pt-1 pb-1" style="font-size:1em;text-indent: 15px;margin-bottom: 10px" ng-if="refInfo.laboratory.clinical_summary">
						<em>{{refInfo.laboratory.clinical_summary}}
						</em>
					</p>
				</div>

				<div class="col-sm-12 " style="padding:20px" ng-if="!isPreview">
					 <div class="mb-0 mt-0 pl-0 font-1_2" ><b>Indication :</b></div>
					<p class="pt-1 pb-1" style="font-size:1em;text-indent: 15px;margin-bottom: 10px" ng-if="refInfo.laboratory.indication">
						<em>{{refInfo.laboratory.indication}}
						</em>
					</p>
				</div>

				<div class="col-sm-12 " style="padding:20px" ng-if="!isPreview && refInfo.laboratory.patient_gender === 'female'">
					 <div class="mb-0 mt-0 pl-0 font-1_2" ><b>Parity:</b></div>
					<p class="pt-1 pb-1" style="font-size:1em;text-indent: 15px;margin-bottom: 10px" ng-if="refInfo.laboratory.parity">
						<em>{{refInfo.laboratory.parity}}
						</em>
					</p>
				</div>

				<div class="col-sm-12 " style="padding:20px" ng-if="!isPreview && refInfo.laboratory.patient_gender === 'female'">
					 <div class="mb-0 mt-0 pl-0 font-1_2" ><b>LMP :</b></div>
					<p class="pt-1 pb-1" style="font-size:1em;text-indent: 15px;margin-bottom: 10px" ng-if="refInfo.laboratory.lmp">
						<em>{{refInfo.laboratory.lmp}}
						</em>
					</p>
				</div>



				<div class="col-sm-12 " style="padding:20px" ng-if="!isPreview">
					 <div class="mb-0 mt-0 pl-0 font-1_2" ><b>Referring Physician:</b></div>
					<p class="pt-1 pb-1" style="font-size:1em;text-indent: 15px;margin-bottom: 10px">
						{{refInfo.referral_title}} {{refInfo.referral_firstname}} {{refInfo.referral_lastname}}
					</p>
				</div>										

				
				<div class="col-sm-12 card" style="padding:20px" ng-if="!isPreview">					
					<h4 class="mb-0 mt-0 pl-0 font-1_4">Tests to run :</h4>
    				<div class="mt-1"  ng-repeat = "test in refInfo.laboratory.test_to_run" >
						<label class="custom-control custom-checkbox">
		    				<input type="checkbox" ng-model="test.select"  class="custom-control-input">
		    				<span class="custom-control-indicator"></span>
		    				<span class="custom-control-description">{{test.name}}</span>
    					</label>
    				</div>
				</div>	
					
		
			
				<p class="card" style="padding:30px">If <strong>None</strong> of the above test(s) is run by your center please <a href="" style="color:red;font-size:16px" ng-click="redirectTest()"> refer patient to another center.</a>
				If <strong> one </strong> or <strong> more </strong> of the tests is not done in your center <strong>unmark</strong> the particular test.</p>
				

		</div>

		<div class="row" ng-if="!reportSuccess">
			<div class="col-sm-12 col-md-12 col-lg-12" ng-if="hasSent">

				<div id="accordion">
                <!--<h6 style="color: #fff;padding:5px;margin:15px 0 20px">
                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="/#collapseSeven" aria-expanded="false" aria-controls="collapseSeven" style="background-color:#e97147; font-size: 14px;color:#fff;border-radius:10px;padding:10px;margin-right: 20px">Bill Patient</a>
                     <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="/#collapseSix" aria-expanded="false" aria-controls="collapseSix" style="background-color:#e97147; font-size: 14px;color:#fff;border-radius:10px;padding:10px" ng-click="result(refInfo)"ng-if="!isPreview">Enter test result</a>
                </h6>                 
                <div style="list-style:none;font-size:16px" id="collapseSeven" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSeven"> -->
                <div style="padding: 20px" class="card" ng-if="!isPreview">
               	 <article ng-if="!otpMsg && !paymentStatus">
                	<h4 class="mb-0 mt-0 pl-0 font-1_4">Compute cost</h4> 
                	 <p class="danger-mine" ng-if="compute && compute !== '' ">{{compute}}</p>                            
                     <table class="table table-responsive">
                    
                     	<tr>
                     		<thead>
                     			<th>Test name</th>
                     			<th>Cost</th>
                     		</thead>
                     	</tr>
                     	<tr>
                     		<tbody ng-repeat = "j in testsForSurchage">
                     			<td style="width: 55%;padding:10px;color:#000">{{j.name}}</td>
                     			<td style="width: 45%"><input type="number" ng-model="j.amount" style="padding:10px"></td>
                     		</tbody>
                     	</tr>
                     </table>
                     <div>
                     	<strong>Total : <em>{{str}}</em></strong>
                     	<button class="btn btn-danger" style="float: right;" ng-click="sendBill(refInfo.laboratory.patient_id,resend)" ng-if="grabRawAmount > 0"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i> Request Payment </button>
                     </div>
                     </article>	
                    <article ng-if="otpMsg">
                     	<div  class="p-2 col-md-8" class="text-center text-success font-1">
                     		<p class="bg-warning p-1 text-white" ng-if="otpError">{{otpError}}</p>
							<p class="">{{otpMsg}} </p>
							<input type="text" class="form-control" placeholder="Enter OTP you sent to this patient" ng-model="lab.otp" ng-if="grabRawAmount > 0">
							<div style="padding-left: 5px">
								<button class="btn btn-success" ng-click="verifyPay(refInfo)"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i>  Confirm</button>
							</div>
							
							<p ng-if="grabRawAmount <= 0"><span class="text-danger">Report will not be sent, patient is not billed for the service(s)</span>
							</p>							
						</div>
						<div class="p-2 col-md-3">
							<p class="text-success">Amount: {{str}}</p>
							
							<div>
								<a href="" ng-click="sendBill(refInfo.laboratory.patient_id,resend)"><i class="fa fa-refresh"></i> Resend OTP</a>
							</div>
						</div>
                     </article>

                     <article ng-if="refInfo.laboratory.is_paid || paymentStatus">
                     	<div class="p-2" style="font-size: 18px">
                     		<i class="fa fa-check-circle" style="font-size: 42px;color: #85CE36;float: left;"></i>
                     		<aside style="padding: 20px;display: inline-block;margin-top: -20px">
	                     		<span style="">Payment has been made for this service successfully!
	                     		<span style="display: block;">Paid: {{paymentDetail.amount}}</span> <span>Date: {{paymentDetail.date | date: "mediumDate"}} Time: {{paymentDetail.date | date: "shortTime"}}</span>
                     		</aside>
                     	</div>
                     </article>
                     <div>&nbsp;</div>
                </div>


               
               	<!--<p style="text-align:center; text-decoration: underline" ng-if="hasPreviewed"><button ng-click="result(refInfo)">Enter test result</button></p>-->
				
				<!-- for accordion <div ng-if="isResult" id="collapseSix" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSix">-->
				<div  ng-if="isResult && refInfo.radiology.is_paid || paymentStatus"  style="padding: 20px" class="card">
					<div style="padding:20px" class="card" ng-if="!isPreview">
						<h4 class="mb-0 mt-0 pl-0 font-1_4">Specimen collected: </h4>
						<ul style="list-style: none;">
							<li ng-repeat="item in specimen" style="display: inline-block;padding: 20px;float: left">
								<input type="checkbox" name="" ng-model="item.status">
								<span>{{item.name}}</span>
							</li>
						</ul>
					</div>

				
					
					<p style="text-align:right; text-decoration: underline" ng-if="isRefresh"><button ng-click="refresh()" class="fa fa-refresh"> Refresh</button></p>
					
						
					<div ng-if="!isPreview">
					<h4 class="mb-0 mt-0 pl-0 font-1_4">Report entry </h4>
					<form>
						<div class="row">
						<p class="danger-mine pl-1" ng-if=" incomplete && incomplete !== ''">{{incomplete}}</p>
						<div class="form-group col-md-6 col-sm-12" ng-repeat="report in testReport">
							<label class="font-1_1">{{report.name}} Test Report:</label>
							<textarea placeholder="Write..."  class="form-control"  ng-model="report.data" required= "required" style="height: 350px"></textarea>						
						</div>
						<div class="form-group col-md-6 col-sm-12">
						<label class="font-1_1">CONCLUSION:</label>
						<textarea  class="form-control" placeholder="Write..." required ng-model="lab.conclusion" style="height: 200px"></textarea>
						</div>
						
						</div>							
							
					</form>			
					</div>

					

					<div class="form-group col-md-12 col-sm-12" ng-if="isFilled === true" style="margin-top:30px">
                 	<button class="btn btn-success" ng-click="previewTestResult(refInfo)">Ok, continue</button>
                 	</div>		
				</div>
            </div>


				
				<div ng-if="isPreview">
					<div class="card pb-2">
					<div ng-if="!otpMsg" style="padding: 10px">
						
						<div class="row p-1" id="print-section">
							<div class="col-sm-12 col-md-7 col-lg-7">
								<img src="{{checkLogIn.profile_pic_url}}" style="width:82px;height:82px; float:left">
								<div style="display: inline-block;margin-top: -10px">
									<strong style="font-size: 22px">{{checkLogIn.name}}</strong>
									<article>{{checkLogIn.address}} {{checkLogIn.city}} {{checkLogIn.country}}</article>
									<article>{{checkLogIn.email}}</article>
									<article>{{checkLogIn.phone}}</article>											
								</div>							
							</div>
							<aside class="col-sm-12 col-md-5 col-lg-5" style="">	
								<div>
									<b>Date: </b>{{reportDate | date: "mediumDate"}}<br>
									<b>Applinic.com Reference Numeber:</b> {{refInfo.ref_id}}
								</div>
							</aside>
							<div class="clearfix"></div>		
							<hr class="bg-simple">
							<h6>Clinical Summary</h6>
							<p style="padding:10px 20px">{{refInfo.radiology.clinical_summary}}</p>
							<h6>Indication</h6>
							<p style="padding:10px 20px">{{refInfo.radiology.indication}}</p>
							<hr class="bg-simple">
							<h6>Investigation:</h6>
							<ul>
								<li ng-repeat = "test in refInfo.laboratory.test_to_run"">{{test.name}}</li>
							</ul>
							<hr class="bg-warning">
							<h6>Specimen collected:</h6>
							<ul>
								<li ng-repeat="sample in specimen" ng-if="sample.status == true">{{sample.name}}</li>
							</ul>
							<hr class="bg-warning">
							<h6>Findings: </h6>
							
							<div class="text-success pl-1 font-1_1 m-0" ng-repeat="picked in preTest"><b>{{picked.name}}: </b> <span style="display: block;padding: 20px;word-break: break-all;">{{picked.data}}</span></div>
							<div class="text-success pl-1 font-1_1"><b>Conclusion: </b> <span style="display: block;padding: 20px;word-break: break-all;">{{lab.conclusion}}</span></div>
							<hr class="bg-warning">
							<div class="text-danger pt-1 pl-1 pb-0" style="text-transform:uppercase;"><b>Total cost of service(s): </b> {{str}}</div>
						<div class="pl-1 pb-1">

                       
                        </div>
						<button class="btn btn-neutral mr-1 ml-1" ng-click="edit()"> Edit </button>
						<i class="btn btn-warning mr-1 ml-1 fa fa-print" ng-print  print-element-id="print-section"></i>
						<button class="btn btn-primary" ng-click="sendTestResult(refInfo)"><i class="fa fa-spinner fa-pulse fa-1x fa-fw" style="color:#fff" ng-if="loading"></i>{{(loading) ? "" : 'Ok,send' }}</button>
					</div>
					 <hr class="bg-warning">
					 <div class="row">
					<div  class="p-2 col-md-8" ng-if="otpMsg" class="text-center text-success font-1">
						<!--<p>{{otpMsg}}</p>
						<input type="text" class="form-control" placeholder="Enter OTP you sent to this patient" ng-model="lab.otp" ng-if="grabRawAmount > 0">
						<p ng-if="grabRawAmount <= 0"><span class="text-danger">Report will not be sent, patient is not billed for the service(s)</span></p>						
						
					</div>
					<div class="p-2 col-md-4 pt-4" ng-if="otpMsg"><br><br>
						<a href="#"  class="btn btn-danger">Cancel</a>	 					
						<input type="button" value="Send report" ng-click="sendTestResult(refInfo)" class="btn btn-success" style="margin-left:10px">
					</div>	-->
					 </div>
							
					<p class="pl-2">{{message}}</p>	
				</div>
				</div>
			</div>
		</div>
		<div class = "row" ng-if="isToForward">
			<div class="card p-2">
				<div class="col-sm-12 col-md-12">
						<p style="font-size: 1.2em; font-weight:300;background-color: grey;color:#fff;padding: 10px">Hi, look up for laboratory centers within your city/town that run this service(s) below.</p>
					<button  ng-click="customGetLab()" style="cursor:pointer" class="btn btn-simple">Change search criteria</button> &nbsp;&nbsp;&nbsp;
					 <a href="#" class="btn btn-danger">Cancel this process</a>
					<!--<h5  style="padding;4px; font-size:1em; color:#555; font-weight:300; ">Test <b>Not</b> ran by your center</h5>
					<span ng-repeat="test in unRanTest" style="color:blue;color:rgba(255,100,19,0.9)">{{test.name}}</span>-->
					<form style="margin-top: 20px;" ng-if="isCriteria === true">
   						<p><small>By default your city is used as search criteria.</small></p>
						<input type="text" name="" placeholder="Enter city / town" ng-model="user.city" class="form-control" style="width: 50%;display: inline-block;" uib-typeahead="city for city in cities | filter:$viewValue | limitTo:20">

						<button class="btn btn btn-success" ng-click="find()">Find</button>
					</form>
					
					<div class="drug-search-result">
						 <div class="pl-0 pb-2">
                            
                            <span class="col-md-7 col-sm-12 p-0 pt-1 pb-1">
								<label>Search result for: <span ng-repeat="test in unRanTest" style="display:inline-block;">{{test.name}}</span> 
                            </label><input type="text" class="form-control" placeholder="Filter by center name or address" ng-model="testFilter.name"></span>                         
                        </div>

						<div  class="card p-1" style="box-shadow: 0px 5px 25px 0px rgba(0, 0, 0, 0.2);"  ng-repeat ="center in testResult.full | filter : testFilter.name || testFilter.address" style="padding: 10px;margin-bottom: 1px solid grey;box-shadow: 0px 3px 5px grey">
							<span>{{getStr(center.str)}}</span>
							<span  style="display: block;padding: 10px 0;font-weight: bold;font-size: 18px;color: green">{{center.name}}</span>
							<span>{{center.address}}</span>
							<span>{{center.city}}</span>
							<span>{{center.country}}</span>							
							<span style="display: block;padding-top: 10px"><i class="fa fa-phone"></i> +234 {{center.phone}}</span>
							
							<button  class="btn btn-simple pull-right" ng-click="toForwardToCenter(center)"><i class="fa fa-share" style="cursor:pointer;color:green" title="Forward {{getStr(center.str)}} to {{center.name}}" ></i></button>  
						</div>
						<div class="card p-1" style="box-shadow: 0px 5px 25px 0px rgba(0, 0, 0, 0.2);" ng-repeat="center in testResult.less | filter : testFilter.name || testFilter.address" style="padding: 10px;margin-bottom: 1px solid grey;box-shadow: 0px 3px 5px grey">

							<div><span>{{getStr(center.str)}}</span> 
							<span style="text-decoration:line-through">{{notStr(center.notFound)}}</span>
							</div>
							<span  style="display: block;padding: 10px 0;font-weight: bold;font-size: 18px;color: green">{{center.name}}</span>
							<span>{{center.address}}</span>
							<span>{{center.city}}</span>
							<span>{{center.country}}</span>
							<span style="display: block;padding-top: 10px"><i class="fa fa-phone"></i> +234 {{center.phone}}</span>
							<button  class="btn btn-simple pull-right" ng-click="toForwardToCenter(center)"><i class="fa fa-share" style="cursor:pointer;color:green" title="Forward {{getStr(center.str)}} to {{center.name}}" ></i></button>  
						</div>
						<div class="clearfix"></div>
						<div ng-if="testResult.less.length === 0 && testResult.full.length === 0">
							<p style="text-align: center;">No result found based on the search criteria. You can modify search criteria and search again.</p>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>	
</div>

<div ng-if="refInfo.laboratory.test_to_run.length === 0" class="col-sm-12 col-md-9 clo-lg-9">
	<div ng-if="!reportSuccess">
		<div class="row">			
			<div class="col-sm-12 col-md-12 clo-lg-12 card">
				<h5 class="bg-info mb-1" style="padding:10px; color: #fff">HISTORY</h5>
				<textarea ng-model="refInfo.history"  class="form-control" style="height:90px; padding:7px;" placeholder="Write...">
				</textarea>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12 col-md-12 clo-lg-12 card">
				<h5 class="bg-info mb-1" style="padding:10px; color: #fff">Test to run</h5>
				<div class="row">
					<div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 pull-right" style="padding-left: 20px;max-height: 300px;overflow-y:auto">
						<ol>
							<li ng-repeat="i in testList" style="position: relative;padding-bottom:20px" ng-if="i.name">{{i.name}} 
							<i class="fa fa-times" style="cursor: pointer;font-weight: 100; font-size: 16px;color:grey;position: absolute;right:20px;top:5px" ng-click="remove(i.sn)" ng-if="i.name"></i>						
							</li>
						</ol>

						<div style="padding-top: 30px" ng-if="testList.length > 1">
							<input type="button" value="Ok,continue" class="btn btn-primary" ng-click="testToRunFilled()">
						</div>
					</div>
					<div class="col-sm-12 col-md-6 col-lg-6" >
						<div ng-repeat="j in inputctrl">				
							<input name="states" id="states" type="text" placeholder="Choose test name" ng-model="test.name" uib-typeahead="test.name for test in tests | filter:$viewValue | limitTo:15" class="form-control" style="width: 100%;font-weight:bold">
							{{getTest(test.name)}}

							<i class="fa fa-times" style="cursor: pointer;font-weight: 100; font-size: 16px;color:grey;position: absolute;right:20px;top:5px" ng-click="remove(i.sn)" ng-if="i.name"></i>
						</div>
						<div style="padding: 20px 0">
							<button class="fa fa-plus btn-simple"  ng-click="add(test.name)">&nbsp; Add</button> 
						</div>				
					</div>
					
				</div>

				
			</div>
		</div>
		
		
	</div>
	</div>

	<div style="height: 300px">
	
</div>
</div>
<div ng-if="reportSuccess">
	<p style="text-align:center;font-size:18px;color:green;margin-top:30px" class="card">Test report sent succesfully!</p>
</div>








