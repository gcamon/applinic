<div class="container">
    <div class="card card-center-1 p-2">
<div class="col-sm-12 col-md-12 col-lg-12" >
	<div>
		<h3 class="p-0" style="padding: 0">Patient Prescription</h3>
	</div>
	<div class="row">
		
		<div class="col-md-12 col-lg-12 col-sm-12  pt-1">
			<div style="max-height: 120px;max-width: 120px;display: inline-block;float: left">		
				<img class="img-responsive card" src="{{refData.pharmacy.patient_profile_pic_url}}">
			</div>	
			<div style="display: inline-block;float: left;padding-left: 15px">
				<div><strong>{{refData.pharmacy.patient_firstname}} {{refData.pharmacy.patient_lastname}}</strong></div>
				<div><strong>{{refData.pharmacy.patient_address}}, {{refData.pharmacy.patient_city}}, {{refData.pharmacy.patient_country}}</strong></div>
				<div><strong>{{refData.pharmacy.patient_age}}</strong></div>
				<div><strong>{{refData.pharmacy.patient_gender}}</strong></div>
			</div>
			<div class="clearfix"></div>		
			<h6 class="text-muted pb-1" style="border-bottom: 1px solid rgba(0,0,0,0.2);margin-top: 20px">Reference Details</h6>
			<ul class="nav font-1_1" style="line-height: 30px">
				<li style="font-weight: bold;">Referred by:  <span style="font-weight: 300">{{refData.referral_title}} {{refData.referral_firstname}} {{refData.referral_lastname}} </span></li>
				<li style="font-weight: bold;">Received:  <span am-time-ago="refData.date" style="font-weight: 300;"></span></li>
				<!--<li><strong>Time </strong>| {{refData.date | date: "mediumTime"}}</li>-->
				<li style="font-weight: bold;">Reference number: <span class="text-danger" style="font-weight: 300;">{{refData.ref_id}}</span></li>
			</ul>
			<h6 class="text-muted pb-1 mt-2" style="border-bottom: 1px solid rgba(0,0,0,0.4);">Prescription Details</h6>
			<p><strong>Tips:</strong> While attending to this patient, please <strong>Tick</strong> the drug you have already given to the patient below.If dosage, frquency and duration fields are missing you can add them based on the drugs you already administered.
				<strong>Unticked drug </strong> is regarded as not available in your center<span> which you can <strong>refer to another </strong> center.</span></p>	
				<!--<div style="text-align: right;">
				<a href="" ng-click="refresh()"style="color:orange"><i class="fa fa-refresh"></i> Refresh</a>	
				</div-->		
			<table class="table table-striped table-responsiv">				
				<tr>
					<thead>
						<th><strong>S/N</strong></th>
						<th><strong>Drug name</strong></th>
						<th><strong>Dosage</strong></th>
						<th><strong>Frequency</strong></th>
						<th><strong>Duration</strong></th>
						<th>Tick</th>
					</thead>
				</tr>
				<tr>
					<tbody ng-repeat="prescription in refData.pharmacy.prescription_body">											
						<td ng-if="!prescription.unavail">{{prescription.sn}}</td>
						<td ng-class="{strike: prescription.picked}" ng-if="!prescription.unavail">{{prescription.drug_name}}</td>						
						<td ng-class="{strike: prescription.picked}" ng-if="!prescription.unavail">{{prescription.dosage}}<input type="text" name="dosage" ng-model="prescription.dosage" class="form-control" ng-if="!refData.pharmacy.doctor_id"></td>
						<td ng-class="{strike: prescription.picked}" ng-if="!prescription.unavail">{{prescription.frequency}}<input type="text" name="dosage" ng-model="prescription.frequency" class="form-control" ng-if="!refData.pharmacy.doctor_id"></td>
						<td ng-class="{strike: prescription.picked}" ng-if="!prescription.unavail">{{prescription.duration}}<input type="text" name="dosage" ng-model="prescription.duration" class="form-control" ng-if="!refData.pharmacy.doctor_id"></td>
						<td ng-if="!prescription.unavail"><div>
					<label class="custom-control custom-checkbox">
					  <input type="checkbox" class="custom-control-input" ng-model= "prescription.picked" >
					  <span class="custom-control-indicator"></span>
					  <span class="custom-control-description" style="opacity:0;">.</span>
					</label>
					</div>
					</td>
					</tbody>
				</tr>
				
			</table>
			<hr class="bg-success">
			<div style="list-style:none;font-size:14px" ng-if="!refData.pharmacy.is_paid">
                <div>     
                     <table>
                     	<tr>
                     		<thead ng-if="isFilled === true">
                     			<th>Drug</th>
                     			<th>Cost</th>
                     		</thead>
                     	</tr>
                     	<tr>
                     		<tbody ng-repeat = "j in drugsForSurchage">
                     			<td style="width: 55%;padding:10px;color: orange;font-weight: bold;">{{j.name}}</td>
                     			<td style="width: 45%"><input type="number" ng-model="j.amount" style="padding:10px"></td>
                     		</tbody>
                     	</tr>
                     </table>
                     <div class="pt-2 pb-2">
                     	<strong  class="text-success" ng-if="isFilled === true">Total : <em>{{str}}</em></strong>                     	
                     	<strong style="display: block;" class="text-success" ng-if="isFilled === true">You'll receive : {{commissionedAmount}} &nbsp;<span style="font-weight: normal;">( platform {{checkLogIn.city_grade}}% commission applied )</span></strong>
                     </div>
                </div>
            </div>
            <p ng-if="!refData.pharmacy.doctor_id && isFilled !== true"><i class="fa fa-warning text-danger"> The source of the above prescription is <strong>not trusted!</strong> It may has been prescribed by the patient or non-professional. <strong>Do Enquire</strong> from  this patient about the source before continuing. </i>
            </p>	
			<div style="margin-top: 20px; margin-bottom: 30px">
				<button  class="btn btn-simple" disabled="disabled" style="cursor: no-drop;" ng-if="isFilled !== true">Send Billing for payment</button>
				<button class="btn btn-success" ng-click="sendBill(refData.pharmacy.patient_id)" ng-if="isFilled && !isOTP && !refData.pharmacy.is_paid">Bill patient</button>&nbsp;&nbsp;
				<!--<button class="btn btn-info btn-sm" ng-click="toList(refData.pharmacy.patient_firstname,refData.pharmacy.patient_lastname,refData.pharmacy.patient_profile_pic_url,refData.ref_id,refData.date)" ng-if="allNote.length !== 0 && isFilled !== true">Add to attendance list</button>-->
				<button class="btn btn-danger" ng-click="toAnotherPharmacy()" ng-if="isForwardable === true">Refer to another <i class="fa fa-arrow-right"></i></button> 
				
				<!--<button class="btn btn-success btn-sm" ng-click="done()">Done</button>
				<button class="btn btn-default btn-sm" ng-click="toAnotherPharmacy()">Forward unticked drug to a pharmacy</button>
				<button class="btn btn-info btn-sm" ng-click="toList(refData.pharmacy.patient_firstname,refData.pharmacy.patient_lastname,refData.pharmacy.patient_profile_pic_url,refData.ref_id,refData.date)" ng-if="allNote.length !== 0">Attend later</button>	-->	

				<div ng-if="isOTP && !refData.pharmacy.is_paid" ng-controller="billingController">
					<h6 class="p-0">Billing confirmation</h6><hr>
					<div>						
						<article>
							<p><strong>To: {{refData.pharmacy.patient_firstname}} {{refData.pharmacy.patient_lastname}}</strong></p>			
							<p><strong>Amount billed: </strong> {{refData.amount}}</p>
							<small>Get OTP from this patient to confirm payment. Note OTP expires in <strong>5 minutes</strong></small>
						</article>
					</div>
					
				        
					<div class="p-0">	
						<div style="width: 60%">	
					    	<input type="text" class="form-control" placeholder="Enter OTP" ng-model="pay.otp">
					    </div>
					    <div>
					    	<small>Otp will auto submit when the six digits are completed</small> 
					    </div>
				    </div>
					<div class="pt-1">
						<a href=""  ng-click="sendBill(resendPatientId,resend)">Resend OTP</a><br>
					</div>
				    <div class="clearfix"></div>
				</div>

				<div ng-if="refData.pharmacy.is_paid" style="padding: 10px 15px;position: relative;margin-top: 20px;border:1px dashed rgba(0,0,0,0.6)">					
					<h5><i class="fa fa-check pb-0" style="color:green"> Payment successful!</i></h5>
					<article style="font-size: 14px">
						<div><b>Amount paid: {{refData.pharmacy.detail.amount}}</b></div>
						<div><b>Date of payment: {{refData.pharmacy.detail.date | date: "mediumDate"}} ( <span am-Time-Ago="refData.pharmacy.detail.date"></span> )</b></div>
					</article>	
					<a href="" class="btn btn-sm" style="position: absolute;top:10px;right:10px" ng-click="newPayment()">request new</a>
				</div>

			</div>
			
			<div class="prescription-info card" ng-if="refData.pharmacy.doctor_id">
				<h6 class="text-muted pb-1" style="border-bottom: 1px solid rgba(0,0,0,0.2);">Prescribed by: </h6>
				<div class="row">
					<div class="col-sm-6 col-md-2 col-lg-2" style="padding-left: 10pz">			
						<img class="img-rounded card" src="{{refData.pharmacy.doctor_profile_pic_url}}" style="max-height:120px; max-width:120px">
					</div>
					<div class="col-sm-6 col-md-10 col-lg-10" style="line-height: 25px;padding: 10px">								
						<strong class="font-1_1"> {{refData.pharmacy.title}} {{refData.pharmacy.doctor_firstname}} {{refData.pharmacy.doctor_lastname}}</strong><br>
						<span class="text-muted">{{refData.pharmacy.doctor_specialty}}</span>
						<span>{{refData.pharmacy.doctor_phone}}</span><br>
						<span><strong>{{refData.pharmacy.doctor_work_place}}</strong>| {{refData.pharmacy.doctor_address}}, {{refData.pharmacy.doctor_city}}, {{refData.pharmacy.doctor_country}}</span><br>
						<a href="{{refData.pharmacy.doctor_profile_url}}">View  profile.</a>						
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
	</div>
</div>


